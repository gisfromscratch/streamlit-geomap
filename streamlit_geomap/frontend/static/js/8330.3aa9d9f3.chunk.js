"use strict";(self.webpackChunkstreamlit_geomap_frontend=self.webpackChunkstreamlit_geomap_frontend||[]).push([[8330],{22665:(e,t,s)=>{s.r(t),s.d(t,{default:()=>R});var r=s(98773),a=s(50076),n=s(76460),o=s(15941),i=s(50346),u=s(62754),l=s(80963),h=s(98618),c=s(78482),d=s(72547),p=s(24586),g=s(48094),m=s(10907),y=s(40098),f=s(11316),_=s(1900),C=s(85632),w=s(36693);const x="esri.layers.WFSLayer";class R{constructor(){this._customParameters=null,this._queryEngine=null,this._supportsPagination=!0}destroy(){var e;null!==(e=this._queryEngine)&&void 0!==e&&e.destroy(),this._queryEngine=null}async load(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{getFeatureUrl:s,getFeatureOutputFormat:r,fields:n,geometryType:o,featureType:u,maxRecordCount:l,maxTotalRecordCount:h,maxPageCount:c,objectIdField:m,customParameters:y}=e,{spatialReference:C,getFeatureSpatialReference:x}=(0,f.UH)(s,u,e.spatialReference);try{await(0,p.Nk)(x,C)}catch(S){throw new a.A("unsupported-projection","Projection not supported",{inSpatialReference:x,outSpatialReference:C})}(0,i.Te)(t),this._customParameters=y,this._featureType=u,this._fieldsIndex=_.A.fromLayerJSON({fields:n,dateFieldsTimeReference:n.some(e=>"esriFieldTypeDate"===e.type)?{timeZoneIANA:w.n$}:null}),this._geometryType=o,this._getFeatureUrl=s,this._getFeatureOutputFormat=r,this._getFeatureSpatialReference=x,this._maxRecordCount=l,this._maxTotalRecordCount=h,this._maxPageCount=c,this._objectIdField=m,this._spatialReference=C;let R=await this._snapshotFeatures(t);if(R.errors.length>0&&(this._supportsPagination=!1,R=await this._snapshotFeatures(t),R.errors.length>0))throw R.errors[0];const T={type:"object-id",fieldName:m};return this._queryEngine=new g.do({fieldsIndex:this._fieldsIndex,geometryType:o,hasM:!1,hasZ:!1,featureIdInfo:T,spatialReference:C,timeInfo:null,featureStore:new d.A({geometryType:o,hasM:!1,hasZ:!1})}),this._queryEngine.featureStore.addMany(R.features),{warnings:F(R),extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async applyEdits(){throw new a.A("wfs-source:editing-not-supported","applyEdits() is not supported on WFSLayer")}async queryFeatures(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),(await this._queryEngine.executeQueryForIds(e,t.signal)).filter(C.Et)}async queryExtent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),(0,c.J)(this._queryEngine,e,t.signal)}async queryAttributeBins(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeAttributeBinsQuery(e,t.signal)}async refresh(e){var t;return this._customParameters=e.customParameters,this._maxRecordCount=e.maxRecordCount,this._maxTotalRecordCount=e.maxTotalRecordCount,this._maxPageCount=e.maxPageCount,null!==(t=this._snapshotTask)&&void 0!==t&&t.abort(),this._snapshotTask=(0,r.UT)(e=>this._snapshotFeatures({signal:e})),this._snapshotTask.promise.then(e=>{var t;this._queryEngine.featureStore.clear(),this._queryEngine.featureStore.addMany(e.features);for(const s of F(e))n.A.getLogger(x).warn(new u.A("wfs-layer:refresh-warning",s.message,s.details));(null===(t=e.errors)||void 0===t?void 0:t.length)&&n.A.getLogger(x).warn(new u.A("wfs-layer:refresh-error","Refresh completed with errors",{errors:e.errors}))},()=>{this._queryEngine.featureStore.clear()}),await this._waitSnapshotComplete(),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch(e){}return this._waitSnapshotComplete()}}async _snapshotFeatures(e){const t=null===e||void 0===e?void 0:e.signal,s=this._maxTotalRecordCount,r=this._maxPageCount,a=this._supportsPagination&&r>1?await(0,f.E)(this._getFeatureUrl,this._featureType.typeName,{customParameters:this._customParameters,signal:t}):void 0;let n=[];const u=[];if(null==a)try{n=await this._singleQuery(t)}catch(l){(0,i.zf)(l)||u.push(l)}else{const e=Math.min(a,s),l=function*(e,t,s){for(let r=0;r<t;r++)yield e._pageQuery(r,s)}(this,(0,o.qE)(Math.ceil(e/this._maxRecordCount),1,r),t);await Promise.allSettled(Array.from({length:10}).map(()=>async function(e,t,s){let r=e.next();for(;!r.done;){try{const e=await r.value;t.push(...e)}catch(l){(0,i.zf)(l)||s.push(l)}r=e.next()}}(l,n,u)))}return(0,i.Te)(t),{features:n,totalRecordCount:a,maxTotalRecordCount:s,maxPageCount:r,errors:u}}async _singleQuery(e){const t=Number.isFinite(this._maxRecordCount)&&this._maxRecordCount>0?this._maxRecordCount:void 0,s=await(0,f.x$)(this._getFeatureUrl,this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,count:t,signal:e});return this._processGeoJSON(s,{signal:e})}async _pageQuery(e,t){const s=e*this._maxRecordCount,r=await(0,f.x$)(this._getFeatureUrl,this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,startIndex:s,count:this._maxRecordCount,signal:t});return this._processGeoJSON(r,{startIndex:s,signal:t})}_processGeoJSON(e,t){(0,m.sO)(e,this._getFeatureSpatialReference.wkid);const{startIndex:s,signal:r}=t;(0,i.Te)(r);const a=(0,m.bd)(e,{geometryType:this._geometryType,hasZ:!1,objectIdField:this._objectIdField});if(!(0,l.aI)(this._spatialReference,this._getFeatureSpatialReference))for(const o of a)null!=o.geometry&&(o.geometry=(0,h.Ux)((0,p.Cv)((0,h.zv)(o.geometry,this._geometryType,!1,!1),this._getFeatureSpatialReference,this._spatialReference)));let n=null!==s&&void 0!==s?s:1;for(const o of a){const e={};(0,y.MB)(this._fieldsIndex,e,o.attributes,!0),o.attributes=e,null==e[this._objectIdField]&&(o.objectId=e[this._objectIdField]=n++)}return a}}function F(e){const t=[];return null!=e.totalRecordCount&&(e.features.length<e.totalRecordCount&&t.push({name:"wfs-layer:maxRecordCount-too-low",message:"Could only fetch ".concat(e.features.length," of ").concat(e.totalRecordCount," in ").concat(e.maxPageCount," queries. Try increasing the value of WFSLayer.maxRecordCount."),details:{recordCount:e.features.length,totalRecordCount:e.totalRecordCount}}),e.totalRecordCount>e.maxTotalRecordCount&&t.push({name:"wfs-layer:large-dataset",message:"The number of ".concat(e.totalRecordCount," features exceeds the maximum allowed of ").concat(e.maxTotalRecordCount,"."),details:{recordCount:e.features.length,totalRecordCount:e.totalRecordCount,maxTotalRecordCount:e.maxTotalRecordCount}})),t}},40098:(e,t,s)=>{s.d(t,{$1:()=>y,CR:()=>m,MB:()=>d,PC:()=>f,Yx:()=>u,bP:()=>h});var r=s(51344),a=s(80963),n=s(53430);class o{constructor(e){this.description=e,this.code=null}}class i{constructor(e){this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error=new o(e)}}function u(e){return new i(e)}class l{constructor(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}function h(e){return new l(e)}const c=new Set;function d(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];c.clear();for(const o in s){const a=e.get(o);if(!a)continue;const i=p(a,s[o]);if(c.add(a.name),a&&(r||a.editable)){const e=(0,n.CJ)(a,i);if(e)return u((0,n.uo)(e,a,i));t[a.name]=i}}for(const n of null!==(a=e.requiredFields)&&void 0!==a?a:[]){var a;if(!c.has(n.name))return u('missing required field "'.concat(n.name,'"'))}return null}function p(e,t){let s=t;return(0,n.WA)(e)&&"string"==typeof t?s=parseFloat(t):(0,n.yM)(e)&&null!=t&&"string"!=typeof t?s=String(t):(0,n.vE)(e)&&"string"==typeof t&&(s=(0,r._U)(t)),(0,n.WX)(s)}let g;function m(e,t){if(!e||!(0,a.fn)(t))return e;if("rings"in e||"paths"in e){if(null==g)throw new TypeError("geometry engine not loaded");return g.simplify(t,e)}return e}async function y(e,t){!(0,a.fn)(e)||"esriGeometryPolygon"!==t&&"esriGeometryPolyline"!==t||await async function(){return null==g&&(g=await Promise.all([s.e(2612),s.e(1669)]).then(s.bind(s,1669))),g}()}const f={supportsAutoIntervalBin:!0,supportsFixedIntervalBin:!0,supportsFixedBoundariesBin:!0,supportsDateBin:!0,supportsStackBy:!0,supportsSplitBy:!0,supportsNormalization:!0,supportedStatisticTypes:["COUNT","SUM","AVG","VAR","STDDEV","MIN","MAX","PERCENTILE_CONT","PERCENTILE_DISC","CentroidAggregate","EnvelopeAggregate","ConvexHullAggregate"],supportedNormalizationTypes:["field","log","naturalLog","percentOfTotal","squareRoot"]}},75146:(e,t,s)=>{s.d(t,{A:()=>r});class r{constructor(){this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new r;return e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}}}]);
//# sourceMappingURL=8330.3aa9d9f3.chunk.js.map