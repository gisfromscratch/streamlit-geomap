"use strict";(self.webpackChunkstreamlit_geomap_frontend=self.webpackChunkstreamlit_geomap_frontend||[]).push([[2633,9912],{9912:(e,t,n)=>{n.r(t),n.d(t,{applyTextFormattingHTML:()=>K,createFieldInfoMap:()=>V,findRelatedLayer:()=>ue,findUtilityNetwork:()=>se,fixTokens:()=>D,formatAttributes:()=>X,formatEditInfo:()=>P,formatValueToFieldInfo:()=>Y,getAllFieldInfos:()=>$,getFieldInfo:()=>Q,getFieldInfoLabel:()=>q,getFixedFieldName:()=>x,getFixedFieldNames:()=>E,getSourceLayer:()=>L,graphicCallback:()=>N,htmlEntities:()=>B,isAssociatedFeatureSupportedLayer:()=>G,isExpressionField:()=>C,isFeatureSupportedLayer:()=>z,isGraphicForRelatableFeatureSupportedLayer:()=>J,isRelatableFeatureSupportedLayer:()=>H,isRelatableLayer:()=>O,isRelatedField:()=>ne,preLayerQueryCallback:()=>ae,preRequestCallback:()=>le,querySourceLayer:()=>ee,queryUpdatedFeature:()=>te,shouldOpenInNewTab:()=>Z,substituteAttributes:()=>R,substituteFieldsInLinksAndAttributes:()=>k});var r=n(89379),i=n(81806),o=n(76460),a=n(88685),l=n(65256),u=n(50265),s=n(53430),c=n(31933),f=n(42633),d=n(76386),p=n(67478);const y=()=>o.A.getLogger("esri.widgets.Feature.support.featureUtils"),m=/href=(""|'')/gi,g=/(\{([^{\r\n]+)\})/g,h=/'/g,v=/^\s*expression\//i,b=/(\n)/gi,I=/[\u00A0-\u9999<>&]/gim,F=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,T=/^(?:mailto:|tel:)/,w="relationships/",A=(0,l.J2)("short-date-short-time");function L(e){var t;if(null!=e)return null!==(t=e.sourceLayer||e.layer)&&void 0!==t?t:void 0}async function N(e){let{type:t,value:n,event:r}=e;try{return"function"==typeof n?n(r):await n}catch(i){return void y().error("error",'An error occurred when calling the "'.concat(t,'" function'),{error:i,graphic:r.graphic,value:n})}}function Z(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e)return!T.test(e.trim().toLowerCase())}function C(e){return!!e&&v.test(e)}function q(e,t){const n=function(e,t){if(!t||!C(t)||!e)return;const n=t.replace(v,"").toLowerCase();return e.find(e=>{let{name:t}=e;return t.toLowerCase()===n})}(t,null===e||void 0===e?void 0:e.fieldName);return n?n.title||null:e?e.label||e.fieldName:null}function x(e,t){const n=U(t,e);return n?n.name:e}function E(e,t){return e&&e.map(e=>x(e,t))}function U(e,t){var n;return e&&"function"==typeof e.getField&&t&&null!==(n=e.getField(t))&&void 0!==n?n:null}function M(e){return"".concat(e).trim()}function k(e){let{attributes:t,globalAttributes:n,layer:i,text:o,expressionAttributes:a,fieldInfoMap:l}=e;return o?R({formattedAttributes:n,template:j(o,(0,r.A)((0,r.A)((0,r.A)({},n),a),t),i),fieldInfoMap:l}):""}function R(e){let{formattedAttributes:t,template:n,fieldInfoMap:r}=e;return M(function(e){return e.replaceAll(m,"")}((0,a.HC)((0,a.HC)(n,e=>function(e,t){const n=t.get(e.toLowerCase());return"{".concat((null===n||void 0===n?void 0:n.fieldName)||e,"}")}(e,r)),t)))}function S(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(0,r.A)({},e);return Object.keys(n).forEach(e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=t[e];if("string"==typeof r){const i="%27",o=(n?encodeURIComponent(r):r).replaceAll(h,i);t[e]=o}}(e,n,t)),n}function D(e,t){return e.replaceAll(g,(e,n,r)=>{const i=U(t,r);return i?"{".concat(i.name,"}"):n})}function j(e,t,n){const r=D(e,n);return r?r.replaceAll(F,(e,n,r)=>function(e,t,n){const r=(t=M(t))&&"{"!==t[0];return(0,a.HC)(e,S(n,r||!1))}(e,n||r,t)):r}function z(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function O(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function H(e){return z(e)&&O(e)}function G(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function J(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&H(e.sourceLayer)}function Y(e,t){const{fieldInfos:n,fieldName:i,preventPlacesFormatting:o,layer:a,timeZone:l}=t,c=Q(n,i),d=U(a,i);if(c&&!(0,s.JL)(i)){var p;const t=null===d||void 0===d?void 0:d.type,n=null===(p=c.format)||void 0===p?void 0:p.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||n)return(0,f.i0)(e,{format:n,fieldType:t,timeZoneOptions:{layerTimeZone:a&&"preferredTimeZone"in a?a.preferredTimeZone:null,viewTimeZone:l,datesInUnknownTimezone:!(!a||!("datesInUnknownTimezone"in a))&&!!a.datesInUnknownTimezone}})}const y=null===c||void 0===c?void 0:c.format;return"string"==typeof e&&(0,s.JL)(i)&&y?function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?_(e,",",", ",t):e.includes(";")?_(e,";","; ",t):e.includes(" ")?_(e," "," ",t):(0,u.ZV)(Number(e),(0,u.yx)(t))}(e,y):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,y))||null==e||null==y?K(e):(0,u.ZV)(e,o?(0,r.A)((0,r.A)({},(0,u.yx)(y)),{},{minimumFractionDigits:0,maximumFractionDigits:20}):(0,u.yx)(y))}function _(e,t,n,r){return e.trim().split(t).map(e=>(0,u.ZV)(Number(e),(0,u.yx)(r))).join(n)}function Q(e,t){if(null!==e&&void 0!==e&&e.length&&t)return e.find(e=>{var n;return(null===(n=e.fieldName)||void 0===n?void 0:n.toLowerCase())===t.toLowerCase()})}function P(e,t,n,i){const{creatorField:o,creationDateField:a,editorField:u,editDateField:s}=e;if(!t)return;const c=(0,p.hv)(i&&"preferredTimeZone"in i?i.preferredTimeZone:null,!(!i||!("datesInUnknownTimezone"in i))&&!!i.datesInUnknownTimezone,n,A,"date"),f=(0,r.A)((0,r.A)({},A),c),d=t[s];if("number"==typeof d){const e=t[u];return{type:"edit",date:(0,l.Yq)(d,f),user:e}}const y=t[a];if("number"==typeof y){const e=t[o];return{type:"create",date:(0,l.Yq)(y,f),user:e}}return null}function V(e,t){const n=new Map;if(!e)return n;for(const r of e){if(!r.fieldName)continue;const e=x(r.fieldName,t);r.fieldName=e,n.set(e.toLowerCase(),r)}return n}function $(e){const t=[];if(!e)return t;const{fieldInfos:n,content:r}=e;return n&&t.push(...n),r&&Array.isArray(r)?(r.forEach(e=>{if("fields"===e.type){const n=null===e||void 0===e?void 0:e.fieldInfos;n&&t.push(...n)}}),t):t}function B(e){return e.replaceAll(I,e=>"&#".concat(e.charCodeAt(0),";"))}function K(e){return"string"==typeof e?e.replaceAll(b,'<br class="esri-text-new-line" />'):e}function W(e){var t;const{value:n,fieldName:r,fieldInfos:o,fieldInfoMap:a,layer:l,graphic:u,timeZone:c}=e;if(null==n)return"";const d=function(e){let{fieldName:t,value:n,graphic:r,layer:o}=e;if(ne(t))return null;if(!o||"function"!=typeof o.getFieldDomain)return null;const a=r&&o.getFieldDomain(t,{feature:r,excludeImpliedDomains:(0,i.A)("esri-widget-legacy-field-domain-calculation")});return a&&"coded-value"===a.type?a.getName(n):null}({fieldName:r,value:n,graphic:u,layer:l});if(d)return d;const p=function(e){let{fieldName:t,graphic:n,layer:r}=e;if(ne(t))return null;if(!r||"function"!=typeof r.getFeatureType)return null;const{typeIdField:i}=r;if(!i||t!==i)return null;const o=r.getFeatureType(n);return o?o.name:null}({fieldName:r,graphic:u,layer:l});if(p)return p;if(a.get(r.toLowerCase()))return Y(n,{fieldInfos:o||Array.from(a.values()),fieldName:r,layer:l,timeZone:c});const y=null===l||void 0===l||null===(t=l.fieldsIndex)||void 0===t?void 0:t.get(r);return y&&((0,f.fs)(y)||(0,s.OH)(y))?(0,f.i0)(n,{fieldType:y.type,timeZoneOptions:{layerTimeZone:l&&"preferredTimeZone"in l?l.preferredTimeZone:null,viewTimeZone:c,datesInUnknownTimezone:!(!l||!("datesInUnknownTimezone"in l))&&!!l.datesInUnknownTimezone}}):K(n)}function X(e){let{fieldInfos:t,attributes:n,layer:r,graphic:i,fieldInfoMap:o,relatedInfos:a,timeZone:l}=e;const u={};return null!==a&&void 0!==a&&a.forEach(e=>function(e){var t,n;let{attributes:r,relatedInfo:i,fieldInfoMap:o,fieldInfos:a,layer:l,timeZone:u}=e;r&&i&&(null!==(t=i.relatedFeatures)&&void 0!==t&&t.forEach(e=>re({attributes:r,graphic:e,relatedInfo:i,fieldInfoMap:o,fieldInfos:a,layer:l,timeZone:u})),null===(n=i.relatedStatsFeatures)||void 0===n||n.forEach(e=>re({attributes:r,graphic:e,relatedInfo:i,fieldInfoMap:o,fieldInfos:a,layer:l,timeZone:u})))}({attributes:u,relatedInfo:e,fieldInfoMap:o,fieldInfos:t,layer:r,timeZone:l})),n&&Object.keys(n).forEach(e=>{const a=n[e];u[e]=W({fieldName:e,fieldInfos:t,fieldInfoMap:o,layer:r,value:a,graphic:i,timeZone:l})}),u}async function ee(e,t){var n;const{layer:r,graphic:i,outFields:o,objectIds:a,returnGeometry:l,spatialReference:u}=e,s=a[0];if("number"!=typeof s&&"string"!=typeof s){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:r,graphic:i,objectId:s,requiredFields:o};return y().warn(e,t),null}if(null===(n=(0,c.BR)(r))||void 0===n||null===(n=n.operations)||void 0===n||!n.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:r,graphic:i,requiredFields:o,returnGeometry:l};return y().warn(e,t),null}const f=r.createQuery();return f.objectIds=a,f.outFields=null!==o&&void 0!==o&&o.length?o:[r.objectIdField],f.returnGeometry=!!l,f.returnZ=!!l,f.returnM=!!l,f.outSpatialReference=u,(await r.queryFeatures(f,t)).features[0]}async function te(e,t){let{graphic:n,popupTemplate:i,layer:o,spatialReference:a}=e;if(!o||!i)return;if("function"==typeof o.load&&await o.load(t),!n.attributes)return;const l=o.objectIdField,u=n.attributes[l];if(null==u)return;const c=[u],f=await i.getRequiredFields(o.fieldsIndex),p=(0,s.Kl)(n,f),y=p?[]:f.includes(l)?f:[...f,l],m=i.returnGeometry||await async function(e){var t;if(null===(t=e.expressionInfos)||void 0===t||!t.length)return!1;const n=await(0,d.l)(),{arcadeUtils:{hasGeometryFunctions:r}}=n;return r(e)}(i);if(p&&!m)return;const g=await ee({layer:o,graphic:n,outFields:y,objectIds:c,returnGeometry:m,spatialReference:a},t);g&&(g.geometry&&(n.geometry=g.geometry),g.attributes&&(n.attributes=(0,r.A)((0,r.A)({},n.attributes),g.attributes)))}function ne(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&e.includes(w)}function re(e){let{attributes:t,graphic:n,relatedInfo:r,fieldInfos:i,fieldInfoMap:o,layer:a,timeZone:l}=e;t&&n&&r&&Object.keys(n.attributes).forEach(e=>{const u=function(e){return e?"".concat(w).concat(e.layerId,"/").concat(e.fieldName):""}({layerId:r.relation.id.toString(),fieldName:e}),s=n.attributes[e];t[u]=W({fieldName:u,fieldInfos:i,fieldInfoMap:o,layer:a,value:s,graphic:n,timeZone:l})})}const ie=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},oe=e=>{var t;let{layer:n,method:r,query:i,definitionExpression:o}=e;if(null===(t=n.capabilities)||void 0===t||null===(t=t.query)||void 0===t||!t.supportsCacheHint||"attachments"===r)return;const a=null!=i.where?i.where:null,l=null!=i.geometry?i.geometry:null;ie(o)||ie(a)||"extent"===(null===l||void 0===l?void 0:l.type)||"tile"===i.resultType||(i.cacheHint=!0)},ae=e=>{var t;let{query:n,layer:r,method:i}=e;oe({layer:r,method:i,query:n,definitionExpression:"".concat(r.definitionExpression," ").concat(null!==(t=r.serviceDefinitionExpression)&&void 0!==t?t:"")})},le=e=>{var t;let{queryPayload:n,layer:r,method:i}=e;oe({layer:r,method:i,query:n,definitionExpression:"".concat(r.definitionExpression," ").concat(null!==(t=r.serviceDefinitionExpression)&&void 0!==t?t:"")})};function ue(e,t,n){var r,i;return e&&t&&n?"sublayer"===t.type?fe({layers:null===(r=t.layer)||void 0===r?void 0:r.allSublayers,map:e,relatedLayer:t,relationship:n})||fe({layers:null===(i=t.layer)||void 0===i?void 0:i.subtables,map:e,relatedLayer:t,relationship:n}):fe({layers:e.allLayers,map:e,relatedLayer:t,relationship:n})||fe({layers:e.allTables,map:e,relatedLayer:t,relationship:n}):null}function se(e,t){var n;return e&&"utilityNetworks"in e&&t?null===(n=e.utilityNetworks)||void 0===n?void 0:n.find(e=>e.isUtilityLayer(t)):null}function ce(e,t){return null===e||void 0===e?void 0:e.allTables.find(e=>{var n;return"feature"===e.type&&e.layerId===t.id&&e.url===(null===(n=t.layer)||void 0===n?void 0:n.url)})}function fe(e){let{map:t,relationship:n,relationship:{relatedTableId:r},relatedLayer:i,layers:o}=e;if(!o)return null;for(const l of o){var a;if("map-image"===l.type){const e=fe({layers:l.sublayers,map:t,relatedLayer:i,relationship:n})||fe({layers:l.subtables,map:t,relatedLayer:i,relationship:n});if(e)return e;continue}if(!H(l))continue;if("sublayer"===i.type){if(l!==i&&l.id===r)return l.isTable?ce(t,l):l;continue}const e="scene"===i.type&&i.associatedLayer?i.associatedLayer.url:i.url;if(!e)return null;if("sublayer"!==l.type){if(l!==i&&l.url===e&&l.layerId===r)return l}else if(l!==i&&(null===(a=l.layer)||void 0===a?void 0:a.url)===e&&l.id===r)return l.isTable?ce(t,l):l}return null}},42633:(e,t,n)=>{n.d(t,{EG:()=>y,Ll:()=>I,R3:()=>b,UH:()=>s,aM:()=>h,fs:()=>p,i0:()=>F});var r=n(89379),i=n(65256),o=n(53430),a=(n(86300),n(76386)),l=n(36693),u=n(67478);const s=",",c={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},f=new Set(["integer","small-integer"]);let d=null;function p(e){return(0,o.vE)(e)||(0,o.zD)(e)||(0,o.Ah)(e)}async function y(e){const{field:t,field2:n,field3:r,normalizationField:i,valueExpression:o}=e;let l=[];if(o){if(!d){const{arcadeUtils:e}=await(0,a.l)();d=e}l=d.extractFieldNames(o)}return t&&l.push(t),n&&l.push(n),r&&l.push(r),i&&l.push(i),l}function m(e){return String(e).padStart(2,"0")}function g(e,t,n){let r;return"date"===t||"number"===t?("number"===t&&(e=new Date(e)),r="TIMESTAMP'".concat(n?e.getFullYear():e.getUTCFullYear(),"-").concat(m((n?e.getMonth():e.getUTCMonth())+1),"-").concat(m(n?e.getDate():e.getUTCDate())," ").concat(m(n?e.getHours():e.getUTCHours()),":").concat(m(n?e.getMinutes():e.getUTCMinutes()),":").concat(m(n?e.getSeconds():e.getUTCSeconds()),"'")):r=e,r}function h(e,t,n,r){const{hasQueryEngine:i}=e,o="(".concat(g(n,v(e,n),i)," - ").concat(g(t,v(e,t),i),")");let a=c[r],l="/";return a<1&&(a=1/a,l="*"),{sqlExpression:1===a?o:"(".concat(o," ").concat(l," ").concat(a,")"),sqlWhere:null}}function v(e,t){if(t instanceof Date)return"date";if("number"==typeof t)return"number";if("string"==typeof t){const n=e.getField(t);if("<now>"===t.toLowerCase())return;if((0,o.vE)(n))return"field"}}function b(e,t){const n=t&&e.getField(t);return!!n&&f.has(n.type)}function I(e){return"cast(".concat(e," as float)")}function F(e,t){const{format:n,timeZoneOptions:o,fieldType:a}=null!==t&&void 0!==t?t:{};let s,c;if(o&&({timeZone:s,timeZoneName:c}=(0,u.hv)(o.layerTimeZone,o.datesInUnknownTimezone,o.viewTimeZone,(0,i.J2)(n||"short-date-short-time"),a)),"string"==typeof e&&isNaN(Date.parse("time-only"===a?"1970-01-01T".concat(e,"Z"):e)))return e;switch(a){case"date-only":{const t=(0,i.J2)(n||"short-date");return"string"==typeof e?(0,i.iS)(e,(0,r.A)({},t)):(0,i.Yq)(e,(0,r.A)((0,r.A)({},t),{},{timeZone:l.n$}))}case"time-only":{const t=(0,i.J2)(n||"short-time");return"string"==typeof e?(0,i.F8)(e,t):(0,i.Yq)(e,(0,r.A)((0,r.A)({},t),{},{timeZone:l.n$}))}case"timestamp-offset":{if(!s&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const t=n||o?(0,i.J2)(n||"short-date-short-time"):void 0,a=t?(0,r.A)((0,r.A)({},t),{},{timeZone:s,timeZoneName:c}):void 0;return"string"==typeof e?(0,i.Ey)(e,a):(0,i.Yq)(e,a)}default:{const t=n||o?(0,i.J2)(n||"short-date-short-time"):void 0;return(0,i.Yq)("string"==typeof e?new Date(e):e,t?(0,r.A)((0,r.A)({},t),{},{timeZone:s,timeZoneName:c}):void 0)}}}}}]);
//# sourceMappingURL=9912.b1f9e46b.chunk.js.map