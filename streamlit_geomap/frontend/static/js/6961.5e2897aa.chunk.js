"use strict";(self.webpackChunkstreamlit_geomap_frontend=self.webpackChunkstreamlit_geomap_frontend||[]).push([[6961,7528],{4653:(t,e,n)=>{n.d(e,{x:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"sampler2D",i.c.Bind,(n,i)=>n.bindTexture(t,e(i)))}}},4998:(t,e,n)=>{n.d(e,{TA:()=>x,uH:()=>y});var i=n(15941),r=n(20664),o=n(9392),s=n(71011);function a(t,e,n){(n=n||t).length=t.length;for(let i=0;i<t.length;i++)n[i]=t[i]*e[i];return n}function l(t,e,n){(n=n||t).length=t.length;for(let i=0;i<t.length;i++)n[i]=t[i]*e;return n}function c(t,e,n){(n=n||t).length=t.length;for(let i=0;i<t.length;i++)n[i]=t[i]+e[i];return n}function u(t){return(t+1)*(t+1)}function d(t,e,n){const i=t[0],r=t[1],o=t[2],s=n||[];return s.length=u(e),e>=0&&(s[0]=.28209479177),e>=1&&(s[1]=.4886025119*i,s[2]=.4886025119*o,s[3]=.4886025119*r),e>=2&&(s[4]=1.09254843059*i*r,s[5]=1.09254843059*r*o,s[6]=.31539156525*(3*o*o-1),s[7]=1.09254843059*i*o,s[8]=.54627421529*(i*i-r*r)),s}function h(t,e){const n=u(t),i=e||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=n;for(let r=0;r<n;r++)i.r[r]=i.g[r]=i.b[r]=0;return i}function f(t,e){const n=function(t){return(0,i.qE)(Math.floor(Math.sqrt(t)-1),0,2)}(e.r.length);for(const i of t)(0,r.u)(T,i.direction),d(T,n,_),a(_,E),l(_,i.intensity[0],A),c(e.r,A),l(_,i.intensity[1],A),c(e.g,A),l(_,i.intensity[2],A),c(e.b,A);return e}function v(t,e){d(T,0,_);for(const n of t)e.r[0]+=_[0]*E[0]*n.intensity[0]*4*Math.PI,e.g[0]+=_[0]*E[0]*n.intensity[1]*4*Math.PI,e.b[0]+=_[0]*E[0]*n.intensity[2]*4*Math.PI;return e}const p=[],m=[],g=[],_=[0],A=[0],T=(0,o.vt)(),E=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class S{constructor(){this.color=(0,o.vt)(),this.intensity=1}}class b{constructor(){this.direction=(0,o.vt)(),this.ambient=new S,this.diffuse=new S}}const y=.4;class x{constructor(){this._shOrder=2,this._legacy=new b,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new s.e_,this._mainLight=new s.Qx((0,o.vt)(),(0,o.fA)(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(t){(function(t,e,n,i){h(e,i),(0,r.i)(n.intensity,0,0,0);let o=!1;const a=p,l=m,u=g;a.length=0,l.length=0,u.length=0;for(const c of t)c instanceof s.Qx&&!o?((0,r.c)(n.direction,c.direction),(0,r.c)(n.intensity,c.intensity),n.specularStrength=c.specularStrength,n.environmentStrength=c.environmentStrength,n.castShadows=c.castShadows,o=!0):c instanceof s.Qx||c instanceof s._y?a.push(c):c instanceof s.$p?l.push(c):c instanceof s.e_&&u.push(c);f(a,i),v(l,i);for(const r of u)c(i.r,r.r),c(i.g,r.g),c(i.b,r.b)})(t,this._shOrder,this._mainLight,this._sphericalHarmonics),(0,r.c)(this._legacy.direction,this._mainLight.direction);const e=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*e,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*e,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*e,(0,r.g)(this._legacy.diffuse.color,this._mainLight.intensity,e),(0,r.c)(O,this._legacy.diffuse.color),(0,r.g)(O,O,y*this.globalFactor),(0,r.f)(this._legacy.ambient.color,this._legacy.ambient.color,O)}copyFrom(t){this._sphericalHarmonics.r=Array.from(t.sh.r),this._sphericalHarmonics.g=Array.from(t.sh.g),this._sphericalHarmonics.b=Array.from(t.sh.b),(0,r.c)(this._mainLight.direction,t.mainLight.direction),(0,r.c)(this._mainLight.intensity,t.mainLight.intensity),this._mainLight.castShadows=t.mainLight.castShadows,this._mainLight.specularStrength=t.mainLight.specularStrength,this._mainLight.environmentStrength=t.mainLight.environmentStrength,this.globalFactor=t.globalFactor,this.noonFactor=t.noonFactor}lerpLighting(t,e,n){if((0,r.m)(this._mainLight.intensity,t.mainLight.intensity,e.mainLight.intensity,n),this._mainLight.environmentStrength=(0,i.Cc)(t.mainLight.environmentStrength,e.mainLight.environmentStrength,n),this._mainLight.specularStrength=(0,i.Cc)(t.mainLight.specularStrength,e.mainLight.specularStrength,n),(0,r.c)(this._mainLight.direction,e.mainLight.direction),this._mainLight.castShadows=e.mainLight.castShadows,this.globalFactor=(0,i.Cc)(t.globalFactor,e.globalFactor,n),this.noonFactor=(0,i.Cc)(t.noonFactor,e.noonFactor,n),t.sh.r.length===e.sh.r.length)for(let r=0;r<e.sh.r.length;r++)this._sphericalHarmonics.r[r]=(0,i.Cc)(t.sh.r[r],e.sh.r[r],n),this._sphericalHarmonics.g[r]=(0,i.Cc)(t.sh.g[r],e.sh.g[r],n),this._sphericalHarmonics.b[r]=(0,i.Cc)(t.sh.b[r],e.sh.b[r],n);else for(let i=0;i<e.sh.r.length;i++)this._sphericalHarmonics.r[i]=e.sh.r[i],this._sphericalHarmonics.g[i]=e.sh.g[i],this._sphericalHarmonics.b[i]=e.sh.b[i]}}const O=(0,o.vt)()},5517:(t,e,n)=>{n.d(e,{t:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"vec3",i.c.Pass,(n,i,r)=>n.setUniform3fv(t,e(i,r)))}}},6381:(t,e,n)=>{function i(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":case"f16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}n.d(e,{GJ:()=>i})},6485:(t,e,n)=>{n.d(e,{K:()=>a,W:()=>l});var i=n(50076),r=n(18690);class o{constructor(t){this._bits=[...t]}equals(t){return(0,r.aI)(this._bits,t.bits)}get code(){var t;return null!==(t=this._code)&&void 0!==t||(this._code=String.fromCharCode(...this._bits)),this._code}get bits(){return this._bits}}var s=n(31432);class a extends s.Y{constructor(){var t,e,n;super(),this._parameterBits=null!==(t=null===(e=this._parameterBits)||void 0===e?void 0:e.map(()=>0))&&void 0!==t?t:[],null!==(n=this._parameterNames)&&void 0!==n||(this._parameterNames=[])}get key(){var t;return null!==(t=this._key)&&void 0!==t||(this._key=new o(this._parameterBits)),this._key}decode(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.key;const e=this._parameterBits;this._parameterBits=[...t.bits];const n=this._parameterNames.map(t=>"    ".concat(t,": ").concat(this[t])).join("\n");return this._parameterBits=e,n}}function l(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(e,n)=>{var r,o,s,a;e.hasOwnProperty("_parameterNames")||Object.defineProperty(e,"_parameterNames",{value:null!==(r=null===(o=e._parameterNames)||void 0===o?void 0:o.slice())&&void 0!==r?r:[],configurable:!0,writable:!0}),e.hasOwnProperty("_parameterBits")||Object.defineProperty(e,"_parameterBits",{value:null!==(s=null===(a=e._parameterBits)||void 0===a?void 0:a.slice())&&void 0!==s?s:[0],configurable:!0,writable:!0}),e._parameterNames.push(n);const l=t.count||2,c=Math.ceil(Math.log2(l)),u=e._parameterBits;let d=0;for(;u[d]+c>16;)d++,d>=u.length&&u.push(0);const h=u[d],f=(1<<c)-1<<h;u[d]+=c,t.count?Object.defineProperty(e,n,{get(){return(this._parameterBits[d]&f)>>h},set(e){if(this[n]!==e){if(this._key=null,this._parameterBits[d]=this._parameterBits[d]&~f|+e<<h&f,"number"!=typeof e)throw new i.A("internal:invalid-shader-configuration","Configuration value for ".concat(n," must be a number, got ").concat(typeof e));if(null==t.count)throw new i.A("internal:invalid-shader-configuration","Configuration value for ".concat(n," must provide a count option"))}}}):Object.defineProperty(e,n,{get(){return!!((this._parameterBits[d]&f)>>h)},set(t){if(this[n]!==t&&(this._key=null,this._parameterBits[d]=this._parameterBits[d]&~f|+t<<h&f,"boolean"!=typeof t))throw new i.A("internal:invalid-shader-configuration","Configuration value for ".concat(n," must be boolean, got ").concat(typeof t))}})}}},9937:(t,e,n)=>{n.d(e,{n:()=>r});var i=n(6485);class r extends i.K{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}}},12028:(t,e,n)=>{n.d(e,{MD:()=>l,cJ:()=>a,hs:()=>c,m0:()=>s});var i=n(15941),r=(n(79650),n(78315));n(64465);function o(t,e,n){const i=n.parameters;return u.scale=Math.min(i.divisor/(e-i.offset),1),u.factor=function(t){return Math.abs(t*t*t)}(t),u}function s(t,e){return(0,i.Cc)(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function a(t,e,n,i){i.scale=function(t,e,n){const i=o(t,e,n);return i.minScaleFactor=0,s(1,i)}(t,e,n),i.factor=0,i.minScaleFactor=n.minScaleFactor}function l(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0];const i=Math.min(Math.max(e.scale,e.minScaleFactor),1);return n[0]=t[0]*i,n[1]=t[1]*i,n}function c(t,e,n,i){return s(t,o(e,n,i))}(0,i.kU)(10),(0,i.kU)(12),(0,i.kU)(70),(0,i.kU)(40);const u={scale:0,factor:0,minScaleFactor:0};(0,r.c)()},16506:(t,e,n)=>{n.d(e,{$:()=>i});class i{constructor(t,e){this._module=t,this._load=e}get(){return this._module}async reload(){return this._module=await this._load(),this._module}}},17345:(t,e,n)=>{n.d(e,{V:()=>E});var i=n(89379),r=n(90632),o=n(13191),s=n(20664),a=n(38496),l=n(19059),c=n(85086),u=n(9392),d=n(45097);const h=(0,u.vt)(),f=(0,u.vt)(),v=(0,u.vt)(),p=(0,u.vt)();var m=n(34017),g=n(35416),_=n(86994),A=n(66470),T=n(61678);class E{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m.d.Mesh,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;this.material=t,this.mapPositions=n,this.type=o,this.objectAndLayerIdColor=s,this.edgeIndicesLength=l,this.highlights=new Set,this._highlightOptionsCounts=new Map,this.id=(0,r.c)(),this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[r,c]of e)this._attributes.set(r,(0,i.A)((0,i.A)({},c),{},{indices:(0,a.Dg)(c.indices)})),r===A.r.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(r).indices.length:this.edgeIndicesLength)}instantiate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=new E(t.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((t,n)=>{t.exclusive=!1,e._attributes.set(n,t)}),e._boundingInfo=this._boundingInfo,e.transformation=t.transformation||this.transformation,e}get attributes(){return this._attributes}getMutableAttribute(t){let e=this._attributes.get(t);return e&&!e.exclusive&&(e=(0,i.A)((0,i.A)({},e),{},{exclusive:!0,data:(0,l.S)(e.data)}),this._attributes.set(t,e)),e}setAttributeData(t,e){const n=this._attributes.get(t);n?this._attributes.set(t,(0,i.A)((0,i.A)({},n),{},{exclusive:!0,data:e})):(0,T.en)()&&console.warn("Setting undefined attribute ".concat(t," data"))}get indexCount(){var t,e;const n=null===(t=this._attributes.values().next().value)||void 0===t?void 0:t.indices;return null!==(e=null===n||void 0===n?void 0:n.length)&&void 0!==e?e:0}get faceCount(){return this.indexCount/3}get boundingInfo(){var t;return null!==(t=this._boundingInfo)&&void 0!==t||(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return!!(this.type===m.d.Mesh?this._computeAttachmentOriginTriangles(t):this.type===m.d.Line?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(null!=this._transformation&&(0,s.t)(t,t,this._transformation),!0)}_computeAttachmentOriginTriangles(t){return function(t,e){if(!t)return!1;const{size:n,data:i,indices:r}=t;(0,s.i)(e,0,0,0),(0,s.i)(p,0,0,0);let o=0,a=0;for(let l=0;l<r.length-2;l+=3){const t=r[l]*n,c=r[l+1]*n,u=r[l+2]*n;(0,s.i)(h,i[t],i[t+1],i[t+2]),(0,s.i)(f,i[c],i[c+1],i[c+2]),(0,s.i)(v,i[u],i[u+1],i[u+2]);const m=(0,d.Q7)(h,f,v);m?((0,s.f)(h,h,f),(0,s.f)(h,h,v),(0,s.g)(h,h,1/3*m),(0,s.f)(e,e,h),o+=m):((0,s.f)(p,p,h),(0,s.f)(p,p,f),(0,s.f)(p,p,v),a+=3)}return(0!==a||0!==o)&&(0!==o?((0,s.g)(e,e,1/o),!0):0!==a&&((0,s.g)(e,p,1/a),!0))}(this.attributes.get(A.r.POSITION),t)}_computeAttachmentOriginLines(t){const e=this.attributes.get(A.r.POSITION);return function(t,e,n){if(!t)return!1;(0,s.i)(n,0,0,0),(0,s.i)(p,0,0,0);let i=0,r=0;const{size:o,data:a,indices:l}=t,c=l.length-1,u=c+(e?2:0);for(let d=0;d<u;d+=2){const t=d<c?d+1:0,e=l[d<c?d:c]*o,u=l[t]*o;h[0]=a[e],h[1]=a[e+1],h[2]=a[e+2],f[0]=a[u],f[1]=a[u+1],f[2]=a[u+2],(0,s.g)(h,(0,s.f)(h,h,f),.5);const v=(0,s.F)(h,f);v>0?((0,s.f)(n,n,(0,s.g)(h,h,v)),i+=v):0===i&&((0,s.f)(p,p,h),r++)}return 0!==i?((0,s.g)(n,n,1/i),!0):0!==r&&((0,s.g)(n,p,1/r),!0)}(e,function(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}(this.material.parameters,e),t)}_computeAttachmentOriginPoints(t){return function(t,e){if(!t)return!1;const{size:n,data:i,indices:r}=t;(0,s.i)(e,0,0,0);let o=-1,a=0;for(let s=0;s<r.length;s++){const t=r[s]*n;o!==t&&(e[0]+=i[t],e[1]+=i[t+1],e[2]+=i[t+2],a++),o=t}return a>1&&(0,s.g)(e,e,1/a),a>0}(this.attributes.get(A.r.POSITION),t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.attributes.get(A.r.POSITION);if(!t||0===t.indices.length)return null;const e=this.type===m.d.Mesh?3:1;(0,_.vA)(t.indices.length%e===0,"Indexing error: "+t.indices.length+" not divisible by "+e);const n=(0,a.tM)(t.indices.length/e);return new c.j(n,e,t)}get transformation(){var t;return null!==(t=this._transformation)&&void 0!==t?t:o.zK}set transformation(t){this._transformation=t&&t!==o.zK?(0,o.o8)(t):null}get highlightNames(){return this._highlightOptionsCounts}get hasHighlights(){return this._highlightOptionsCounts.size>0}foreachHighlightOptions(t){this._highlightOptionsCounts.forEach((e,n)=>t(n))}allocateIdAndHighlight(t){const e=new g.h(t);return this.addHighlight(e)}addHighlight(t){var e;this.highlights.add(t);const{highlightName:n}=t,i=(null!==(e=this._highlightOptionsCounts.get(n))&&void 0!==e?e:0)+1;return this._highlightOptionsCounts.set(n,i),t}removeHighlight(t){if(this.highlights.delete(t)){var e;const{highlightName:n}=t,i=null!==(e=this._highlightOptionsCounts.get(n))&&void 0!==e?e:0;i<=1?this._highlightOptionsCounts.delete(n):this._highlightOptionsCounts.set(n,i-1)}}}},19059:(t,e,n)=>{n.d(e,{S:()=>o});var i=n(78393),r=n(62984);function o(t){if(t.length<i.y9)return Array.from(t);if(Array.isArray(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return(0,i.LW)(t)?(0,r.pX)().from(t):(0,i.jq)(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}},19771:(t,e,n)=>{n.d(e,{J:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"float",i.c.Draw,(n,i,r)=>n.setUniform1f(t,e(i,r)))}}},21390:(t,e,n)=>{n.d(e,{m:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"float",i.c.Pass,(n,i,r)=>n.setUniform1f(t,e(i,r)))}}},22955:(t,e,n)=>{n.d(e,{b:()=>l});var i=n(35143),r=n(91967),o=n(46053),s=(n(81806),n(76460),n(47249),n(85842));let a=class extends r.A{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};(0,i._)([(0,o.MZ)()],a.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"DECONFLICTOR_SHOW_GRID",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"LABELS_SHOW_BORDER",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"TEXT_SHOW_BASELINE",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"TEXT_SHOW_BORDER",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"OVERLAY_SHOW_CENTER",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"SHOW_POI",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"I3S_TREE_SHOW_TILES",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"I3S_SHOW_MODIFICATIONS",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"LINE_WIREFRAMES",void 0),a=(0,i._)([(0,s.$)("esri.views.3d.support.debugFlags")],a);const l=new a},23079:(t,e,n)=>{n.d(e,{i:()=>r});var i=n(79053);function r(t,e){return new Promise((n,r)=>{t.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?n():(e((0,i.Oo)(t,"canplay",n)),e((0,i.Oo)(t,"error",r)))})}},23148:(t,e,n)=>{n.d(e,{U:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"float",i.c.Bind,(n,i)=>n.setUniform1f(t,e(i)))}}},23687:(t,e,n)=>{n.d(e,{F:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"mat4",i.c.Bind,(n,i)=>n.setUniformMatrix4fv(t,e(i)))}}},25530:(t,e,n)=>{n.d(e,{G:()=>m,V:()=>_});var i,r,o,s,a,l,c=n(57528),u=n(43047),d=n(55855),h=n(69817),f=n(42451),v=n(58350),p=n(86955);function m(t,e){const n=t.vertex;e.hasVerticalOffset?(_(n),e.hasScreenSizePerspective&&(t.include(h.Y6),(0,h.OH)(n),(0,f.yu)(t.vertex,e)),n.code.add((0,p.H)(i||(i=(0,c.A)(["\n      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n        ","\n        ","\n        // Screen sized offset in world space, used for example for line callouts\n        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n        return worldNormal * worldOffset;\n      }\n\n      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n        return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n      }\n    "])),e.spherical?(0,p.H)(r||(r=(0,c.A)(["vec3 worldNormal = normalize(worldPos + localOrigin);"]))):(0,p.H)(o||(o=(0,c.A)(["vec3 worldNormal = vec3(0.0, 0.0, 1.0);"]))),e.hasScreenSizePerspective?(0,p.H)(s||(s=(0,c.A)(["\n            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));\n            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"]))):(0,p.H)(a||(a=(0,c.A)(["\n            float verticalOffsetScreenHeight = verticalOffset.x;"])))))):n.code.add((0,p.H)(l||(l=(0,c.A)(["vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }"]))))}const g=(0,d.vt)();function _(t){t.uniforms.add(new v.E("verticalOffset",(t,e)=>{const{minWorldLength:n,maxWorldLength:i,screenLength:r}=t.verticalOffset,o=Math.tan(.5*e.camera.fovY)/(.5*e.camera.fullViewport[3]),s=e.camera.pixelRatio||1;return(0,u.s)(g,r*s,o,n,i)}))}},26719:(t,e,n)=>{n.d(e,{A9:()=>c,_Z:()=>A});var i,r,o,s,a,l,c,u=n(57528),d=n(95352),h=n(72468),f=n(5517),v=n(86955),p=n(27374),m=n(70367),g=(n(78992),n(69728)),_=n(31432);!function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Simplified=5]="Simplified",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"}(c||(c={}));_.Y;function A(t,e){const n=e.pbrMode,_=t.fragment;if(n!==c.Schematic&&n!==c.Disabled&&n!==c.Normal)return void _.code.add((0,v.H)(i||(i=(0,u.A)(["void applyPBRFactors() {}"]))));if(n===c.Disabled)return void _.code.add((0,v.H)(r||(r=(0,u.A)(["void applyPBRFactors() {}\nfloat getBakedOcclusion() { return 1.0; }"]))));if(n===c.Schematic)return void _.code.add((0,v.H)(o||(o=(0,u.A)(["vec3 mrr = vec3(0.0, 0.6, 0.2);\nfloat occlusion = 1.0;\nvoid applyPBRFactors() {}\nfloat getBakedOcclusion() { return 1.0; }"]))));const{hasMetallicRoughnessTexture:A,hasMetallicRoughnessTextureTransform:T,hasOcclusionTexture:E,hasOcclusionTextureTransform:S,bindType:b}=e;(A||E)&&t.include(d.r,e),_.code.add((0,v.H)(s||(s=(0,u.A)(["vec3 mrr;\nfloat occlusion;"])))),A&&_.uniforms.add(b===g.c.Pass?new m.N("texMetallicRoughness",t=>t.textureMetallicRoughness):new p.o("texMetallicRoughness",t=>t.textureMetallicRoughness)),E&&_.uniforms.add(b===g.c.Pass?new m.N("texOcclusion",t=>t.textureOcclusion):new p.o("texOcclusion",t=>t.textureOcclusion)),_.uniforms.add(b===g.c.Pass?new f.t("mrrFactors",t=>t.mrrFactors):new h.W("mrrFactors",t=>t.mrrFactors)),_.code.add((0,v.H)(a||(a=(0,u.A)(["\n    ","\n\n    ","\n\n    float getBakedOcclusion() {\n      return ",";\n    }\n\n    void applyPBRFactors() {\n      mrr = mrrFactors;\n      occlusion = 1.0;\n\n      ","\n      ","\n    }\n  "])),(0,v.If)(A,(0,v.H)(l||(l=(0,u.A)(["void applyMetallicRoughness(vec2 uv) {\n            vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;\n            mrr[0] *= metallicRoughness.b;\n            mrr[1] *= metallicRoughness.g;\n          }"])))),(0,v.If)(E,"void applyOcclusion(vec2 uv) { occlusion *= textureLookup(texOcclusion, uv).r; }"),E?"occlusion":"1.0",(0,v.If)(A,"applyMetallicRoughness(".concat(T?"metallicRoughnessUV":"vuv0",");")),(0,v.If)(E,"applyOcclusion(".concat(S?"occlusionUV":"vuv0",");"))))}},26917:(t,e,n)=>{n.d(e,{HQ:()=>f,rA:()=>v});var i,r,o=n(57528),s=n(34761),a=n(13191),l=n(20664),c=n(9392),u=n(72468),d=(n(5517),n(86955)),h=n(31432);h.Y;function f(t,e){g(t,e,new u.W("slicePlaneOrigin",(t,n)=>E(e,t,n)),new u.W("slicePlaneBasis1",(t,n)=>{var i;return S(e,t,n,null===(i=n.slicePlane)||void 0===i?void 0:i.basis1)}),new u.W("slicePlaneBasis2",(t,n)=>{var i;return S(e,t,n,null===(i=n.slicePlane)||void 0===i?void 0:i.basis2)}))}function v(t,e){m(t,e,new u.W("slicePlaneOrigin",(t,n)=>E(e,t,n)),new u.W("slicePlaneBasis1",(t,n)=>{var i;return S(e,t,n,null===(i=n.slicePlane)||void 0===i?void 0:i.basis1)}),new u.W("slicePlaneBasis2",(t,n)=>{var i;return S(e,t,n,null===(i=n.slicePlane)||void 0===i?void 0:i.basis2)}))}const p=(0,d.H)(i||(i=(0,o.A)(["struct SliceFactors {\nfloat front;\nfloat side0;\nfloat side1;\nfloat side2;\nfloat side3;\n};\nSliceFactors calculateSliceFactors(vec3 pos) {\nvec3 rel = pos - slicePlaneOrigin;\nvec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\nfloat slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\nfloat basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\nfloat basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\nfloat basis1Dot = dot(slicePlaneBasis1, rel);\nfloat basis2Dot = dot(slicePlaneBasis2, rel);\nreturn SliceFactors(\ndot(slicePlaneNormal, pos) + slicePlaneW,\n-basis1Dot - basis1Len2,\nbasis1Dot - basis1Len2,\n-basis2Dot - basis2Len2,\nbasis2Dot - basis2Len2\n);\n}\nbool sliceByFactors(SliceFactors factors) {\nreturn factors.front < 0.0\n&& factors.side0 < 0.0\n&& factors.side1 < 0.0\n&& factors.side2 < 0.0\n&& factors.side3 < 0.0;\n}\nbool sliceEnabled() {\nreturn dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n}\nbool sliceByPlane(vec3 pos) {\nreturn sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n}\nbool rejectBySlice(vec3 pos) {\nreturn sliceByPlane(pos);\n}"])));function m(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];e.hasSlicePlane?(t.uniforms.add(...i),t.code.add(p)):t.code.add("bool rejectBySlice(vec3 pos) { return false; }")}function g(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];m(t,e,...i),e.hasSlicePlane?t.code.add("\n    void discardBySlice(vec3 pos) {\n      if (sliceByPlane(pos)) {\n        discard;\n      }\n    }\n\n    vec4 applySliceOutline(vec4 color, vec3 pos) {\n      SliceFactors factors = calculateSliceFactors(pos);\n\n      factors.front /= 2.0 * fwidth(factors.front);\n      factors.side0 /= 2.0 * fwidth(factors.side0);\n      factors.side1 /= 2.0 * fwidth(factors.side1);\n      factors.side2 /= 2.0 * fwidth(factors.side2);\n      factors.side3 /= 2.0 * fwidth(factors.side3);\n\n      // return after calling fwidth, to avoid aliasing caused by discontinuities in the input to fwidth\n      if (sliceByFactors(factors)) {\n        return color;\n      }\n\n      float outlineFactor = (1.0 - step(0.5, factors.front))\n        * (1.0 - step(0.5, factors.side0))\n        * (1.0 - step(0.5, factors.side1))\n        * (1.0 - step(0.5, factors.side2))\n        * (1.0 - step(0.5, factors.side3));\n\n      return mix(color, vec4(vec3(0.0), color.a), outlineFactor * 0.3);\n    }\n\n    vec4 applySlice(vec4 color, vec3 pos) {\n      return sliceEnabled() ? applySliceOutline(color, pos) : color;\n    }\n  "):t.code.add((0,d.H)(r||(r=(0,o.A)(["void discardBySlice(vec3 pos) { }\nvec4 applySlice(vec4 color, vec3 pos) { return color; }"]))))}function _(t,e,n){return t.instancedDoublePrecision?(0,l.i)(b,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function A(t,e){return null!=t?(0,l.d)(y,e.origin,t):e.origin}function T(t,e,n){return t.hasSliceTranslatedView?null!=e?(0,s.Tl)(O,n.camera.viewMatrix,e):n.camera.viewMatrix:null}function E(t,e,n){if(null==n.slicePlane)return c.uY;const i=_(t,e,n),r=A(i,n.slicePlane),o=T(t,i,n);return null!=o?(0,l.t)(y,r,o):r}function S(t,e,n,i){if(null==i||null==n.slicePlane)return c.uY;const r=_(t,e,n),o=A(r,n.slicePlane),s=T(t,r,n);return null!=s?((0,l.f)(x,i,o),(0,l.t)(y,o,s),(0,l.t)(x,x,s),(0,l.d)(x,x,y)):i}const b=(0,c.vt)(),y=(0,c.vt)(),x=(0,c.vt)(),O=(0,a.vt)()},27374:(t,e,n)=>{n.d(e,{o:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"sampler2D",i.c.Draw,(n,i,r)=>n.bindTexture(t,e(i,r)))}}},27963:(t,e,n)=>{n.d(e,{Ir:()=>h});var i,r=n(57528),o=n(19555),s=n(72745),a=n(43047),l=n(55855),c=n(28450),u=n(51596),d=n(86955);function h(t){t.fragment.uniforms.add(new u.I("projInfo",t=>function(t){const e=t.projectionMatrix;return 0===e[11]?(0,a.s)(f,2/(t.fullWidth*e[0]),2/(t.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):(0,a.s)(f,-2/(t.fullWidth*e[0]),-2/(t.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}(t.camera))),t.fragment.uniforms.add(new c.E("zScale",t=>function(t){return 0===t.projectionMatrix[11]?(0,o.hZ)(v,0,1):(0,o.hZ)(v,1,0)}(t.camera))),t.fragment.code.add((0,d.H)(i||(i=(0,r.A)(["vec3 reconstructPosition(vec2 fragCoord, float depth) {\nreturn vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n}"]))))}const f=(0,l.vt)();const v=(0,s.vt)()},28450:(t,e,n)=>{n.d(e,{E:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"vec2",i.c.Bind,(n,i)=>n.setUniform2fv(t,e(i)))}}},31432:(t,e,n)=>{n.d(e,{Y:()=>i});const i=class{};new i},32119:(t,e,n)=>{n.d(e,{D:()=>r});var i=n(66470);const r=new Map([[i.r.POSITION,0],[i.r.NORMAL,1],[i.r.NORMALCOMPRESSED,1],[i.r.UV0,2],[i.r.UVI,2],[i.r.COLOR,3],[i.r.COLORFEATUREATTRIBUTE,3],[i.r.SIZE,4],[i.r.TANGENT,4],[i.r.CENTEROFFSETANDDISTANCE,5],[i.r.SYMBOLCOLOR,5],[i.r.FEATUREATTRIBUTE,6],[i.r.INSTANCEFEATUREATTRIBUTE,6],[i.r.OLIDCOLOR,6],[i.r.INSTANCEOBJECTANDLAYERIDCOLOR,6],[i.r.INSTANCECOLOR,7],[i.r.ROTATION,8],[i.r.INSTANCEMODEL,8],[i.r.INSTANCEMODELNORMAL,12],[i.r.INSTANCEMODELORIGINHI,11],[i.r.INSTANCEMODELORIGINLO,15]])},34017:(t,e,n)=>{var i;n.d(e,{d:()=>i}),function(t){t[t.Mesh=0]="Mesh",t[t.Point=1]="Point",t[t.Line=2]="Line"}(i||(i={}))},34981:(t,e,n)=>{var i;function r(t){return t===i.Shadow||t===i.ShadowHighlight||t===i.ShadowExcludeHighlight||t===i.ViewshedShadow}function o(t){return function(t){return p(t)||_(t)}(t)||t===i.Normal}function s(t){return g(t)||t===i.Normal}function a(t){return t===i.Highlight||t===i.ObjectAndLayerIdColor}function l(t){return c(t)||a(t)}function c(t){return t===i.Color}function u(t){return c(t)||A(t)}function d(t){return c(t)||t===i.ObjectAndLayerIdColor}function h(t){return u(t)||t===i.ObjectAndLayerIdColor}function f(t){return c(t)||t===i.Highlight}function v(t){return f(t)||_(t)}function p(t){return c(t)||a(t)}function m(t){return u(t)||a(t)}function g(t){return m(t)||_(t)}function _(t){return t===i.Depth}function A(t){return t===i.ColorEmission}function T(t){switch(t){case i.Depth:case i.Shadow:case i.ShadowHighlight:case i.ShadowExcludeHighlight:case i.ViewshedShadow:return!0}return!1}n.d(e,{CL:()=>a,LG:()=>A,Mb:()=>m,PJ:()=>r,QG:()=>h,RN:()=>u,T2:()=>g,V:()=>i,Vg:()=>T,XY:()=>o,_o:()=>c,aD:()=>v,dX:()=>p,eh:()=>_,i3:()=>l,iq:()=>s,zW:()=>d}),function(t){t[t.Color=0]="Color",t[t.ColorEmission=1]="ColorEmission",t[t.Depth=2]="Depth",t[t.Normal=3]="Normal",t[t.Shadow=4]="Shadow",t[t.ShadowHighlight=5]="ShadowHighlight",t[t.ShadowExcludeHighlight=6]="ShadowExcludeHighlight",t[t.ViewshedShadow=7]="ViewshedShadow",t[t.Highlight=8]="Highlight",t[t.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor",t[t.COUNT=10]="COUNT"}(i||(i={}))},35416:(t,e,n)=>{n.d(e,{h:()=>s,p:()=>a});var i=n(90632),r=n(83490);class o{constructor(){this.uid=(0,i.c)()}}class s extends o{constructor(t){super(),this.highlightName=t,this.channel=r.Mg.Highlight}}class a extends o{constructor(){super(...arguments),this.channel=r.Mg.MaskOccludee}}},36324:(t,e,n)=>{function i(t){const e=.3183098861837907;t.constants.add("PI","float",3.141592653589793),t.constants.add("LIGHT_NORMALIZATION","float",e),t.constants.add("INV_PI","float",e),t.constants.add("HALF_PI","float",1.570796326794897),t.constants.add("TWO_PI","float",6.28318530717958)}n.d(e,{p:()=>i})},36358:(t,e,n)=>{n.d(e,{EM:()=>y,dO:()=>b,em:()=>S});var i,r,o,s,a,l,c=n(57528),u=n(44680),d=n(13191),h=n(9392),f=n(89299),v=n(72468),p=n(5517),m=n(86955),g=n(42759),_=n(72106),A=n(43425),T=n(66470),E=n(31432);function S(t,e){const{attributes:n,vertex:u,varyings:d,fragment:h}=t;u.include(f.u,e),n.add(T.r.POSITION,"vec3"),d.add("vPositionWorldCameraRelative","vec3"),d.add("vPosition_view","vec3",{invariant:!0}),u.uniforms.add(new p.t("transformWorldFromViewTH",t=>t.transformWorldFromViewTH),new p.t("transformWorldFromViewTL",t=>t.transformWorldFromViewTL),new _.k("transformViewFromCameraRelativeRS",t=>t.transformViewFromCameraRelativeRS),new A.X("transformProjFromView",t=>t.transformProjFromView),new g.h("transformWorldFromModelRS",t=>t.transformWorldFromModelRS),new v.W("transformWorldFromModelTH",t=>t.transformWorldFromModelTH),new v.W("transformWorldFromModelTL",t=>t.transformWorldFromModelTL)),u.code.add((0,m.H)(i||(i=(0,c.A)(["vec3 positionWorldCameraRelative() {\nvec3 rotatedModelPosition = transformWorldFromModelRS * position;\nvec3 transform_CameraRelativeFromModel = dpAdd(\ntransformWorldFromModelTL,\ntransformWorldFromModelTH,\n-transformWorldFromViewTL,\n-transformWorldFromViewTH\n);\nreturn transform_CameraRelativeFromModel + rotatedModelPosition;\n}"])))),u.code.add((0,m.H)(r||(r=(0,c.A)(["\n    void forwardPosition(float fOffset) {\n      vPositionWorldCameraRelative = positionWorldCameraRelative();\n      if (fOffset != 0.0) {\n        vPositionWorldCameraRelative += fOffset * ",";\n      }\n\n      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;\n      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);\n    }\n  "])),e.spherical?(0,m.H)(o||(o=(0,c.A)(["normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)"]))):(0,m.H)(s||(s=(0,c.A)(["vec3(0.0, 0.0, 1.0)"]))))),h.uniforms.add(new p.t("transformWorldFromViewTL",t=>t.transformWorldFromViewTL)),u.code.add((0,m.H)(a||(a=(0,c.A)(["vec3 positionWorld() {\nreturn transformWorldFromViewTL + vPositionWorldCameraRelative;\n}"])))),h.code.add((0,m.H)(l||(l=(0,c.A)(["vec3 positionWorld() {\nreturn transformWorldFromViewTL + vPositionWorldCameraRelative;\n}"]))))}class b extends E.Y{constructor(){super(...arguments),this.transformWorldFromViewTH=(0,h.vt)(),this.transformWorldFromViewTL=(0,h.vt)(),this.transformViewFromCameraRelativeRS=(0,u.vt)(),this.transformProjFromView=(0,d.vt)()}}class y extends E.Y{constructor(){super(...arguments),this.transformWorldFromModelRS=(0,u.vt)(),this.transformWorldFromModelTH=(0,h.vt)(),this.transformWorldFromModelTL=(0,h.vt)()}}},36451:(t,e,n)=>{n.d(e,{A:()=>d});var i=n(35143),r=n(91967),o=n(50076),s=n(68134),a=n(46053),l=n(85842),c=n(90364),u=n(83490);let d=class extends r.A{constructor(t){super(t),this.view=null,this.consumes={required:[]},this.produces=c.hM.COMPOSITE,this.requireGeometryDepth=!1,this._dirty=!0}initialize(){this.addHandles([(0,s.wB)(()=>this.view.ready,t=>{var e;t&&(null===(e=this.view.stage)||void 0===e||e.renderer.addRenderNode(this))},s.Vh)])}destroy(){var t;null===(t=this.view.stage)||void 0===t||null===(t=t.renderer)||void 0===t||t.removeRenderNode(this)}precompile(){}render(){throw new o.A("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view.stage.renderView.renderingContext.gl}get techniques(){return this.view.stage.renderView.techniques}acquireOutputFramebuffer(){var t,e,n,i;const r=null===(t=this._frameBuffer)||void 0===t||null===(t=t.getTexture())||void 0===t?void 0:t.descriptor,o=this.view.stage.renderer.fboCache.acquire(null!==(e=null===r||void 0===r?void 0:r.width)&&void 0!==e?e:640,null!==(n=null===r||void 0===r?void 0:r.height)&&void 0!==n?n:480,this.produces);return null!==(i=o.fbo)&&void 0!==i&&i.initializeAndBind(),o}bindRenderTarget(){var t;return null!==(t=this._frameBuffer)&&void 0!==t&&null!==(t=t.fbo)&&void 0!==t&&t.initializeAndBind(),this._frameBuffer}requestRender(t){var e;t===u.C7.UPDATE&&null!==(e=this.view.stage)&&void 0!==e&&e.renderView.requestRender(t),this._dirty=!0}resetWebGLState(){var t;this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(null===(t=this._frameBuffer)||void 0===t?void 0:t.fbo)}get fboCache(){return this.view.stage.renderer.fboCache}get bindParameters(){return this.renderContext.bind}get renderingContext(){return this.view.stage.renderView.renderingContext}get renderContext(){var t;return null===(t=this.view.stage)||void 0===t?void 0:t.renderer.renderContext}updateAnimation(t){return!!this._dirty&&(this._dirty=!1,!0)}doRender(t){this._frameBuffer=t.find(t=>{let{name:e}=t;return e===this.produces});try{return this.render(t)}finally{this._frameBuffer=null}}};(0,i._)([(0,a.MZ)({constructOnly:!0})],d.prototype,"view",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],d.prototype,"consumes",void 0),(0,i._)([(0,a.MZ)()],d.prototype,"produces",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],d.prototype,"techniques",null),d=(0,i._)([(0,l.$)("esri.views.3d.webgl.RenderNode")],d)},38496:(t,e,n)=>{n.d(e,{Dg:()=>o,EH:()=>v,JH:()=>a,my:()=>s,tM:()=>d,uW:()=>r});var i=n(78393);function r(t){return o(t,!0)}function o(t,e){if(Array.isArray(t)){if(t.length<i.y9)return t}else if(t.length<i.y9)return Array.from(t);let n=!0,r=!0;return t.some((t,e)=>(n=n&&0===t,r=r&&t===e,!n&&!r)),n?v(t.length):r?d(t.length):(0,i.iu)(t)&&t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?t:function(t,e){for(const n of t){if(n>=65536)return(0,i.iu)(t)?t:new Uint32Array(t);n>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}(t,!e)}function s(t){return t<=i.y9?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function a(t){return t<=i.y9?new Array(t):new Uint32Array(t)}let l=h(131072);const c=[0],u=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function d(t){return 1===t?c:t<i.y9?Array.from(new Uint16Array(u.buffer,0,t)):t<u.length?new Uint16Array(u.buffer,0,t):(t>l.length&&(l=h(Math.max(2*l.length,t))),new Uint32Array(l.buffer,0,t))}function h(t){const e=new Uint32Array(t);for(let n=0;n<e.length;n++)e[n]=n;return e}let f=new Uint8Array(65536);function v(t){if(1===t)return c;if(t<i.y9)return new Array(t).fill(0);if(t>f.length){const e=Math.max(2*f.length,t);f=new Uint8Array(e)}return new Uint8Array(f.buffer,0,t)}},42451:(t,e,n)=>{n.d(e,{yu:()=>v,Nz:()=>A,NB:()=>p,S7:()=>_});var i=n(34761),r=n(13191),o=n(20664),s=n(9392),a=n(84115),l=n(72468),c=n(23148),u=n(23687),d=n(69728),h=n(87003);class f extends h.n{constructor(t,e){super(t,"mat4",d.c.Draw,(n,i,r)=>n.setUniformMatrix4fv(t,e(i,r)))}}function v(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",s.uY):t.uniforms.add(new l.W("cameraPosition",(t,e)=>(0,o.i)(g,e.camera.viewInverseTransposeMatrix[3]-t.origin[0],e.camera.viewInverseTransposeMatrix[7]-t.origin[1],e.camera.viewInverseTransposeMatrix[11]-t.origin[2])))}function p(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new u.F("proj",t=>t.camera.projectionMatrix),new f("view",(t,e)=>(0,i.Tl)(m,e.camera.viewMatrix,t.origin)),new l.W("localOrigin",t=>t.origin));const n=t=>{let{camera:e}=t;return(0,o.i)(g,e.viewInverseTransposeMatrix[3],e.viewInverseTransposeMatrix[7],e.viewInverseTransposeMatrix[11])};t.uniforms.add(new u.F("proj",t=>t.camera.projectionMatrix),new u.F("view",t=>(0,i.Tl)(m,t.camera.viewMatrix,n(t))),new a.d("localOrigin",t=>n(t)))}const m=(0,r.vt)(),g=(0,s.vt)();function _(t){t.uniforms.add(new u.F("viewNormal",t=>t.camera.viewInverseTransposeMatrix))}function A(t){t.uniforms.add(new c.U("pixelRatio",t=>t.camera.pixelRatio/t.overlayStretch))}},42717:(t,e,n)=>{n.d(e,{NL:()=>g,ZX:()=>r});var i,r,o,s=n(57528),a=n(34981),l=n(95352),c=n(72468),u=n(5517),d=n(19771),h=n(21390),f=n(86955),v=n(27374),p=n(70367),m=(n(75803),n(69728));(o=r||(r={}))[o.None=0]="None",o[o.SymbolColor=1]="SymbolColor",o[o.EmissiveColor=2]="EmissiveColor",o[o.Texture=3]="Texture",o[o.COUNT=4]="COUNT";function g(t,e){if(!(0,a.RN)(e.output))return;const{emissionSource:n,hasEmissiveTextureTransform:o,bindType:g}=e,_=n===r.Texture;_&&(t.include(l.r,e),t.fragment.uniforms.add(g===m.c.Pass?new p.N("texEmission",t=>t.textureEmissive):new v.o("texEmission",t=>t.textureEmissive)));const A=n===r.EmissiveColor||_;A&&t.fragment.uniforms.add(g===m.c.Pass?new u.t("emissiveBaseColor",t=>t.emissiveBaseColor):new c.W("emissiveBaseColor",t=>t.emissiveBaseColor));const T=n!==r.None;T&&t.fragment.uniforms.add(g===m.c.Pass?new h.m("emissiveStrength",t=>t.emissiveStrength):new d.J("emissiveStrength",t=>t.emissiveStrength));const E=n===r.SymbolColor;t.fragment.code.add((0,f.H)(i||(i=(0,s.A)(["\n    vec4 getEmissions(vec3 symbolColor) {\n      vec4 emissions = ",";\n      ","\n      ","\n      return emissions;\n    }\n  "])),A?"vec4(emissiveBaseColor, 1.0)":E?"vec4(symbolColor, 1.0)":"vec4(0.0)",(0,f.If)(_,"emissions *= textureLookup(texEmission, ".concat(o?"emissiveUV":"vuv0",");\n         emissions.w = emissions.rgb == vec3(0.0) ? 0.0: emissions.w;")),(0,f.If)(T,"emissions.rgb *= emissiveStrength;")))}},42759:(t,e,n)=>{n.d(e,{h:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"mat3",i.c.Draw,(n,i,r)=>n.setUniformMatrix3fv(t,e(i,r)))}}},42953:(t,e,n)=>{n.d(e,{c:()=>T,f:()=>E});var i,r,o,s=n(57528),a=n(86955);function l(t){t.code.add((0,a.H)(i||(i=(0,s.A)(["vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG) {\nreturn ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n}"])))),t.code.add((0,a.H)(r||(r=(0,s.A)(["float integratedRadiance(float cosTheta2, float roughness) {\nreturn (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n}"])))),t.code.add((0,a.H)(o||(o=(0,s.A)(["vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness) {\nfloat cosTheta2 = 1.0 - RdotNG * RdotNG;\nfloat intRadTheta = integratedRadiance(cosTheta2, roughness);\nfloat ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\nfloat sky = 2.0 - ground;\nreturn (ground * ambientGround + sky * ambientSky) * 0.5;\n}"]))))}var c,u,d,h,f,v,p,m,g,_=n(26719),A=n(36324);function T(t,e){t.include(A.p),e.pbrMode!==_.A9.Normal&&e.pbrMode!==_.A9.Schematic&&e.pbrMode!==_.A9.Simplified&&e.pbrMode!==_.A9.TerrainWithWater||(t.code.add((0,a.H)(c||(c=(0,s.A)(["float normalDistribution(float NdotH, float roughness)\n{\nfloat a = NdotH * roughness;\nfloat b = roughness / (1.0 - NdotH * NdotH + a * a);\nreturn b * b * INV_PI;\n}"])))),t.code.add((0,a.H)(u||(u=(0,s.A)(["const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\nconst vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\nconst vec2 c2 = vec2(-1.04, 1.04);\nvec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\nreturn c2 * a004 + r.zw;\n}"]))))),e.pbrMode!==_.A9.Normal&&e.pbrMode!==_.A9.Schematic||(t.include(l),t.code.add((0,a.H)(d||(d=(0,s.A)(["struct PBRShadingInfo\n{\nfloat NdotV;\nfloat LdotH;\nfloat NdotNG;\nfloat RdotNG;\nfloat NdotAmbDir;\nfloat NdotH_Horizon;\nvec3 skyRadianceToSurface;\nvec3 groundRadianceToSurface;\nvec3 skyIrradianceToSurface;\nvec3 groundIrradianceToSurface;\nfloat averageAmbientRadiance;\nfloat ssao;\nvec3 albedoLinear;\nvec3 f0;\nvec3 f90;\nvec3 diffuseColor;\nfloat metalness;\nfloat roughness;\n};"])))),t.code.add((0,a.H)(h||(h=(0,s.A)(["vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\nvec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\nvec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\nvec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\nvec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\nvec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\nvec3 specularComponent = specularColor * indirectSpecular;\nreturn (diffuseComponent + specularComponent);\n}"])))))}function E(t,e){t.include(A.p),t.code.add((0,a.H)(f||(f=(0,s.A)(["\n  struct PBRShadingWater {\n      float NdotL;   // cos angle between normal and light direction\n      float NdotV;   // cos angle between normal and view direction\n      float NdotH;   // cos angle between normal and half vector\n      float VdotH;   // cos angle between view direction and half vector\n      float LdotH;   // cos angle between light direction and half vector\n      float VdotN;   // cos angle between view direction and normal vector\n  };\n\n  float dtrExponent = ",";\n  "])),e.useCustomDTRExponentForWater?"2.2":"2.0")),t.code.add((0,a.H)(v||(v=(0,s.A)(["vec3 fresnelReflection(float angle, vec3 f0, float f90) {\nreturn f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n}"])))),t.code.add((0,a.H)(p||(p=(0,s.A)(["float normalDistributionWater(float NdotH, float roughness) {\nfloat r2 = roughness * roughness;\nfloat NdotH2 = NdotH * NdotH;\nfloat denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\nreturn r2 / denom;\n}"])))),t.code.add((0,a.H)(m||(m=(0,s.A)(["float geometricOcclusionKelemen(float LoH) {\nreturn 0.25 / (LoH * LoH);\n}"])))),t.code.add((0,a.H)(g||(g=(0,s.A)(["vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max) {\nvec3  F = fresnelReflection(props.VdotH, F0, F0Max);\nfloat dSun = normalDistributionWater(props.NdotH, roughness);\nfloat V = geometricOcclusionKelemen(props.LdotH);\nfloat diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\nfloat strengthSunHaze  = 1.2;\nfloat dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze) * strengthSunHaze;\nreturn ((dSun + dSunHaze) * V) * F;\n}"]))))}},43425:(t,e,n)=>{n.d(e,{X:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"mat4",i.c.Pass,(n,i,r)=>n.setUniformMatrix4fv(t,e(i,r)))}}},43557:(t,e,n)=>{n.d(e,{Gc:()=>a,O4:()=>l,Vt:()=>c});var i,r=n(57528),o=n(84115),s=n(86955);function a(t){t.uniforms.add(new o.d("mainLightDirection",t=>t.lighting.mainLight.direction))}function l(t){t.uniforms.add(new o.d("mainLightIntensity",t=>t.lighting.mainLight.intensity))}function c(t){a(t.fragment),l(t.fragment),t.fragment.code.add((0,s.H)(i||(i=(0,r.A)(["vec3 applyShading(vec3 shadingNormal, float shadow) {\nfloat dotVal = clamp(dot(shadingNormal, mainLightDirection), 0.0, 1.0);\nreturn mainLightIntensity * ((1.0 - shadow) * dotVal);\n}"]))))}},45235:(t,e,n)=>{var i;n.d(e,{n:()=>i}),function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"}(i||(i={}))},45463:(t,e,n)=>{n.d(e,{im:()=>u,m$:()=>i,qA:()=>d});var i,r=n(90632),o=n(34981),s=n(32119),a=n(92656),l=n(99362),c=n(31432);class u{constructor(t,e){this.id=(0,r.c)(),this.supportsEdges=!1,this.vertexAttributeLocations=s.D,this._renderPriority=0,this._parameters=new e,(0,l.MB)(this._parameters,t),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(t){return!1}setParameters(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,l.MB)(this._parameters,t)&&(this.validateParameters(this._parameters),e&&this._parametersChanged())}validateParameters(t){}shouldRender(t){return this.visible&&this.isVisibleForOutput(t.output)&&(!this.parameters.isDecoration||t.bind.decorations)&&0!==(this.parameters.renderOccluded&t.renderOccludedMask)}isVisibleForOutput(t){return!0}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this._parametersChanged())}_parametersChanged(){var t;null===(t=this.repository)||void 0===t||t.materialChanged(this)}get renderOccludedFlags(){return this.visible?this.parameters.renderOccluded:i.None}get hasEmissions(){return!1}getConfiguration(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.E;return n.output=t,n.hasHighlightMixTexture=t===o.V.Highlight&&null!=e.highlightMixTexture,n}}!function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"}(i||(i={}));class d extends c.Y{constructor(){super(...arguments),this.renderOccluded=i.Occlude,this.isDecoration=!1}}},48168:(t,e,n)=>{n.d(e,{JG:()=>c,Uy:()=>d,Wb:()=>x,Z$:()=>p,b_:()=>m});var i=n(20664),r=n(9392),o=n(42294),s=n(34017),a=n(86994),l=n(66470);class c{constructor(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.isVerticalRay=t,this.normalRequired=e}}const u=(0,o.vt)();function d(t,e,n,r,o,u){if(!t.visible)return;const d=(0,i.a)(C,r,n),h=(t,e,n)=>{u(t,n,e)},v=new c(!1,e.options.normalRequired);if(t.boundingInfo){(0,a.vA)(t.type===s.d.Mesh);const i=e.tolerance;f(t.boundingInfo,n,d,i,o,v,h)}else{const e=t.attributes.get(l.r.POSITION),i=e.indices;g(n,d,0,i.length/3,i,e.data,e.stride,o,v,h)}}const h=(0,r.vt)();function f(t,e,n,r,s,a,l){if(null==t)return;const c=function(t,e){return(0,i.i)(e,1/t[0],1/t[1],1/t[2])}(n,h);if((0,o.Ne)(u,t.bbMin),(0,o.vI)(u,t.bbMax),null!=s&&s.applyToAabb(u),x(u,e,c,r)){const{primitiveIndices:i,position:o}=t,c=i?i.length:o.indices.length/3;if(c>O){const i=t.getChildren();if(void 0!==i){for(const t of i)f(t,e,n,r,s,a,l);return}}!function(t,e,n,i,r,o,s,a,l,c,u){const d=t[0],h=t[1],f=t[2],p=e[0],m=e[1],g=e[2],{normalRequired:_}=c;for(let A=n;A<i;++A){const t=a[A],e=3*t,n=s*r[e];let i=o[n],c=o[n+1],T=o[n+2];const S=s*r[e+1];let b=o[S],y=o[S+1],x=o[S+2];const O=s*r[e+2];let C=o[O],I=o[O+1],w=o[O+2];null!=l&&([i,c,T]=l.applyToVertex(i,c,T,A),[b,y,x]=l.applyToVertex(b,y,x,A),[C,I,w]=l.applyToVertex(C,I,w,A));const M=b-i,N=y-c,P=x-T,L=C-i,D=I-c,F=w-T,H=m*F-D*g,B=g*L-F*p,U=p*D-L*m,z=M*H+N*B+P*U;if(Math.abs(z)<=R)continue;const V=d-i,W=h-c,G=f-T,k=V*H+W*B+G*U;if(z>0){if(k<0||k>z)continue}else if(k>0||k<z)continue;const q=W*P-N*G,j=G*M-P*V,Y=V*N-M*W,X=p*q+m*j+g*Y;if(z>0){if(X<0||k+X>z)continue}else if(X>0||k+X<z)continue;const Z=(L*q+D*j+F*Y)/z;Z>=0&&u(Z,t,_?E(M,N,P,L,D,F,v):null)}}(e,n,0,c,o.indices,o.data,o.stride,i,s,a,l)}}const v=(0,r.vt)();function p(t,e,n,r,o,s,a,l,c){const{data:u,stride:d}=s;g(t,(0,i.a)(C,e,t),n,r,o,u,d,a,l,c)}function m(t,e,n,i,r,o,s,a){const l=t[0],c=t[1],u=t[2],d=e[0],h=e[1],f=e[2];for(let p=n;p<i;++p){const t=3*p,e=t+1,n=t+2,i=o*t,m=r[i],g=r[i+1],_=r[i+2],A=o*e,T=o*n,S=r[A]-m,b=r[A+1]-g,y=r[A+2]-_,x=r[T]-m,O=r[T+1]-g,C=r[T+2]-_,I=h*C-O*f,w=f*x-C*d,M=d*O-x*h,N=S*I+b*w+y*M;if(Math.abs(N)<=R)continue;const P=l-m,L=c-g,D=u-_,F=P*I+L*w+D*M;if(N>0){if(F<0||F>N)continue}else if(F>0||F<N)continue;const H=L*y-b*D,B=D*S-y*P,U=P*b-S*L,z=d*H+h*B+f*U;if(N>0){if(z<0||F+z>N)continue}else if(z>0||F+z<N)continue;const V=(x*H+O*B+C*U)/N;V>=0&&a(V,p,s?E(S,b,y,x,O,C,v):null)}}function g(t,e,n,r,o,s,a,l,c,u){const d=e,h=I,f=Math.abs(d[0]),v=Math.abs(d[1]),p=Math.abs(d[2]),m=f>=v?f>=p?0:2:v>=p?1:2,g=m,E=d[g]<0?2:1,b=(m+E)%3,y=(m+(3-E))%3,x=d[b]/d[g],O=d[y]/d[g],R=1/d[g],C=_,w=A,M=T,{normalRequired:N}=c;for(let _=n;_<r;++_){const e=3*_,n=a*o[e];(0,i.i)(h[0],s[n+0],s[n+1],s[n+2]);const r=a*o[e+1];(0,i.i)(h[1],s[r+0],s[r+1],s[r+2]);const c=a*o[e+2];(0,i.i)(h[2],s[c+0],s[c+1],s[c+2]),l&&((0,i.c)(h[0],l.applyToVertex(h[0][0],h[0][1],h[0][2],_)),(0,i.c)(h[1],l.applyToVertex(h[1][0],h[1][1],h[1][2],_)),(0,i.c)(h[2],l.applyToVertex(h[2][0],h[2][1],h[2][2],_))),(0,i.a)(C,h[0],t),(0,i.a)(w,h[1],t),(0,i.a)(M,h[2],t);const d=C[b]-x*C[g],f=C[y]-O*C[g],v=w[b]-x*w[g],p=w[y]-O*w[g],m=M[b]-x*M[g],A=M[y]-O*M[g],T=m*p-A*v,E=d*A-f*m,I=v*f-p*d;if((T<0||E<0||I<0)&&(T>0||E>0||I>0))continue;const P=T+E+I;if(0===P)continue;const L=T*(R*C[g])+E*(R*w[g])+I*(R*M[g]);if(L*Math.sign(P)<0)continue;const D=L/P;D>=0&&u(D,_,N?S(h):null)}}const _=(0,r.vt)(),A=(0,r.vt)(),T=(0,r.vt)();function E(t,e,n,r,o,s,a){return(0,i.i)(b,t,e,n),(0,i.i)(y,r,o,s),(0,i.h)(a,b,y),(0,i.n)(a,a),a}function S(t){return(0,i.a)(b,t[1],t[0]),(0,i.a)(y,t[2],t[0]),(0,i.h)(v,b,y),(0,i.n)(v,v),v}const b=(0,r.vt)(),y=(0,r.vt)();function x(t,e,n,i){return function(t,e,n,i,r){const o=(t[0]-i-e[0])*n[0],s=(t[3]+i-e[0])*n[0];let a=Math.min(o,s),l=Math.max(o,s);const c=(t[1]-i-e[1])*n[1],u=(t[4]+i-e[1])*n[1];if(l=Math.min(l,Math.max(c,u)),l<0)return!1;if(a=Math.max(a,Math.min(c,u)),a>l)return!1;const d=(t[2]-i-e[2])*n[2],h=(t[5]+i-e[2])*n[2];return l=Math.min(l,Math.max(d,h)),!(l<0)&&(a=Math.max(a,Math.min(d,h)),!(a>l)&&a<r)}(t,e,n,i,1/0)}const O=1e3,R=1e-7,C=(0,r.vt)(),I=[(0,r.vt)(),(0,r.vt)(),(0,r.vt)()]},48353:(t,e,n)=>{n.d(e,{O:()=>i,b:()=>r});const i=3e5,r=5e5},48549:(t,e,n)=>{n.d(e,{BP:()=>u,l5:()=>d,q3:()=>c});var i=n(89379),r=n(62984),o=n(88105),s=n(6381),a=n(86994);class l{constructor(t,e){this.layout=t,this.buffer="number"==typeof e?new ArrayBuffer(e*t.stride):e;for(const n of t.fields.keys()){const e=t.fields.get(n);this[n]=new e.constructor(this.buffer,e.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,e){const n=this[t];return n&&n.elementCount===e.ElementCount&&n.elementType===e.ElementType?n:null}slice(t,e){return new l(this.layout,this.buffer.slice(t*this.stride,e*this.stride))}copyFrom(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.count;const r=this.stride;if(r%4==0){const o=new Uint32Array(t.buffer,e*r,i*r/4);new Uint32Array(this.buffer,n*r,i*r/4).set(o)}else{const o=new Uint8Array(t.buffer,e*r,i*r);new Uint8Array(this.buffer,n*r,i*r).set(o)}return this}get cachedMemory(){return this.byteLength}dispose(){}}class c{constructor(t){this._stride=0,this._fields=new Map,t&&(this._stride=t.stride,t.fields.forEach(t=>this._fields.set(t[0],(0,i.A)((0,i.A)({},t[1]),{},{constructor:v(t[1].constructor)}))))}freeze(){return this}vec2f16(t,e){return this._appendField(t,r.SX?o.ZD:o.gH,e),this}vec2f(t,e){return this._appendField(t,o.gH,e),this}vec2f64(t,e){return this._appendField(t,o.si,e),this}vec3f16(t,e){return this._appendField(t,r.SX?o.EC:o.xs,e),this}vec3f(t,e){return this._appendField(t,o.xs,e),this}vec3f64(t,e){return this._appendField(t,o.Xm,e),this}vec4f16(t,e){return this._appendField(t,r.SX?o.jz:o.Eq,e),this}vec4f(t,e){return this._appendField(t,o.Eq,e),this}vec4f64(t,e){return this._appendField(t,o.Aj,e),this}mat3f(t,e){return this._appendField(t,o.jZ,e),this}mat3f64(t,e){return this._appendField(t,o.j0,e),this}mat4f(t,e){return this._appendField(t,o.Sx,e),this}mat4f64(t,e){return this._appendField(t,o.E$,e),this}vec4u8(t,e){return this._appendField(t,o.XP,e),this}f16(t,e){return this._appendField(t,r.SX?o.XW:o.Y$,e),this}f32(t,e){return this._appendField(t,o.Y$,e),this}f64(t,e){return this._appendField(t,o.qB,e),this}u8(t,e){return this._appendField(t,o.SL,e),this}u16(t,e){return this._appendField(t,o.h,e),this}i8(t,e){return this._appendField(t,o.bf,e),this}vec2i8(t,e){return this._appendField(t,o.D6,e),this}vec2i16(t,e){return this._appendField(t,o.mJ,e),this}vec2u8(t,e){return this._appendField(t,o.LC,e),this}vec2u16(t,e){return this._appendField(t,o.Yi,e),this}vec4u16(t,e){return this._appendField(t,o.Uz,e),this}u32(t,e){return this._appendField(t,o.P,e),this}_appendField(t,e,n){this._fields.has(t)&&(0,a.vA)(!1,"".concat(t," already added to vertex buffer layout"));const i=e.ElementCount*(0,s.GJ)(e.ElementType),r=this._stride;this._fields.set(t,{constructor:e,size:i,offset:r,optional:n}),this._alignFields()}_alignFields(){let t=0,e=1;this._fields.forEach(n=>{const i=(0,s.GJ)(n.constructor.ElementType);t=Math.floor((t+i-1)/i)*i,n.offset=t,t+=n.size,e=Math.max(e,i)}),t=Math.floor((t+e-1)/e)*e,this._stride=t}createBuffer(t){return new l(this,t)}createView(t){return new l(this,t)}clone(){const t=new c;return t._stride=this._stride,t._fields=new Map,this._fields.forEach((e,n)=>t._fields.set(n,e)),t.BufferType=this.BufferType,t}get stride(){return this._stride}get fields(){return this._fields}}function u(){return new c}class d{constructor(t){this.fields=new Array,t.fields.forEach((t,e)=>{const n=(0,i.A)((0,i.A)({},t),{},{constructor:f(t.constructor)});this.fields.push([e,n])}),this.stride=t.stride}}const h=[o.Y$,o.gH,o.xs,o.Eq,o.jZ,o.Sx,o.qB,o.si,o.Xm,o.Aj,o.j0,o.E$,o.SL,o.LC,o.eI,o.XP,o.h,o.Yi,o.nS,o.Uz,o.P,o.An,o.H$,o.ml,o.bf,o.D6,o.m8,o.TX,o.Qt,o.mJ,o.Vp,o.E7,o.My,o.UL,o.zD,o.Y4];function f(t){return"".concat(t.ElementType,"_").concat(t.ElementCount)}function v(t){return p.get(t)}const p=new Map;h.forEach(t=>p.set(f(t),t))},49003:(t,e,n)=>{n.d(e,{D:()=>o});var i=n(89379),r=n(3825);async function o(t,e){const{data:n}=await(0,r.A)(t,(0,i.A)({responseType:"image"},e));return n}},51596:(t,e,n)=>{n.d(e,{I:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"vec4",i.c.Bind,(n,i)=>n.setUniform4fv(t,e(i)))}}},52757:(t,e,n)=>{n.d(e,{Hk:()=>v,Pq:()=>f,SA:()=>T,Ut:()=>h,Wu:()=>g,p1:()=>p,tb:()=>m,uO:()=>c,vx:()=>A,zC:()=>E});var i=n(20664),r=n(9392),o=n(34761),s=n(88105),a=n(86994),l=n(66470);function c(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const{data:r,indices:o}=t,s=e.typedBuffer,a=e.typedBufferStride,l=o.length;if(n*=a,1===i)for(let c=0;c<l;++c)s[n]=r[o[c]],n+=a;else for(let c=0;c<l;++c){const t=r[o[c]];for(let e=0;e<i;e++)s[n]=t,n+=a}}function u(t,e,n){const{data:i,indices:r}=t,o=e.typedBuffer,s=e.typedBufferStride,a=r.length;n*=s;for(let l=0;l<a;++l){const t=2*r[l];o[n]=i[t],o[n+1]=i[t+1],n+=s}}function d(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const{data:r,indices:o}=t,s=e.typedBuffer,a=e.typedBufferStride,l=o.length;if(n*=a,1===i)for(let c=0;c<l;++c){const t=3*o[c];s[n]=r[t],s[n+1]=r[t+1],s[n+2]=r[t+2],n+=a}else for(let c=0;c<l;++c){const t=3*o[c];for(let e=0;e<i;++e)s[n]=r[t],s[n+1]=r[t+1],s[n+2]=r[t+2],n+=a}}function h(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const{data:r,indices:o}=t,s=e.typedBuffer,a=e.typedBufferStride,l=o.length;if(n*=a,1===i)for(let c=0;c<l;++c){const t=4*o[c];s[n]=r[t],s[n+1]=r[t+1],s[n+2]=r[t+2],s[n+3]=r[t+3],n+=a}else for(let c=0;c<l;++c){const t=4*o[c];for(let e=0;e<i;++e)s[n]=r[t],s[n+1]=r[t+1],s[n+2]=r[t+2],s[n+3]=r[t+3],n+=a}}function f(t,e,n){const i=t.typedBuffer,r=t.typedBufferStride;e*=r;for(let o=0;o<n;++o)i[e]=0,i[e+1]=0,i[e+2]=0,i[e+3]=0,e+=r}function v(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(!e)return void d(t,n,i,r);const{data:s,indices:a}=t,l=n.typedBuffer,c=n.typedBufferStride,u=a.length,h=e[0],f=e[1],v=e[2],p=e[4],m=e[5],g=e[6],_=e[8],A=e[9],T=e[10],E=e[12],S=e[13],b=e[14];i*=c;let y=0,x=0,O=0;const R=(0,o.tZ)(e)?t=>{y=s[t]+E,x=s[t+1]+S,O=s[t+2]+b}:t=>{const e=s[t],n=s[t+1],i=s[t+2];y=h*e+p*n+_*i+E,x=f*e+m*n+A*i+S,O=v*e+g*n+T*i+b};if(1===r)for(let o=0;o<u;++o)R(3*a[o]),l[i]=y,l[i+1]=x,l[i+2]=O,i+=c;else for(let o=0;o<u;++o){R(3*a[o]);for(let t=0;t<r;++t)l[i]=y,l[i+1]=x,l[i+2]=O,i+=c}}function p(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(!e)return void d(t,n,i,r);const{data:s,indices:a}=t,l=e,c=n.typedBuffer,u=n.typedBufferStride,h=a.length,f=l[0],v=l[1],p=l[2],m=l[4],g=l[5],_=l[6],A=l[8],T=l[9],E=l[10],S=!(0,o.ut)(l),b=1e-6,y=1-b;i*=u;let x=0,O=0,R=0;const C=(0,o.tZ)(l)?t=>{x=s[t],O=s[t+1],R=s[t+2]}:t=>{const e=s[t],n=s[t+1],i=s[t+2];x=f*e+m*n+A*i,O=v*e+g*n+T*i,R=p*e+_*n+E*i};if(1===r)if(S)for(let o=0;o<h;++o){C(3*a[o]);const t=x*x+O*O+R*R;if(t<y&&t>b){const e=1/Math.sqrt(t);c[i]=x*e,c[i+1]=O*e,c[i+2]=R*e}else c[i]=x,c[i+1]=O,c[i+2]=R;i+=u}else for(let o=0;o<h;++o)C(3*a[o]),c[i]=x,c[i+1]=O,c[i+2]=R,i+=u;else for(let o=0;o<h;++o){if(C(3*a[o]),S){const t=x*x+O*O+R*R;if(t<y&&t>b){const e=1/Math.sqrt(t);x*=e,O*=e,R*=e}}for(let t=0;t<r;++t)c[i]=x,c[i+1]=O,c[i+2]=R,i+=u}}function m(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const{data:o,indices:s}=t,a=n.typedBuffer,l=n.typedBufferStride,c=s.length;if(i*=l,e!==o.length||4!==e)if(1!==r)if(4!==e)for(let u=0;u<c;++u){const t=3*s[u];for(let e=0;e<r;++e)a[i]=o[t],a[i+1]=o[t+1],a[i+2]=o[t+2],a[i+3]=255,i+=l}else for(let u=0;u<c;++u){const t=4*s[u];for(let e=0;e<r;++e)a[i]=o[t],a[i+1]=o[t+1],a[i+2]=o[t+2],a[i+3]=o[t+3],i+=l}else{if(4===e){for(let t=0;t<c;++t){const e=4*s[t];a[i]=o[e],a[i+1]=o[e+1],a[i+2]=o[e+2],a[i+3]=o[e+3],i+=l}return}for(let t=0;t<c;++t){const e=3*s[t];a[i]=o[e],a[i+1]=o[e+1],a[i+2]=o[e+2],a[i+3]=255,i+=l}}else{a[i]=o[0],a[i+1]=o[1],a[i+2]=o[2],a[i+3]=o[3];const t=new Uint32Array(n.typedBuffer.buffer,n.start),e=l/4,s=t[i/=4];i+=e;const u=c*r;for(let n=1;n<u;++n)t[i]=s,i+=e}}function g(t,e,n,r){(0,i.d)(_,t,e);const o=Math.max(Math.sqrt((0,i.l)(_)),1e-4);(0,i.g)(_,_,1/o),n[r++]=_[0],n[r++]=_[1],n[r++]=_[2],n[r++]=o}const _=(0,r.vt)();function A(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const o=e.typedBuffer,s=e.typedBufferStride;if(i*=s,1===r)for(let a=0;a<n;++a)o[i]=t[0],o[i+1]=t[1],o[i+2]=t[2],o[i+3]=t[3],i+=s;else for(let a=0;a<n;++a)for(let e=0;e<r;++e)o[i]=t[0],o[i+1]=t[1],o[i+2]=t[2],o[i+3]=t[3],i+=s}function T(t,e,n,i,r,o,a){let c={numItems:0,numVerticesPerItem:0};for(const d of n.fields.keys()){const n=t.get(d),h=null===n||void 0===n?void 0:n.indices;if(n&&h)d===l.r.POSITION&&(c={numItems:1,numVerticesPerItem:h.length}),E(d,n,i,r,o,a);else if(d===l.r.OLIDCOLOR&&null!=e){var u;const n=null===(u=t.get(l.r.POSITION))||void 0===u?void 0:u.indices;if(n){const t=n.length;A(e,o.getField(d,s.XP),t,a)}}}return c}function E(t,e,n,i,r,c){switch(t){case l.r.POSITION:{(0,a.vA)(3===e.size);const i=r.getField(t,s.xs);(0,a.vA)(!!i,"No buffer view for ".concat(t)),v(e,n,i,c);break}case l.r.NORMAL:{(0,a.vA)(3===e.size);const n=r.getField(t,s.xs);(0,a.vA)(!!n,"No buffer view for ".concat(t)),p(e,i,n,c);break}case l.r.NORMALCOMPRESSED:case l.r.PROFILERIGHT:case l.r.PROFILEUP:{(0,a.vA)(2===e.size);const n=r.getField(t,s.mJ);(0,a.vA)(!!n,"No buffer view for ".concat(t)),u(e,n,c);break}case l.r.UV0:{var f;(0,a.vA)(2===e.size);const n=null!==(f=r.getField(t,s.ZD))&&void 0!==f?f:r.getField(t,s.gH);(0,a.vA)(!!n,"No buffer view for ".concat(t)),u(e,n,c);break}case l.r.UVI:{(0,a.vA)(2===e.size);const n=r.getField(t,s.mJ);(0,a.vA)(!!n,"No buffer view for ".concat(t)),u(e,n,c);break}case l.r.COLOR:case l.r.SYMBOLCOLOR:{const n=r.getField(t,s.XP);(0,a.vA)(!!n,"No buffer view for ".concat(t)),(0,a.vA)(3===e.size||4===e.size),m(e,e.size,n,c);break}case l.r.COLORFEATUREATTRIBUTE:case l.r.OPACITYFEATUREATTRIBUTE:case l.r.SIZEFEATUREATTRIBUTE:{var g;const n=null!==(g=r.getField(t,s.Y$))&&void 0!==g?g:r.getField(t,s.Y$);(0,a.vA)(!!n,"No buffer view for ".concat(t)),(0,a.vA)(1===e.size),function(t,e,n){const{data:i,indices:r}=t,o=e.typedBuffer,s=e.typedBufferStride,a=r.length,l=i[0];n*=s;for(let c=0;c<a;++c)o[n]=l,n+=s}(e,n,c);break}case l.r.TANGENT:{(0,a.vA)(4===e.size);const i=r.getField(t,s.Eq);(0,a.vA)(!!i,"No buffer view for ".concat(t)),function(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(!e)return void h(t,n,i,r);const{data:s,indices:a}=t,l=e,c=n.typedBuffer,u=n.typedBufferStride,d=a.length,f=l[0],v=l[1],p=l[2],m=l[4],g=l[5],_=l[6],A=l[8],T=l[9],E=l[10],S=!(0,o.ut)(l),b=1e-6,y=1-b;if(i*=u,1===r)for(let o=0;o<d;++o){const t=4*a[o],e=s[t],n=s[t+1],r=s[t+2],l=s[t+3];let d=f*e+m*n+A*r,h=v*e+g*n+T*r,x=p*e+_*n+E*r;if(S){const t=d*d+h*h+x*x;if(t<y&&t>b){const e=1/Math.sqrt(t);d*=e,h*=e,x*=e}}c[i]=d,c[i+1]=h,c[i+2]=x,c[i+3]=l,i+=u}else for(let o=0;o<d;++o){const t=4*a[o],e=s[t],n=s[t+1],l=s[t+2],d=s[t+3];let h=f*e+m*n+A*l,x=v*e+g*n+T*l,O=p*e+_*n+E*l;if(S){const t=h*h+x*x+O*O;if(t<y&&t>b){const e=1/Math.sqrt(t);h*=e,x*=e,O*=e}}for(let o=0;o<r;++o)c[i]=h,c[i+1]=x,c[i+2]=O,c[i+3]=d,i+=u}}(e,n,i,c);break}case l.r.PROFILEVERTEXANDNORMAL:{var _;(0,a.vA)(4===e.size);const n=null!==(_=r.getField(t,s.jz))&&void 0!==_?_:r.getField(t,s.Eq);(0,a.vA)(!!n,"No buffer view for ".concat(t)),h(e,n,c);break}case l.r.PROFILEAUXDATA:{var A;(0,a.vA)(3===e.size);const n=null!==(A=r.getField(t,s.EC))&&void 0!==A?A:r.getField(t,s.xs);(0,a.vA)(!!n,"No buffer view for ".concat(t)),d(e,n,c);break}}}},53908:(t,e,n)=>{n.d(e,{W:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"int",i.c.Bind,(n,i)=>n.setUniform1i(t,e(i)))}}},54478:(t,e,n)=>{n.d(e,{c:()=>c});var i,r,o,s=n(57528),a=n(86955),l=n(66470);function c(t,e){e.hasVertexColors?(t.attributes.add(l.r.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add((0,a.H)(i||(i=(0,s.A)(["void forwardVertexColor() { vColor = color; }"])))),t.vertex.code.add((0,a.H)(r||(r=(0,s.A)(["void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }"]))))):t.vertex.code.add((0,a.H)(o||(o=(0,s.A)(["void forwardVertexColor() {}\nvoid forwardNormalizedVertexColor() {}"]))))}},56289:(t,e,n)=>{n.d(e,{t:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"vec2",i.c.Draw,(n,i,r,o)=>n.setUniform2fv(t,e(i,r,o)))}}},57162:(t,e,n)=>{n.d(e,{Ey:()=>x,Ms:()=>Y,RC:()=>c,T8:()=>u,Uy:()=>v,Xt:()=>f,hG:()=>h,iD:()=>l,kn:()=>p,p3:()=>a});var i=n(89379),r=n(83490),o=n(93345);function s(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.Tb.ADD,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0,0];return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:n,opAlpha:n,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function a(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o.Tb.ADD,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:o.Tb.ADD,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0,0,0];return{srcRgb:t,srcAlpha:e,dstRgb:n,dstAlpha:i,opRgb:r,opAlpha:s,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const l=s(o.dn.ZERO,o.dn.ONE_MINUS_SRC_ALPHA),c=(s(o.dn.ONE,o.dn.ZERO),s(o.dn.ONE,o.dn.ONE),s(o.dn.ONE,o.dn.ONE_MINUS_SRC_ALPHA)),u=a(o.dn.SRC_ALPHA,o.dn.ONE,o.dn.ONE_MINUS_SRC_ALPHA,o.dn.ONE_MINUS_SRC_ALPHA),d={face:o.Y7.BACK,mode:o.Ac.CCW},h={face:o.Y7.FRONT,mode:o.Ac.CCW},f=t=>t===r.s2.Back?d:t===r.s2.Front?h:null,v={zNear:0,zFar:1},p={r:!0,g:!0,b:!0,a:!0};function m(t){return C.intern(t)}function g(t){return w.intern(t)}function _(t){return N.intern(t)}function A(t){return L.intern(t)}function T(t){return F.intern(t)}function E(t){return B.intern(t)}function S(t){return z.intern(t)}function b(t){return W.intern(t)}function y(t){return k.intern(t)}function x(t){return j.intern(t)}class O{constructor(t,e){this._makeKey=t,this._makeRef=e,this._interns=new Map}intern(t){var e;if(!t)return null;const n=this._makeKey(t),i=this._interns;return i.has(n)||i.set(n,this._makeRef(t)),null!==(e=i.get(n))&&void 0!==e?e:null}}function R(t){return"["+t.join(",")+"]"}const C=new O(I,t=>(0,i.A)({__tag:"Blending"},t));function I(t){return t?R([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const w=new O(M,t=>(0,i.A)({__tag:"Culling"},t));function M(t){return t?R([t.face,t.mode]):null}const N=new O(P,t=>(0,i.A)({__tag:"PolygonOffset"},t));function P(t){return t?R([t.factor,t.units]):null}const L=new O(D,t=>(0,i.A)({__tag:"DepthTest"},t));function D(t){return t?R([t.func]):null}const F=new O(H,t=>(0,i.A)({__tag:"StencilTest"},t));function H(t){return t?R([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const B=new O(U,t=>(0,i.A)({__tag:"DepthWrite"},t));function U(t){return t?R([t.zNear,t.zFar]):null}const z=new O(V,t=>(0,i.A)({__tag:"ColorWrite"},t));function V(t){return t?R([t.r,t.g,t.b,t.a]):null}const W=new O(G,t=>(0,i.A)({__tag:"StencilWrite"},t));function G(t){return t?R([t.mask]):null}const k=new O(q,t=>(0,i.A)({__tag:"DrawBuffers"},t));function q(t){return t?R(t.buffers):null}const j=new O(function(t){return t?R([I(t.blending),M(t.culling),P(t.polygonOffset),D(t.depthTest),H(t.stencilTest),U(t.depthWrite),V(t.colorWrite),G(t.stencilWrite),q(t.drawBuffers)]):null},t=>({blending:m(t.blending),culling:g(t.culling),polygonOffset:_(t.polygonOffset),depthTest:A(t.depthTest),stencilTest:T(t.stencilTest),depthWrite:E(t.depthWrite),colorWrite:S(t.colorWrite),stencilWrite:b(t.stencilWrite),drawBuffers:y(t.drawBuffers)}));class Y{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._setDrawBuffers(t.drawBuffers),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(t){this._drawBuffers=this._setSubState(t,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(t,e,n,i){return(n||t!==e)&&(i(t),this._pipelineInvalid=!0),t}}},57528:(t,e,n)=>{function i(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}n.d(e,{A:()=>i})},58350:(t,e,n)=>{n.d(e,{E:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"vec4",i.c.Pass,(n,i,r)=>n.setUniform4fv(t,e(i,r)))}}},59246:(t,e,n)=>{n.d(e,{w:()=>d,L:()=>h});var i=n(76460),r=n(30726),o=n(34981),s=n(32119),a=(n(81806),n(61678));class l{constructor(t,e,n){this._context=t,this._locations=n,this._textures=new Map,this._glProgram=t.programCache.acquire(e.generate("vertex",!0),e.generate("fragment",!0),n),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bind=e.generateBind(this),this.bindPass=e.generateBindPass(this),this.bindDraw=e.generateBindDraw(this)}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(t,e){this._glProgram.setUniform1i(t,e?1:0)}setUniform1i(t,e){this._glProgram.setUniform1i(t,e)}setUniform1f(t,e){this._glProgram.setUniform1f(t,e)}setUniform2fv(t,e){this._glProgram.setUniform2fv(t,e)}setUniform3fv(t,e){this._glProgram.setUniform3fv(t,e)}setUniform4fv(t,e){this._glProgram.setUniform4fv(t,e)}setUniformMatrix3fv(t,e){this._glProgram.setUniformMatrix3fv(t,e)}setUniformMatrix4fv(t,e){this._glProgram.setUniformMatrix4fv(t,e)}setUniform1fv(t,e){this._glProgram.setUniform1fv(t,e)}setUniform1iv(t,e){this._glProgram.setUniform1iv(t,e)}setUniform2iv(t,e){this._glProgram.setUniform2iv(t,e)}setUniform3iv(t,e){this._glProgram.setUniform3iv(t,e)}setUniform4iv(t,e){this._glProgram.setUniform4iv(t,e)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear()}bindTexture(t,e){var n;(null===(n=e)||void 0===n?void 0:n.glName)||((0,a.en)()&&console.error("Texture sampler ".concat(t," has no given Texture in ").concat((new Error).stack," ")),e=this._context.emptyTexture);const i=this._ensureTextureUnit(t,e);this._context.useProgram(this),this.setUniform1i(t,i.unit),this._context.bindTexture(e,i.unit)}_ensureTextureUnit(t,e){let n=this._textures.get(t);return null==n?(n={texture:e,unit:this._textures.size},this._textures.set(t,n)):n.texture=e,n}}var c=n(93345),u=n(57162);class d{constructor(t,e,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s.D;this.locations=o,this.primitiveType=c.WR.TRIANGLES,this.key=e.key,this._program=new l(t.rctx,n.get().build(e),o),this._pipeline=this.initializePipeline(e),this.reload=async s=>{s&&await n.reload(),this.key.equals(e.key)||i.A.getLogger("esri.views.3d.webgl.ShaderTechnique").warn("Configuration was changed after construction, cannot reload shader.",n),(0,r.WD)(this._program),this._program=new l(t.rctx,n.get().build(e),o),this._pipeline=this.initializePipeline(e)}}destroy(){this._program=(0,r.WD)(this._program),this._pipeline=null}get program(){return this._program}get compiled(){return this.program.compiled}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}getPipeline(t,e){return this._pipeline}initializePipeline(t){return(0,u.Ey)({blending:u.RC,colorWrite:u.kn})}}function h(t,e){return(0,o.Vg)(t)?{buffers:[c.Hr.NONE]}:null!==e&&void 0!==e?e:null}},59395:(t,e,n)=>{n.d(e,{d:()=>l});var i,r,o=n(57528),s=n(72412),a=n(86955);function l(t){(0,s.i$)(t),t.vertex.code.add((0,a.H)(i||(i=(0,o.A)(["vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\nvec4 eye = view * vec4(pos, 1.0);\ndepth = calculateLinearDepth(nearFar,eye.z);\nreturn proj * eye;\n}"])))),t.vertex.code.add((0,a.H)(r||(r=(0,o.A)(["vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\nreturn proj * (view * vec4(pos, 1.0));\n}"]))))}},59696:(t,e,n)=>{n.d(e,{A:()=>r});var i=n(83490);class r{constructor(t){this._material=t.material,this._techniques=t.techniques,this._output=t.output}dispose(){}get _stippleTextures(){return this._techniques.context.stippleTextures}get _markerTextures(){return this._techniques.context.markerTextures}getTechnique(t,e){return this._techniques.get(t,this._material.getConfiguration(this._output,e))}ensureResources(t){return i.Am.LOADED}}},60205:(t,e,n)=>{n.d(e,{x:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e,n){super(t,"float",i.c.Pass,(n,i,r)=>n.setUniform1fv(t,e(i,r)),n)}}},60322:(t,e,n)=>{n.d(e,{K_:()=>v,SE:()=>h,Yf:()=>c,ez:()=>l,m6:()=>p,mE:()=>f,xt:()=>d,z5:()=>u});var i=n(34981),r=n(72001),o=n(93345),s=n(57162);const a=(0,s.p3)(o.dn.ONE,o.dn.ZERO,o.dn.ONE,o.dn.ONE_MINUS_SRC_ALPHA);function l(t){return t===r.Y.FrontFace?null:a}function c(t){switch(t){case r.Y.NONE:return s.T8;case r.Y.ColorAlpha:return a;case r.Y.FrontFace:case r.Y.COUNT:return null}}function u(t){if(t.draped)return null;switch(t.oitPass){case r.Y.NONE:case r.Y.FrontFace:return t.writeDepth?s.Uy:null;case r.Y.ColorAlpha:case r.Y.COUNT:return null}}const d=5e5,h={factor:-1,units:-2};function f(t){let{oitPass:e,enableOffset:n}=t;return n&&e===r.Y.ColorAlpha?h:null}function v(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.MT.LESS;return t===r.Y.NONE||t===r.Y.FrontFace?e:o.MT.LEQUAL}function p(t,e){const n=(0,i.LG)(e);return t===r.Y.ColorAlpha?n?{buffers:[o.r6,o.yI,o.Fq]}:{buffers:[o.r6,o.yI]}:n?{buffers:[o.r6,o.yI]}:null}},61337:(t,e,n)=>{n.d(e,{b:()=>s});var i,r=n(57528),o=n(86955);function s(t){t.code.add((0,o.H)(i||(i=(0,r.A)(["vec3 tonemapACES(vec3 x) {\nreturn clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);\n}"]))))}},61785:(t,e,n)=>{n.d(e,{E:()=>r});var i=n(81806);function r(){return!!(0,i.A)("enable-feature:objectAndLayerId-rendering")}},63048:(t,e,n)=>{n.d(e,{Gd:()=>F,J_:()=>L,VC:()=>U,b3:()=>B,s_:()=>P,ul:()=>z,wI:()=>w});n(81806);var i,r,o=n(15941),s=n(63919),a=n(44680),l=n(34761),c=n(13191),u=n(20664),d=n(9392),h=n(43047),f=n(55855),v=n(3454),p=n(85632),m=n(22955),g=n(61785),_=n(31432);!function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"}(i||(i={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(r||(r={}));class A{constructor(t){this.field=t}}class T extends A{constructor(t){super(t),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[i.Undefined,i.Undefined,i.Undefined],this.fallback=[0,0,0]}}class E extends A{constructor(t){super(t),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0],this.fallback=[0,0,0,0]}}class S extends A{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super(t),this.fallback=e,this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}}class b{}function y(t){return null!=t}function x(t,e){t&&t.push(e)}function O(t,e,n,r,o){const s=t.minSize,a=t.maxSize;if(t.useSymbolValue){const t=r.symbolSize[n];return e.minSize[n]=t,e.maxSize[n]=t,e.offset[n]=e.minSize[n],e.factor[n]=0,e.type[n]=i.DefinedSize,!0}if(y(t.field))return y(t.stops)?2===t.stops.length&&(0,p.Et)(t.stops[0].size)&&(0,p.Et)(t.stops[1].size)?(R(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,n),e.type[n]=i.DefinedSize,!0):(x(o,"Could not convert size info: stops only supported with 2 elements"),!1):(0,p.Et)(s)&&(0,p.Et)(a)&&y(t.minDataValue)&&y(t.maxDataValue)?(R(s,a,t.minDataValue,t.maxDataValue,e,n),e.type[n]=i.DefinedSize,!0):"unknown"===t.valueUnit?(x(o,"Could not convert size info: proportional size not supported"),!1):null!=v.j[t.valueUnit]?(e.minSize[n]=-1/0,e.maxSize[n]=1/0,e.offset[n]=0,e.factor[n]=1/v.j[t.valueUnit],e.type[n]=i.DefinedSize,!0):(x(o,"Could not convert size info: scale-dependent size not supported"),!1);if(!y(t.field)){var l;if(null!==(l=t.stops)&&void 0!==l&&l[0]&&(0,p.Et)(t.stops[0].size))return e.minSize[n]=t.stops[0].size,e.maxSize[n]=t.stops[0].size,e.offset[n]=e.minSize[n],e.factor[n]=0,e.type[n]=i.DefinedSize,!0;if((0,p.Et)(s))return e.minSize[n]=s,e.maxSize[n]=s,e.offset[n]=s,e.factor[n]=0,e.type[n]=i.DefinedSize,!0}return x(o,"Could not convert size info: unsupported variant of sizeInfo"),!1}function R(t,e,n,i,r,o){const s=Math.abs(i-n)>0?(e-t)/(i-n):0;r.minSize[o]=s>0?t:e,r.maxSize[o]=s>0?e:t,r.offset[o]=t-n*s,r.factor[o]=s}function C(t,e,n){t[4*e]=n.r/255,t[4*e+1]=n.g/255,t[4*e+2]=n.b/255,t[4*e+3]=n.a}function I(t,e,n){const i=2===n&&"arithmetic"===t.rotationType;e.offset[n]=i?90:0,e.factor[n]=i?-1:1,e.type[n]=1}class w{constructor(t){let{supports:e,modelSize:n,symbolSize:i,unitInMeters:r,anchor:o,scale:s,rotation:a,fallbackColor:l,fallbackSize:c}=t;this.supports=e,this.modelSize=null!==n&&void 0!==n?n:(0,d.S)(),this.symbolSize=null!==i&&void 0!==i?i:(0,d.S)(),this.unitInMeters=null!==r&&void 0!==r?r:1,this.anchor=null!==o&&void 0!==o?o:(0,d.Ul)(),this.scale=null!==s&&void 0!==s?s:(0,d.S)(),this.rotation=null!==a&&void 0!==a?a:(0,d.Ul)(),this.fallbackColor=null!==l&&void 0!==l?l:(0,f.S)(),this.fallbackSize=null!==c&&void 0!==c?c:(0,d.S)()}}function M(t,e,n){if(!t)return null;const r=t.reduce((t,i)=>{if(!t)return t;if(i.valueExpression)return x(n,"Could not convert visual variables: arcade expressions not supported"),null;switch(i.type){case"size":return e.supports.size?function(t,e,n,i){if(t.normalizationField||t.valueRepresentation)return x(i,"Could not convert size info: unsupported property"),null;if(!(0,p.CO)(t.field))return x(i,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return x(i,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new T(t.field),(0,u.c)(e.size.fallback,n.fallbackSize);let r;switch(t.axis){case"width":return r=O(t,e.size,0,n,i),r?e:null;case"height":return r=O(t,e.size,2,n,i),r?e:null;case"depth":return r=O(t,e.size,1,n,i),r?e:null;case"width-and-depth":return r=O(t,e.size,0,n,i),r&&O(t,e.size,1,n,i),r?e:null;case null:case void 0:case"all":return r=O(t,e.size,0,n,i),r=r&&O(t,e.size,1,n,i),r=r&&O(t,e.size,2,n,i),r?e:null;default:return x(i,'Could not convert size info: unknown axis "'.concat(t.axis,'""')),null}}(i,t,e,n):t;case"color":return e.supports.color?function(t,e,n,i){if(t.normalizationField)return x(i,"Could not convert color info: unsupported property"),null;if((0,p.Kg)(t.field)){if(!t.stops)return x(i,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return x(i,"Could not convert color info: too many color stops"),null;e.color=new E(t.field);const r=t.stops;for(let t=0;t<8;++t){const n=r[Math.min(t,r.length-1)];e.color.values[t]=n.value,C(e.color.colors,t,n.color)}(0,h.c)(e.color.fallback,n.fallbackColor)}}else{if(!(t.stops&&t.stops.length>=0))return x(i,"Could not convert color info: no field and no colors/stops"),null;{const i=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color=new E(null);for(let t=0;t<8;t++)e.color.values[t]=1/0,C(e.color.colors,t,i);(0,h.c)(e.color.fallback,n.fallbackColor)}}return e}(i,t,e,n):t;case"opacity":return e.supports.opacity?function(t,e,n,i){if(t.normalizationField)return x(i,"Could not convert opacity info: unsupported property"),null;if((0,p.Kg)(t.field)){if(!t.stops)return x(i,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return x(i,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new S(t.field,n.fallbackColor[3]);const r=t.stops;for(let t=0;t<8;++t){const n=r[Math.min(t,r.length-1)];e.opacity.values[t]=n.value,e.opacity.opacityValues[t]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return x(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0],fallback:n.fallbackColor[3]};for(let t=0;t<8;t++)e.opacity.values[t]=1/0,e.opacity.opacityValues[t]=i}}return e}(i,t,e,n):null;case"rotation":return e.supports.rotation?function(t,e,n){if(!(0,p.Kg)(t.field))return x(n,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return x(n,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return I(t,e.rotation,0),e;case"roll":return I(t,e.rotation,1),e;case null:case void 0:case"heading":return I(t,e.rotation,2),e;default:return x(n,'Could not convert rotation info: unknown axis "'.concat(t.axis,'""')),null}}(i,t,n):t;default:return null}},new b);return!(t.length>0&&r)||r.size||r.color||r.opacity||r.rotation?null!==r&&void 0!==r&&r.size&&!function(t,e,n){for(let o=0;o<3;++o){let n=e.unitInMeters;t.type[o]===i.DefinedSize&&(n*=e.modelSize[o],t.type[o]=i.DefinedScale),t.minSize[o]=t.minSize[o]/n,t.maxSize[o]=t.maxSize[o]/n,t.offset[o]=t.offset[o]/n,t.factor[o]=t.factor[o]/n}let r;if(t.type[0]!==i.Undefined)r=0;else if(t.type[1]!==i.Undefined)r=1;else{if(t.type[2]===i.Undefined)return x(n,"No size axis contains a valid size or scale"),!1;r=2}for(let o=0;o<3;++o)t.type[o]===i.Undefined&&(t.minSize[o]=t.minSize[r],t.maxSize[o]=t.maxSize[r],t.offset[o]=t.offset[r],t.factor[o]=t.factor[r],t.type[o]=t.type[r]);return!0}(r.size,e,n)?null:r:null}class N{constructor(t,e,n){this.visualVariables=t,this.materialParameters=e,this.requiresShaderTransformation=n}}function P(t,e){if(!t)return null;if((0,g.E)())return null;if(m.b.TESTS_DISABLE_FAST_UPDATES)return null;const n=M(t.visualVariables,e);return n?new N(n,H(n,e),!!n.size):null}function L(t,e,n){if(!e||!t)return!1;const i=t.visualVariables,r=M(e.visualVariables,n);return!!r&&!!(D(i.size,r.size,"size")&&D(i.color,r.color,"color")&&D(i.rotation,r.rotation,"rotation")&&D(i.opacity,r.opacity,"opacity"))&&(t.visualVariables=r,t.materialParameters=H(r,n),t.requiresShaderTransformation=!!r.size,!0)}function D(t,e,n){if(!!t!=!!e)return!1;if(t&&t.field!==(null===e||void 0===e?void 0:e.field))return!1;if(t&&"rotation"===n){const n=t,i=e;for(let t=0;t<3;t++)if(n.type[t]!==i.type[t]||n.offset[t]!==i.offset[t]||n.factor[t]!==i.factor[t])return!1}return!0}class F extends _.Y{constructor(t){var e,n,i;super(),this.vvSize=null!==(e=null===t||void 0===t?void 0:t.size)&&void 0!==e?e:null,this.vvColor=null!==(n=null===t||void 0===t?void 0:t.color)&&void 0!==n?n:null,this.vvOpacity=null!==(i=null===t||void 0===t?void 0:t.opacity)&&void 0!==i?i:null}}function H(t,e){const n=new F(t);return n.vvSize&&(n.vvSymbolAnchor=e.anchor,(0,l.D_)(G),function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,c.vt)();const r=t||0,o=e||0,s=n||0;0!==r&&(0,l.Qr)(i,i,-r/180*Math.PI),0!==o&&(0,l.eL)(i,i,o/180*Math.PI),0!==s&&(0,l.Z8)(i,i,s/180*Math.PI)}(e.rotation[2],e.rotation[0],e.rotation[1],G),n.vvSymbolRotationMatrix=n.vvSymbolRotationMatrix||(0,a.vt)(),(0,s.z0)(n.vvSymbolRotationMatrix,G)),n}function B(t,e,n){if(!t.vvSize)return n;(0,l.C)(V,n);const i=t.vvSymbolRotationMatrix;return(0,l.hZ)(G,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),(0,l.lw)(V,V,G),U(W,t,e),(0,l.hs)(V,V,W),(0,l.Tl)(V,V,t.vvSymbolAnchor),V}function U(t,e,n){if(!e.vvSize)return(0,u.i)(t,1,1,1),t;if(Number.isNaN(n[0]))return(0,u.c)(t,e.vvSize.fallback);for(let i=0;i<3;++i){const r=e.vvSize.offset[i]+n[0]*e.vvSize.factor[i];t[i]=(0,o.qE)(r,e.vvSize.minSize[i],e.vvSize.maxSize[i])}return t}function z(t,e){const n=null==t?0:e.attributes[t];return"number"==typeof n&&isFinite(n)?n:NaN}const V=(0,c.vt)(),W=(0,d.vt)(),G=(0,c.vt)()},65058:(t,e,n)=>{n.d(e,{E:()=>d});var i,r,o,s=n(57528),a=n(19555),l=n(72745),c=n(28450),u=n(86955);function d(t){t.uniforms.add(new c.E("zProjectionMap",t=>function(t){const e=t.projectionMatrix;return(0,a.hZ)(h,e[14],e[10])}(t.camera))),t.code.add((0,u.H)(i||(i=(0,s.A)(["float linearizeDepth(float depth) {\nfloat depthNdc = depth * 2.0 - 1.0;\nfloat c1 = zProjectionMap[0];\nfloat c2 = zProjectionMap[1];\nreturn -(c1 / (depthNdc + c2 + 1e-7));\n}"])))),t.code.add((0,u.H)(r||(r=(0,s.A)(["float depthFromTexture(sampler2D depthTexture, vec2 uv) {\nivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));\nfloat depth = texelFetch(depthTexture, iuv, 0).r;\nreturn depth;\n}"])))),t.code.add((0,u.H)(o||(o=(0,s.A)(["float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {\nreturn linearizeDepth(depthFromTexture(depthTexture, uv));\n}"]))))}const h=(0,l.vt)()},66701:(t,e,n)=>{n.d(e,{F:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e,n){super(t,"vec4",i.c.Pass,(n,i,r)=>n.setUniform4fv(t,e(i,r)),n)}}},66763:(t,e,n)=>{n.d(e,{A:()=>A});var i,r,o,s,a,l,c,u=n(57528),d=n(5517),h=n(58350),f=n(66701),v=n(60205),p=n(86955),m=n(72106),g=n(66470),_=n(93684);function A(t,e){const{vertex:n,attributes:A}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&A.add(g.r.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(n.uniforms.add(new d.t("vvSizeMinSize",t=>t.vvSize.minSize)),n.uniforms.add(new d.t("vvSizeMaxSize",t=>t.vvSize.maxSize)),n.uniforms.add(new d.t("vvSizeOffset",t=>t.vvSize.offset)),n.uniforms.add(new d.t("vvSizeFactor",t=>t.vvSize.factor)),n.uniforms.add(new d.t("vvSizeFallback",t=>t.vvSize.fallback)),n.uniforms.add(new m.k("vvSymbolRotationMatrix",t=>t.vvSymbolRotationMatrix)),n.uniforms.add(new d.t("vvSymbolAnchor",t=>t.vvSymbolAnchor)),n.code.add((0,p.H)(i||(i=(0,u.A)(["vec3 vvScale(vec4 _featureAttribute) {\nif (isnan(_featureAttribute.x)) {\nreturn vvSizeFallback;\n}\nreturn clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n}\nvec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\nreturn vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n}"])))),n.code.add((0,p.H)(r||(r=(0,u.A)(["\n      const float eps = 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 scale = max(vvScale(_featureAttribute), eps);\n        return vec4(vvSymbolRotationMatrix * _normal / scale, 1.0);\n      }\n\n      ","\n    "])),e.hasVvInstancing?(0,p.H)(o||(o=(0,u.A)(["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"]))):""))):n.code.add((0,p.H)(s||(s=(0,u.A)(["vec4 localPosition() { return vec4(position, 1.0); }\nvec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }"])))),e.vvColor?(n.constants.add("vvColorNumber","int",_.p),n.uniforms.add(new v.x("vvColorValues",t=>t.vvColor.values,_.p),new f.F("vvColorColors",t=>t.vvColor.colors,_.p),new h.E("vvColorFallback",t=>t.vvColor.fallback)),n.code.add((0,p.H)(a||(a=(0,u.A)(["\n      vec4 interpolateVVColor(float value) {\n        if (isnan(value)) {\n          return vvColorFallback;\n        }\n\n        if (value <= vvColorValues[0]) {\n          return vvColorColors[0];\n        }\n\n        for (int i = 1; i < vvColorNumber; ++i) {\n          if (vvColorValues[i] >= value) {\n            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n            return mix(vvColorColors[i-1], vvColorColors[i], f);\n          }\n        }\n        return vvColorColors[vvColorNumber - 1];\n      }\n\n      vec4 vvGetColor(vec4 featureAttribute) {\n        return interpolateVVColor(featureAttribute.y);\n      }\n\n      ","\n    "])),e.hasVvInstancing?(0,p.H)(l||(l=(0,u.A)(["\n            vec4 vvColor() {\n              return vvGetColor(instanceFeatureAttribute);\n            }"]))):"vec4 vvColor() { return vec4(1.0); }"))):n.code.add((0,p.H)(c||(c=(0,u.A)(["vec4 vvColor() { return vec4(1.0); }"]))))}},67582:(t,e,n)=>{n.d(e,{o:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"bool",i.c.Bind,(n,i)=>n.setUniform1b(t,e(i)))}}},69817:(t,e,n)=>{n.d(e,{OH:()=>m,Y6:()=>v,pM:()=>p});var i,r,o,s,a,l,c=n(57528),u=n(20664),d=n(9392),h=n(5517),f=n(86955);function v(t){t.vertex.code.add((0,f.H)(i||(i=(0,c.A)(["float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\nreturn absCosAngle * absCosAngle * absCosAngle;\n}"])))),t.vertex.code.add((0,f.H)(r||(r=(0,c.A)(["vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {\nreturn vec3(\nmin(params.x / (distanceToCamera - params.y), 1.0),\nscreenSizePerspectiveViewAngleDependentFactor(absCosAngle),\nparams.z\n);\n}"])))),t.vertex.code.add((0,f.H)(o||(o=(0,c.A)(["float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {\nreturn mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);\n}"])))),t.vertex.code.add((0,f.H)(s||(s=(0,c.A)(["float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {\nreturn applyScreenSizePerspectiveScaleFactorFloat(\nsize,\nscreenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n);\n}"])))),t.vertex.code.add((0,f.H)(a||(a=(0,c.A)(["vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {\nreturn mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);\n}"])))),t.vertex.code.add((0,f.H)(l||(l=(0,c.A)(["vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {\nreturn applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}"]))))}function p(t){t.uniforms.add(new h.t("screenSizePerspective",t=>g(t.screenSizePerspective)))}function m(t){t.uniforms.add(new h.t("screenSizePerspectiveAlignment",t=>g(t.screenSizePerspectiveAlignment||t.screenSizePerspective)))}function g(t){return(0,u.i)(_,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}const _=(0,d.vt)()},70367:(t,e,n)=>{n.d(e,{N:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"sampler2D",i.c.Pass,(n,i,r)=>n.bindTexture(t,e(i,r)))}}},71011:(t,e,n)=>{n.d(e,{$p:()=>r,Qx:()=>s,_y:()=>o,e_:()=>a});var i=n(9392);class r{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.Ul)();this.intensity=t}}class o{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.Ul)(),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,i.fA)(.57735,.57735,.57735);this.intensity=t,this.direction=e}}class s{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.Ul)(),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,i.fA)(.57735,.57735,.57735),n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this.intensity=t,this.direction=e,this.castShadows=n,this.specularStrength=r,this.environmentStrength=o}}class a{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},72001:(t,e,n)=>{var i;n.d(e,{Y:()=>i}),function(t){t[t.NONE=0]="NONE",t[t.ColorAlpha=1]="ColorAlpha",t[t.FrontFace=2]="FrontFace",t[t.COUNT=3]="COUNT"}(i||(i={}))},72106:(t,e,n)=>{n.d(e,{k:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"mat3",i.c.Pass,(n,i,r)=>n.setUniformMatrix3fv(t,e(i,r)))}}},72412:(t,e,n)=>{n.d(e,{i$:()=>v,oD:()=>p,xJ:()=>f});var i,r,o,s,a=n(57528),l=n(34981),c=n(36358),u=n(28450),d=n(86955);function h(t){t.varyings.add("linearDepth","float",{invariant:!0})}function f(t){t.vertex.uniforms.add(new u.E("nearFar",t=>t.camera.nearFar))}function v(t){t.vertex.code.add((0,d.H)(i||(i=(0,a.A)(["float calculateLinearDepth(vec2 nearFar,float z) {\nreturn (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);\n}"]))))}function p(t,e){const{vertex:n}=t;switch(e.output){case l.V.Color:case l.V.ColorEmission:if(e.receiveShadows)return h(t),void n.code.add((0,d.H)(r||(r=(0,a.A)(["void forwardLinearDepth() { linearDepth = gl_Position.w; }"]))));break;case l.V.Shadow:case l.V.ShadowHighlight:case l.V.ShadowExcludeHighlight:case l.V.ViewshedShadow:return t.include(c.em,e),h(t),f(t),v(t),void n.code.add((0,d.H)(o||(o=(0,a.A)(["void forwardLinearDepth() {\nlinearDepth = calculateLinearDepth(nearFar, vPosition_view.z);\n}"]))))}n.code.add((0,d.H)(s||(s=(0,a.A)(["void forwardLinearDepth() {}"]))))}},72468:(t,e,n)=>{n.d(e,{W:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"vec3",i.c.Draw,(n,i,r,o)=>n.setUniform3fv(t,e(i,r,o)))}}},72790:(t,e,n)=>{n.d(e,{c:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"int",i.c.Pass,(n,i,r)=>n.setUniform1i(t,e(i,r)))}}},73398:(t,e,n)=>{n.d(e,{c:()=>l});var i,r,o=n(57528),s=n(86955),a=n(66470);function l(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.attributes.add(a.r.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.main.add((0,s.H)(i||(i=(0,o.A)(["\n      gl_Position = vec4(position, 0.0, 1.0);\n      ","\n  "])),e?(0,s.H)(r||(r=(0,o.A)(["uv = position * 0.5 + vec2(0.5);"]))):""))}},74957:(t,e,n)=>{n.d(e,{NV:()=>i,zd:()=>r});var i,r,o,s=n(93345),a=n(96673),l=n(82751);(o=i||(i={}))[o.R8UNORM=0]="R8UNORM",o[o.R8UINT=1]="R8UINT",o[o.RG8UNORM=2]="RG8UNORM",o[o.RG8UINT=3]="RG8UINT",o[o.RGBA4UNORM=4]="RGBA4UNORM",o[o.RGBA8UNORM=5]="RGBA8UNORM",o[o.RGBA8UNORM_MIPMAP=6]="RGBA8UNORM_MIPMAP",o[o.R16FLOAT=7]="R16FLOAT",o[o.RGBA16FLOAT=8]="RGBA16FLOAT",o[o.R32FLOAT=9]="R32FLOAT",o[o.COUNT=10]="COUNT",function(t){t[t.DEPTH16=10]="DEPTH16",t[t.DEPTH24_STENCIL8=11]="DEPTH24_STENCIL8"}(r||(r={}));i.R8UNORM,i.R8UINT,i.R16FLOAT,i.R32FLOAT,i.RG8UNORM,i.RG8UINT,i.RGBA8UNORM,i.RGBA4UNORM,i.RGBA8UNORM_MIPMAP,i.RGBA16FLOAT,r.DEPTH16,r.DEPTH24_STENCIL8;const c=new a.R;c.pixelFormat=s.Ab.RED,c.internalFormat=s.H0.R8,c.wrapMode=s.pF.CLAMP_TO_EDGE;const u=new a.R;u.pixelFormat=s.Ab.RED_INTEGER,u.internalFormat=s.H0.R8UI,u.wrapMode=s.pF.CLAMP_TO_EDGE,u.samplingMode=s.Cj.NEAREST;const d=new a.R;d.pixelFormat=s.Ab.RG,d.internalFormat=s.H0.RG8,d.wrapMode=s.pF.CLAMP_TO_EDGE;const h=new a.R;h.pixelFormat=s.Ab.RG_INTEGER,h.internalFormat=s.H0.RG8UI,h.wrapMode=s.pF.CLAMP_TO_EDGE,h.samplingMode=s.Cj.NEAREST;const f=new a.R;f.internalFormat=s.H0.RGBA4,f.dataType=s.ld.UNSIGNED_SHORT_4_4_4_4,f.wrapMode=s.pF.CLAMP_TO_EDGE;const v=new a.R;v.wrapMode=s.pF.CLAMP_TO_EDGE;const p=new a.R;p.wrapMode=s.pF.CLAMP_TO_EDGE,p.samplingMode=s.Cj.LINEAR_MIPMAP_LINEAR,p.hasMipmap=!0,p.maxAnisotropy=8;const m=new a.R;m.pixelFormat=s.Ab.RED,m.dataType=s.ld.HALF_FLOAT,m.internalFormat=s.H0.R16F,m.samplingMode=s.Cj.NEAREST;const g=new a.R;g.dataType=s.ld.HALF_FLOAT,g.internalFormat=s.H0.RGBA16F,g.wrapMode=s.pF.CLAMP_TO_EDGE;const _=new a.R;_.pixelFormat=s.Ab.RED,_.dataType=s.ld.FLOAT,_.internalFormat=s.H0.R32F,_.samplingMode=s.Cj.NEAREST;i.R8UNORM,i.R8UINT,i.RG8UNORM,i.RG8UINT,i.RGBA4UNORM,i.RGBA8UNORM,i.RGBA8UNORM_MIPMAP,i.R16FLOAT,i.RGBA16FLOAT,i.R32FLOAT,i.COUNT;const A={[s.SB.DEPTH_COMPONENT16]:s.ld.UNSIGNED_SHORT,[s.SB.DEPTH_COMPONENT24]:s.ld.UNSIGNED_INT,[s.SB.DEPTH_COMPONENT32F]:s.ld.FLOAT,[s.iE.DEPTH24_STENCIL8]:s.ld.UNSIGNED_INT_24_8,[s.iE.DEPTH32F_STENCIL8]:s.ld.FLOAT_32_UNSIGNED_INT_24_8_REV};r.DEPTH24_STENCIL8,T(s.iE.DEPTH24_STENCIL8),r.DEPTH16,T(s.SB.DEPTH_COMPONENT16);function T(t){const e=new a.R;return e.pixelFormat=(0,l.CR)(t)?s.j7.DEPTH_COMPONENT:s.j7.DEPTH_STENCIL,e.dataType=A[t],e.samplingMode=s.Cj.NEAREST,e.wrapMode=s.pF.CLAMP_TO_EDGE,e.internalFormat=t,e.hasMipmap=!1,e.isImmutable=!0,e}},75002:(t,e,n)=>{n.d(e,{AK:()=>s,Wz:()=>o,oe:()=>r});var i=n(78393);function r(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t<=i.y9?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function o(t){return(Array.isArray(t)?t.length:t.byteLength/8)<=i.y9?Array.from(t):new Float32Array(t)}function s(t,e,n){return Array.isArray(t)?t.slice(e,e+n):t.subarray(e,e+n)}},75569:(t,e,n)=>{n.d(e,{Q:()=>i});const i=1/255.5},75803:(t,e,n)=>{n.d(e,{NV:()=>u,m8:()=>l});var i=n(30726),r=n(50346),o=n(83490),s=n(59696),a=n(31432);class l extends s.A{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textures=t.textures,this.updateTexture(t.textureId),this._acquire(t.normalTextureId,t=>this._textureNormal=t),this._acquire(t.emissiveTextureId,t=>this._textureEmissive=t),this._acquire(t.occlusionTextureId,t=>this._textureOcclusion=t),this._acquire(t.metallicRoughnessTextureId,t=>this._textureMetallicRoughness=t)}dispose(){super.dispose(),this._texture=(0,i.Gz)(this._texture),this._textureNormal=(0,i.Gz)(this._textureNormal),this._textureEmissive=(0,i.Gz)(this._textureEmissive),this._textureOcclusion=(0,i.Gz)(this._textureOcclusion),this._textureMetallicRoughness=(0,i.Gz)(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return 0===this._numLoading?o.Am.LOADED:o.Am.LOADING}get textureBindParameters(){var t,e,n,i,r,o,s,a,l,c;return new u(null!==(t=null===(e=this._texture)||void 0===e?void 0:e.glTexture)&&void 0!==t?t:null,null!==(n=null===(i=this._textureNormal)||void 0===i?void 0:i.glTexture)&&void 0!==n?n:null,null!==(r=null===(o=this._textureEmissive)||void 0===o?void 0:o.glTexture)&&void 0!==r?r:null,null!==(s=null===(a=this._textureOcclusion)||void 0===a?void 0:a.glTexture)&&void 0!==s?s:null,null!==(l=null===(c=this._textureMetallicRoughness)||void 0===c?void 0:c.glTexture)&&void 0!==l?l:null)}updateTexture(t){null!=this._texture&&t===this._texture.id||(this._texture=(0,i.Gz)(this._texture),this._acquire(t,t=>this._texture=t))}_acquire(t,e){if(null==t)return void e(null);const n=this._textures.acquire(t);if((0,r.$X)(n))return++this._numLoading,void n.then(t=>{if(this._disposed)return(0,i.Gz)(t),void e(null);e(t)}).finally(()=>--this._numLoading);e(n)}}class c extends a.Y{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.textureEmissive=t}}class u extends c{constructor(t,e,n,i,r,o,s){super(n),this.texture=t,this.textureNormal=e,this.textureOcclusion=i,this.textureMetallicRoughness=r,this.scale=o,this.normalTextureTransformMatrix=s}}},76632:(t,e,n)=>{n.d(e,{g:()=>B});var i=n(89379),r=(n(81806),n(50076)),o=n(54099),s=n(30726),a=n(50346),l=n(78393),c=n(90632),u=n(90534),d=n(23079),h=n(49003),f=n(76312),v=n(83490),p=n(28899);let m;var g=n(45235),_=n(93345),A=n(29492),T=n(27207);let E=null,S=null;async function b(){return null==S&&(null!==m&&void 0!==m||(m=(async()=>{const t=await n.e(4027).then(n.bind(n,84027)),e=await t.default({locateFile:t=>(0,p.s)("esri/libs/basisu/".concat(t))});return e.initializeBasis(),e})()),S=m,E=await S),S}function y(t,e,n,i,r){const o=(0,T.IB)(e?_.CQ.COMPRESSED_RGBA8_ETC2_EAC:_.CQ.COMPRESSED_RGB8_ETC2),s=r&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(n*i*o*s)}function x(t){return t.getNumImages()>=1&&!t.isUASTC()}function O(t){return t.getFaces()>=1&&t.isETC1S()}function R(t,e,n,i,r,o,s,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,d]=l?i?[g.n.ETC2_RGBA,_.CQ.COMPRESSED_RGBA8_ETC2_EAC]:[g.n.ETC1_RGB,_.CQ.COMPRESSED_RGB8_ETC2]:c?i?[g.n.BC3_RGBA,_.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[g.n.BC1_RGB,_.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT]:[g.n.RGBA32,_.Ab.RGBA],h=e.hasMipmap?n:Math.min(1,n),f=[];for(let v=0;v<h;v++)f.push(new Uint8Array(s(v,u))),a(v,u,f[v]);return e.internalFormat=d,e.hasMipmap=f.length>1,e.samplingMode=e.hasMipmap?_.Cj.LINEAR_MIPMAP_LINEAR:_.Cj.LINEAR,e.width=r,e.height=o,new A.g(t,e,{type:"compressed",levels:f})}var C=n(76460);const I=()=>C.A.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function w(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}const M=w("DXT1"),N=w("DXT3"),P=w("DXT5");function L(t,e){const n=new Int32Array(t.buffer,t.byteOffset,31);if(542327876!==n[0])return I().error("Invalid magic number in DDS header"),null;if(!(4&n[20]))return I().error("Unsupported format, must contain a FourCC code"),null;const i=n[21];let r,o;switch(i){case M:r=8,o=_.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case N:r=16,o=_.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case P:r=16,o=_.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return I().error("Unsupported FourCC code:",function(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}(i)),null}let s=1,a=n[4],l=n[3];(3&a||3&l)&&(I().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let d,h;131072&n[2]&&!1!==e&&(s=Math.max(1,n[7]));let f=t.byteOffset+n[1]+4;const v=[];for(let p=0;p<s;++p)h=(a+3>>2)*(l+3>>2)*r,d=new Uint8Array(t.buffer,f,h),v.push(d),f+=h,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:v},internalFormat:o,width:c,height:u}}var D=n(81330),F=n(86994),H=n(96673);class B{constructor(t,e){this._data=t,this.id=(0,c.c)(),this.events=new o.A,this._parameters=(0,i.A)((0,i.A)({},z),e),this._startPreload(t)}dispose(){this.unload(),this._data=this.update=void 0}_startPreload(t){t instanceof HTMLVideoElement?(this.update=e=>this._update(t,e),this._startPreloadVideoElement(t)):t instanceof HTMLImageElement&&this._startPreloadImageElement(t)}_startPreloadVideoElement(t){if(!((0,u.w8)(t.src)||"auto"===t.preload&&t.crossOrigin)&&(t.preload="auto",t.crossOrigin="anonymous",t.src=t.src,t.paused&&t.autoplay)){const e=[];(0,d.i)(t,t=>e.push(t)).then(()=>{t.play()}).finally(()=>e.forEach(t=>t.remove()))}}_startPreloadImageElement(t){(0,u.DB)(t.src)||(0,u.w8)(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}_createDescriptor(t){var e,n;const i=new H.R;return i.wrapMode=null!==(e=this._parameters.wrap)&&void 0!==e?e:_.pF.REPEAT,i.flipped=!this._parameters.noUnpackFlip,i.samplingMode=this._parameters.mipmap?_.Cj.LINEAR_MIPMAP_LINEAR:_.Cj.LINEAR,i.hasMipmap=!!this._parameters.mipmap,i.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,i.maxAnisotropy=null!==(n=this._parameters.maxAnisotropy)&&void 0!==n?n:this._parameters.mipmap?t.parameters.maxMaxAnisotropy:1,i}get glTexture(){var t;return null!==(t=this._glTexture)&&void 0!==t?t:this._emptyTexture}get loaded(){return null!=this._glTexture}get usedMemory(){var t;return(null===(t=this._glTexture)||void 0===t?void 0:t.usedMemory)||function(t,e){if(null==t)return 0;if((0,l.mw)(t)||(0,l.mg)(t))return e.encoding===v.JS.KTX2_ENCODING?function(t,e){if(null==E)return t.byteLength;const n=new E.KTX2File(new Uint8Array(t)),i=O(n)?y(n.getLevels(),n.getHasAlpha(),n.getWidth(),n.getHeight(),e):0;return n.close(),n.delete(),i}(t,!!e.mipmap):e.encoding===v.JS.BASIS_ENCODING?function(t,e){if(null==E)return t.byteLength;const n=new E.BasisFile(new Uint8Array(t)),i=x(n)?y(n.getNumLevels(0),n.getHasAlpha(),n.getImageWidth(0,0),n.getImageHeight(0,0),e):0;return n.close(),n.delete(),i}(t,!!e.mipmap):t.byteLength;const{width:n,height:i}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?U(t):e;return(e.mipmap?4/3:1)*n*i*(e.components||4)||0}(this._data,this._parameters)}load(t){if(this._loadingPromise)return this._loadingPromise;if(this._glTexture)return this._glTexture;const e=this._data;return null==e?(this._glTexture=new A.g(t,this._createDescriptor(t),null),this._glTexture):(this._emptyTexture=t.emptyTexture,this._parameters.reloadable||(this._data=void 0),"string"==typeof e?this._loadFromURL(t,e):e instanceof Image?this._loadFromImageElement(t,e):e instanceof HTMLVideoElement?this._loadFromVideoElement(t,e):e instanceof ImageData||e instanceof HTMLCanvasElement?this._loadFromImage(t,e):(0,l.mg)(e)&&this._parameters.encoding===v.JS.DDS_ENCODING?this._loadFromDDSData(t,e):(0,l.mw)(e)&&this._parameters.encoding===v.JS.DDS_ENCODING?this._loadFromDDSData(t,new Uint8Array(e)):((0,l.mw)(e)||(0,l.mg)(e))&&this._parameters.encoding===v.JS.KTX2_ENCODING?this._loadFromKTX2(t,e):((0,l.mw)(e)||(0,l.mg)(e))&&this._parameters.encoding===v.JS.BASIS_ENCODING?this._loadFromBasis(t,e):(0,l.mg)(e)?this._loadFromPixelData(t,e):(0,l.mw)(e)?this._loadFromPixelData(t,new Uint8Array(e)):null)}_update(t,e){return null==this._glTexture||t.readyState<HTMLMediaElement.HAVE_CURRENT_DATA||e===t.currentTime?e:(this._glTexture.setData(t),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),t.currentTime)}_loadFromDDSData(t,e){return this._glTexture=function(t,e,n){var i;const r=L(n,null!==(i=e.hasMipmap)&&void 0!==i&&i);if(null==r)throw new Error("DDS texture data is null");const{textureData:o,internalFormat:s,width:a,height:l}=r;return e.samplingMode=o.levels.length>1?_.Cj.LINEAR_MIPMAP_LINEAR:_.Cj.LINEAR,e.hasMipmap=o.levels.length>1,e.internalFormat=s,e.width=a,e.height=l,new A.g(t,e,o)}(t,this._createDescriptor(t),e),this._emptyTexture=null,this._glTexture}_loadFromKTX2(t,e){return this._loadAsync(()=>async function(t,e,n){null==E&&(E=await b());const i=new E.KTX2File(new Uint8Array(n));if(!O(i))return null;i.startTranscoding();const r=R(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(t,e)=>i.getImageTranscodedSizeInBytes(t,0,0,e),(t,e,n)=>i.transcodeImage(n,t,0,0,e,0,-1,-1));return i.close(),i.delete(),r}(t,this._createDescriptor(t),e).then(t=>(this._glTexture=t,t)))}_loadFromBasis(t,e){return this._loadAsync(()=>async function(t,e,n){null==E&&(E=await b());const i=new E.BasisFile(new Uint8Array(n));if(!x(i))return null;i.startTranscoding();const r=R(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(t,e)=>i.getImageTranscodedSizeInBytes(0,t,e),(t,e,n)=>i.transcodeImage(n,0,t,e,0,0));return i.close(),i.delete(),r}(t,this._createDescriptor(t),e).then(t=>(this._glTexture=t,t)))}_loadFromPixelData(t,e){var n,i;(0,F.vA)(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(t);return r.pixelFormat=1===this._parameters.components?_.Ab.LUMINANCE:3===this._parameters.components?_.Ab.RGB:_.Ab.RGBA,r.pixelFormat!==_.Ab.RGB&&r.pixelFormat!==_.Ab.RGBA||(r.compress=this._parameters.compressionOptions),r.width=null!==(n=this._parameters.width)&&void 0!==n?n:0,r.height=null!==(i=this._parameters.height)&&void 0!==i?i:0,this._glTexture=new A.g(t,r,e),this._glTexture}_loadFromURL(t,e){return this._loadAsync(async n=>{const i=await(0,h.D)(e,{signal:n});return(0,a.Te)(n),this._loadFromImage(t,i)})}_loadFromImageElement(t,e){return e.complete?this._loadFromImage(t,e):this._loadAsync(async n=>{const i=await(0,f.Sx)(e,e.src,!1,n);return(0,a.Te)(n),this._loadFromImage(t,i)})}_loadFromVideoElement(t,e){return e.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?this._loadFromImage(t,e):this._loadFromVideoElementAsync(t,e)}_loadFromVideoElementAsync(t,e){return this._loadAsync(n=>new Promise((i,o)=>{const l=()=>{e.removeEventListener("loadeddata",c),e.removeEventListener("error",u),(0,s.xt)(d)},c=()=>{e.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA&&(l(),i(this._loadFromImage(t,e)))},u=t=>{l(),o(t||new r.A("texture:load-error","Failed to load video"))};e.addEventListener("loadeddata",c),e.addEventListener("error",u);const d=(0,a.u7)(n,()=>u((0,a.NK)()))}))}_loadFromImage(t,e){let n=e;n instanceof HTMLVideoElement||(n=(0,D.vM)(n,t.parameters));const i=U(n);this._parameters.width=i.width,this._parameters.height=i.height;const r=this._createDescriptor(t);return r.pixelFormat=3===this._parameters.components?_.Ab.RGB:_.Ab.RGBA,r.width=i.width,r.height=i.height,r.compress=this._parameters.compressionOptions,this._glTexture=new A.g(t,r,n),this._emptyTexture=null,this.events.emit("loaded"),this._glTexture}_loadAsync(t){const e=new AbortController;this._loadingController=e;const n=t(e.signal);this._loadingPromise=n;const i=()=>{this._loadingController===e&&(this._loadingController=null),this._loadingPromise===n&&(this._loadingPromise=null),this._emptyTexture=null};return n.then(i,i),n}unload(){if(this._glTexture=(0,s.WD)(this._glTexture),this._emptyTexture=null,null!=this._loadingController){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}get parameters(){return this._parameters}}function U(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}const z={wrap:{s:_.pF.REPEAT,t:_.pF.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1}},77730:(t,e,n)=>{var i;n.d(e,{N:()=>i}),function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.OPAQUE_MATERIAL_WITHOUT_NORMALS=3]="OPAQUE_MATERIAL_WITHOUT_NORMALS",t[t.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_MATERIAL_WITHOUT_NORMALS=5]="TRANSPARENT_MATERIAL_WITHOUT_NORMALS",t[t.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_MATERIAL_WITHOUT_DEPTH=7]="TRANSPARENT_MATERIAL_WITHOUT_DEPTH",t[t.OCCLUDED_GROUND=8]="OCCLUDED_GROUND",t[t.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",t[t.HUD_MATERIAL=12]="HUD_MATERIAL",t[t.LABEL_MATERIAL=13]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=14]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=15]="LINE_CALLOUTS_HUD_DEPTH",t[t.OVERLAY=16]="OVERLAY",t[t.DRAPED_MATERIAL=17]="DRAPED_MATERIAL",t[t.DRAPED_WATER=18]="DRAPED_WATER",t[t.VOXEL=19]="VOXEL",t[t.MAX_SLOTS=20]="MAX_SLOTS"}(i||(i={}))},78992:(t,e,n)=>{n.d(e,{Bt:()=>a,Jr:()=>o,SY:()=>l,mb:()=>s});var i=n(20664),r=n(9392);function o(t){let{normalTexture:e,metallicRoughnessTexture:n,metallicFactor:o,roughnessFactor:s,emissiveTexture:a,emissiveFactor:l,occlusionTexture:c}=t;return null==e&&null==n&&null==a&&(null==l||(0,i.q)(l,r.uY))&&null==c&&(null==s||1===s)&&(null==o||1===o)}const s=(0,r.CN)(1,1,.5),a=(0,r.CN)(0,.6,.2),l=(0,r.CN)(0,1,.2)},79138:(t,e,n)=>{n.d(e,{y:()=>s});var i,r=n(57528),o=n(86955);function s(t){const{fragment:e}=t;e.code.add((0,o.H)(i||(i=(0,r.A)(["uint readChannelBits(uint channel, int highlightLevel) {\nint llc = (highlightLevel & 3) << 1;\nreturn (channel >> llc) & 3u;\n}\nuint readChannel(uvec2 texel, int highlightLevel) {\nint lic = (highlightLevel >> 2) & 1;\nreturn texel[lic];\n}\nuint readLevelBits(uvec2 texel, int highlightLevel) {\nreturn readChannelBits(readChannel(texel, highlightLevel), highlightLevel);\n}"]))))}},79650:(t,e,n)=>{n.d(e,{a:()=>T,b:()=>j,d:()=>A,f:()=>E,h:()=>y,j:()=>M,u:()=>S});n(81806);var i=n(76460),r=n(15941),o=n(97467),s=n(34761),a=n(13191),l=n(20664),c=n(9392),u=n(2413),d=n(5568),h=n(44230),f=n(13927),v=n(95925),p=n(96190),m=n(75762);const g=()=>i.A.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");const _=class{constructor(){this.plane=(0,f.vt)(),this.origin=(0,c.vt)(),this.basis1=(0,c.vt)(),this.basis2=(0,c.vt)()}};function A(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B;return{plane:(0,f.vt)(t.plane),origin:(0,c.o8)(t.origin),basis1:(0,c.o8)(t.basis1),basis2:(0,c.o8)(t.basis2)}}function T(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A();return E(t.origin,t.basis1,t.basis2,e)}function E(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A();return(0,l.c)(i.origin,t),(0,l.c)(i.basis1,e),(0,l.c)(i.basis2,n),S(i),function(t,e){Math.abs((0,l.e)(t.basis1,t.basis2)/((0,l.l)(t.basis1)*(0,l.l)(t.basis2)))>1e-6&&g().warn(e,"Provided basis vectors are not perpendicular"),Math.abs((0,l.e)(t.basis1,P(t)))>1e-6&&g().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,l.e)(P(t),t.origin)-t.plane[3])>1e-6&&g().warn(e,"Plane offset is not consistent with plane origin")}(i,"fromValues()"),i}function S(t){(0,f.mR)(t.basis2,t.basis1,t.origin,t.plane)}function b(t,e,n){t!==n&&T(t,n);const i=(0,l.g)(m.rq.get(),P(t),e);return(0,l.f)(n.origin,n.origin,i),n.plane[3]-=e,n}function y(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A();const n=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return(0,l.i)(e.origin,t[0]+n,t[1]+i,0),(0,l.i)(e.basis1,n,0,0),(0,l.i)(e.basis2,0,i,0),(0,f.fA)(0,0,1,0,e.plane),e}function x(t,e,n){return!!(0,f.Ui)(t.plane,e,n)&&L(t,n)}function O(t,e,n){const i=U.get();H(t,e,i,U.get());let o=Number.POSITIVE_INFINITY;for(const s of G){const a=F(t,s,z.get()),c=m.rq.get();if((0,f.T7)(i,a,c)){const t=(0,l.E)(m.rq.get(),e.origin,c),i=Math.abs((0,r.XM)((0,l.e)(e.direction,t)));i<o&&(o=i,(0,l.c)(n,c))}}return o===Number.POSITIVE_INFINITY?R(t,e,n):n}function R(t,e,n){if(x(t,e,n))return n;const i=U.get(),r=U.get();H(t,e,i,r);let o=Number.POSITIVE_INFINITY;for(const s of G){const a=F(t,s,z.get()),c=m.rq.get();if((0,f.gv)(i,a,c)){const t=(0,v.kb)(e,c);if(!(0,f.Tj)(r,c))continue;t<o&&(o=t,(0,l.c)(n,c))}}return w(t,e.origin)<o&&C(t,e.origin,n),n}function C(t,e,n){const i=(0,f._I)(t.plane,e,m.rq.get()),r=(0,h.H6)(D(t,t.basis1),i,-1,1,m.rq.get()),o=(0,h.H6)(D(t,t.basis2),i,-1,1,m.rq.get());return(0,l.d)(n,(0,l.f)(m.rq.get(),r,o),t.origin),n}function I(t,e,n){const{origin:i,basis1:r,basis2:o}=t,s=(0,l.d)(m.rq.get(),e,i),a=(0,p.gr)(r,s),c=(0,p.gr)(o,s),u=(0,p.gr)(P(t),s);return(0,l.i)(n,a,c,u)}function w(t,e){const n=I(t,e,m.rq.get()),{basis1:i,basis2:r}=t,o=(0,l.l)(i),s=(0,l.l)(r),a=Math.max(Math.abs(n[0])-o,0),c=Math.max(Math.abs(n[1])-s,0),u=n[2];return a*a+c*c+u*u}function M(t,e){return Math.sqrt(w(t,e))}function N(t,e){const n=-t.plane[3];return(0,p.gr)(P(t),e)-n}function P(t){return(0,f.Qj)(t.plane)}function L(t,e){const n=(0,l.d)(m.rq.get(),e,t.origin),i=(0,l.k)(t.basis1),r=(0,l.k)(t.basis2),o=(0,l.e)(t.basis1,n),s=(0,l.e)(t.basis2,n);return-o-i<0&&o-i<0&&-s-r<0&&s-r<0}function D(t,e){const n=z.get();return(0,l.c)(n.origin,t.origin),(0,l.c)(n.vector,e),n}function F(t,e,n){const{basis1:i,basis2:r,origin:o}=t,s=(0,l.g)(m.rq.get(),i,e.origin[0]),a=(0,l.g)(m.rq.get(),r,e.origin[1]);(0,l.f)(n.origin,s,a),(0,l.f)(n.origin,n.origin,o);const c=(0,l.g)(m.rq.get(),i,e.direction[0]),u=(0,l.g)(m.rq.get(),r,e.direction[1]);return(0,l.g)(n.vector,(0,l.f)(c,c,u),2),n}function H(t,e,n,i){const r=P(t);(0,f.mR)(r,e.direction,e.origin,n),(0,f.mR)((0,f.Qj)(n),r,e.origin,i)}const B={plane:(0,f.vt)(),origin:(0,c.fA)(0,0,0),basis1:(0,c.fA)(1,0,0),basis2:(0,c.fA)(0,1,0)},U=new o.I(f.vt),z=new o.I(h.vt),V=(0,c.vt)(),W=new o.I(()=>A()),G=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],k=(0,a.vt)(),q=(0,a.vt)(),j=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:_,altitudeAt:N,axisAt:function(t,e,n,i){return function(t,e,n){switch(e){case d._.X:(0,l.c)(n,t.basis1),(0,l.n)(n,n);break;case d._.Y:(0,l.c)(n,t.basis2),(0,l.n)(n,n);break;case d._.Z:(0,l.c)(n,P(t))}return n}(t,n,i)},cameraFrustumCoverage:function(t,e){return(e-t)/e},closestPoint:R,closestPointOnSilhouette:O,copy:T,copyWithoutVerify:function(t,e){(0,l.c)(e.origin,t.origin),(0,l.c)(e.basis1,t.basis1),(0,l.c)(e.basis2,t.basis2),(0,f.C)(e.plane,t.plane)},create:A,distance:M,distance2:w,distanceToSilhouette:function(t,e){let n=Number.NEGATIVE_INFINITY;for(const i of G){const r=F(t,i,z.get()),o=(0,h.kb)(r,e);o>n&&(n=o)}return Math.sqrt(n)},elevate:b,equals:function(t,e){return(0,l.q)(t.basis1,e.basis1)&&(0,l.q)(t.basis2,e.basis2)&&(0,l.q)(t.origin,e.origin)},extrusionContainsPoint:function(t,e){return(0,f.Tj)(t.plane,e)&&L(t,e)},fromAABoundingRect:y,fromValues:E,getExtent:function(t,e){const n=t.basis1[0],i=t.basis2[1],[r,o]=t.origin;return(0,u.fA)(r-n,o-i,r+n,o+i,e)},intersectRay:x,intersectRayClosestSilhouette:function(t,e,n){if(x(t,e,n))return n;const i=O(t,e,m.rq.get());return(0,l.f)(n,e.origin,(0,l.g)(m.rq.get(),e.direction,(0,l.j)(e.origin,i)/(0,l.l)(e.direction))),n},normal:P,projectPoint:C,projectPointLocal:I,rotate:function(t,e,n,i){return t!==i&&T(t,i),(0,s.$0)(q,e,n),(0,l.t)(i.basis1,t.basis1,q),(0,l.t)(i.basis2,t.basis2,q),S(i),i},setAltitudeAt:function(t,e,n,i){const r=N(t,e),o=(0,l.g)(V,P(t),n-r);return(0,l.f)(i,e,o),i},setExtent:function(t,e,n){return y(e,n),b(n,N(t,t.origin),n),n},transform:function(t,e,n){return t!==n&&T(t,n),(0,s.B8)(k,e),(0,s.mg)(k,k),(0,l.t)(n.basis1,t.basis1,k),(0,l.t)(n.basis2,t.basis2,k),(0,l.t)((0,f.Qj)(n.plane),(0,f.Qj)(t.plane),k),(0,l.t)(n.origin,t.origin,e),(0,f.mP)(n.plane,n.plane,n.origin),n},up:B,updateUnboundedPlane:S,wrap:function(t,e,n){const i=W.get();return i.origin=t,i.basis1=e,i.basis2=n,i.plane=(0,f.LV)(0,0,0,0),S(i),i}},Symbol.toStringTag,{value:"Module"}))},80883:(t,e,n)=>{n.d(e,{a:()=>s});var i,r=n(57528),o=n(86955);function s(t){t.code.add((0,o.H)(i||(i=(0,r.A)(["vec4 premultiplyAlpha(vec4 v) {\nreturn vec4(v.rgb * v.a, v.a);\n}\nvec3 rgb2hsv(vec3 c) {\nvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d = q.x - min(q.w, q.y);\nfloat e = 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nfloat rgb2v(vec3 c) {\nreturn max(c.x, max(c.y, c.z));\n}"]))))}},81330:(t,e,n)=>{n.d(e,{FC:()=>s,Mv:()=>o,vM:()=>a});var i=n(50076);const r=16;function o(t,e){return e=Math.floor(e/r)*r,Math.min(Math.round(t/r)*r,e)}function s(t,e){return e=Math.floor(e/r)*r,Math.min(Math.ceil(t/r)*r,e)}function a(t,e){const[n,i]=l(t,e);return t.width===n&&t.height===i?t:c(t,n,i)}function l(t,e){let{width:n,height:i}=t,{maxPreferredTexturePixels:r,maxTextureSize:s}=e;const a=Math.max(n,i),l=n*i;if(a<=s&&l<=r)return[n,i];const c=Math.min(Math.sqrt(r/l),s/a);return[o(Math.round(n*c),s),o(Math.round(i*c),s)]}function c(t,e,n){if(t instanceof ImageData)return c(function(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");if(null==n)throw new i.A("texture:context-failed","Failed to create 2d context from HTMLCanvasElement");return n.putImageData(t,0,0),e}(t),e,n);const r=document.createElement("canvas");return r.width=e,r.height=n,r.getContext("2d").drawImage(t,0,0,r.width,r.height),r}},82809:(t,e,n)=>{n.d(e,{Z:()=>c});var i=n(20664),r=n(9392),o=n(88105),s=n(48168),a=n(66470),l=n(52757);class c{constructor(t){this.vertexBufferLayout=t}elementCount(t){return t.get(a.r.POSITION).indices.length}write(t,e,n,i,r,o){return(0,l.SA)(n,i,this.vertexBufferLayout,t,e,r,o)}intersect(t,e,n,r,l,c,d){const h=this.vertexBufferLayout.createView(t).getField(a.r.POSITION,o.xs);if(null==h)return;const f=(0,i.a)(u,c,l),v=h.count/3,p=r.options.normalRequired;(0,s.b_)(l,f,0,v,h.typedBuffer,h.typedBufferStride,p,(t,e,n)=>{d(t,n,e)})}}const u=(0,r.vt)()},83490:(t,e,n)=>{var i,r,o,s,a,l,c,u;n.d(e,{Am:()=>s,C7:()=>o,JS:()=>u,Mg:()=>l,dd:()=>a,it:()=>r,s2:()=>i,sf:()=>c}),function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"}(i||(i={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(r||(r={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(o||(o={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(s||(s={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(a||(a={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee"}(l||(l={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(c||(c={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(u||(u={}))},84115:(t,e,n)=>{n.d(e,{d:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"vec3",i.c.Bind,(n,i)=>n.setUniform3fv(t,e(i)))}}},85086:(t,e,n)=>{n.d(e,{j:()=>a});var i=n(30015),r=n(20664),o=n(9392),s=n(86994);class a{constructor(t,e,n){this.primitiveIndices=t,this._numIndexPerPrimitive=e,this.position=n,this._children=void 0,(0,s.vA)(t.length>=1),(0,s.vA)(3===n.size||4===n.size);const{data:i,size:a,indices:c}=n;(0,s.vA)(c.length%this._numIndexPerPrimitive===0),(0,s.vA)(c.length>=t.length*this._numIndexPerPrimitive);const u=t.length;let d=a*c[this._numIndexPerPrimitive*t[0]];l.clear(),l.push(d);const h=(0,o.fA)(i[d],i[d+1],i[d+2]),f=(0,o.o8)(h);for(let r=0;r<u;++r){const e=this._numIndexPerPrimitive*t[r];for(let t=0;t<this._numIndexPerPrimitive;++t){d=a*c[e+t],l.push(d);let n=i[d];h[0]=Math.min(n,h[0]),f[0]=Math.max(n,f[0]),n=i[d+1],h[1]=Math.min(n,h[1]),f[1]=Math.max(n,f[1]),n=i[d+2],h[2]=Math.min(n,h[2]),f[2]=Math.max(n,f[2])}}this.bbMin=h,this.bbMax=f;const v=(0,r.m)((0,o.vt)(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(f[0]-h[0],f[1]-h[1]),f[2]-h[2]);let p=this.radius*this.radius;for(let r=0;r<l.length;++r){d=l.at(r);const t=i[d]-v[0],e=i[d+1]-v[1],n=i[d+2]-v[2],o=t*t+e*e+n*n;if(o<=p)continue;const s=Math.sqrt(o),a=.5*(s-this.radius);this.radius=this.radius+a,p=this.radius*this.radius;const c=a/s;v[0]+=t*c,v[1]+=e*c,v[2]+=n*c}this.center=v,l.clear()}getChildren(){if(this._children||(0,r.s)(this.bbMin,this.bbMax)<=1)return this._children;const t=(0,r.m)((0,o.vt)(),this.bbMin,this.bbMax,.5),e=this.primitiveIndices.length,n=new Uint8Array(e),i=new Array(8);for(let r=0;r<8;++r)i[r]=0;const{data:s,size:l,indices:c}=this.position;for(let r=0;r<e;++r){let e=0;const o=this._numIndexPerPrimitive*this.primitiveIndices[r];let a=l*c[o],u=s[a],d=s[a+1],h=s[a+2];for(let t=1;t<this._numIndexPerPrimitive;++t){a=l*c[o+t];const e=s[a],n=s[a+1],i=s[a+2];e<u&&(u=e),n<d&&(d=n),i<h&&(h=i)}u<t[0]&&(e|=1),d<t[1]&&(e|=2),h<t[2]&&(e|=4),n[r]=e,++i[e]}let u=0;for(let r=0;r<8;++r)i[r]>0&&++u;if(u<2)return;const d=new Array(8);for(let r=0;r<8;++r)d[r]=i[r]>0?new Uint32Array(i[r]):void 0;for(let r=0;r<8;++r)i[r]=0;for(let r=0;r<e;++r){const t=n[r];d[t][i[t]++]=this.primitiveIndices[r]}this._children=new Array;for(let r=0;r<8;++r)void 0!==d[r]&&this._children.push(new a(d[r],this._numIndexPerPrimitive,this.position));return this._children}static prune(){l.prune()}}const l=new i.A({deallocator:null})},86955:(t,e,n)=>{function i(t){let e="";for(let n=0;n<(arguments.length<=1?0:arguments.length-1);n++)e+=t[n]+(n+1<1||arguments.length<=n+1?void 0:arguments[n+1]);return e+=t[t.length-1],e}function r(t,e){return t?e:arguments.length>2&&void 0!==arguments[2]?arguments[2]:""}n.d(e,{H:()=>i,If:()=>r}),function(t){t.int=function(t){return Math.round(t).toString()},t.float=function(t){return t.toPrecision(8)}}(i||(i={}))},87003:(t,e,n)=>{n.d(e,{n:()=>r});n(81806);var i=n(69728);class r{constructor(t,e,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(this.name=t,this.type=e,this.arraySize=o,this.bind={[i.c.Bind]:null,[i.c.Pass]:null,[i.c.Draw]:null},r)switch(n){case void 0:break;case i.c.Bind:this.bind[i.c.Bind]=r;break;case i.c.Pass:this.bind[i.c.Pass]=r;break;case i.c.Draw:this.bind[i.c.Draw]=r}}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}},87236:(t,e,n)=>{n.d(e,{Q:()=>A});var i=n(57528),r=n(79138),o=n(34981),s=n(86955),a=n(69728),l=n(87003);class c extends l.n{constructor(t,e){super(t,"ivec2",a.c.Bind,(n,i)=>n.setUniform2iv(t,e(i)))}}var u,d,h,f,v,p,m=n(53908),g=n(4653);class _ extends l.n{constructor(t,e){super(t,"usampler2D",a.c.Bind,(n,i)=>n.bindTexture(t,e(i)))}}function A(t,e){const{fragment:n}=t,{output:a,draped:l,hasHighlightMixTexture:A}=e;a===o.V.Highlight?(n.uniforms.add(new m.W("highlightLevel",t=>{var e;return null!==(e=t.highlightLevel)&&void 0!==e?e:0}),new c("highlightMixOrigin",t=>t.highlightMixOrigin)),t.outputs.add("fragHighlight","uvec2",0),t.include(r.y),A?n.uniforms.add(new _("highlightMixTexture",t=>t.highlightMixTexture)).code.add((0,s.H)(u||(u=(0,i.A)(["uvec2 getAccumulatedHighlight() {\nreturn texelFetch(highlightMixTexture, ivec2(gl_FragCoord.xy) - highlightMixOrigin, 0).rg;\n}\nvoid outputHighlight(bool occluded) {\nif (highlightLevel == 0) {\nuint bits = occluded ? 3u : 1u;\nfragHighlight = uvec2(bits, 0);\n} else {\nint ll = (highlightLevel & 3) << 1;\nint li = (highlightLevel >> 2) & 3;\nuint bits;\nif (occluded) {\nbits = 3u << ll;\n} else {\nbits = 1u << ll;\n}\nuvec2 combinedHighlight = getAccumulatedHighlight();\ncombinedHighlight[li] |= bits;\nfragHighlight = combinedHighlight;\n}\n}"])))):n.code.add((0,s.H)(d||(d=(0,i.A)(["void outputHighlight(bool occluded) {\nuint bits = occluded ? 3u : 1u;\nfragHighlight = uvec2(bits, 0);\n}"])))),l?n.code.add((0,s.H)(h||(h=(0,i.A)(["bool isHighlightOccluded() {\nreturn false;\n}"])))):n.uniforms.add(new g.x("depthTexture",t=>t.mainDepth)).code.add((0,s.H)(f||(f=(0,i.A)(["bool isHighlightOccluded() {\nfloat sceneDepth = texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x;\nreturn gl_FragCoord.z > sceneDepth + 5e-7;\n}"])))),n.code.add((0,s.H)(v||(v=(0,i.A)(["void calculateOcclusionAndOutputHighlight() {\noutputHighlight(isHighlightOccluded());\n}"]))))):n.code.add((0,s.H)(p||(p=(0,i.A)(["void calculateOcclusionAndOutputHighlight() {}"]))))}},89299:(t,e,n)=>{n.d(e,{u:()=>a});var i,r=n(57528),o=n(23148),s=n(86955);function a(t,e){let{code:n,uniforms:a}=t;a.add(new o.U("dpDummy",()=>1)),n.add((0,s.H)(i||(i=(0,r.A)(["vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\nvec3 hiD = hiA + hiB;\nvec3 loD = loA + loB;\nreturn  dpDummy * hiD + loD;\n}"]))))}},90080:(t,e,n)=>{n.d(e,{g:()=>d});var i,r,o,s,a=n(57528),l=n(34981),c=n(86955),u=n(66470);function d(t,e){if(e.output!==l.V.ObjectAndLayerIdColor)return t.vertex.code.add((0,c.H)(i||(i=(0,a.A)(["void forwardObjectAndLayerIdColor() {}"])))),void t.fragment.code.add((0,c.H)(r||(r=(0,a.A)(["void outputObjectAndLayerIdColor() {}"]))));const n=e.objectAndLayerIdColorInstanced;t.varyings.add("objectAndLayerIdColorVarying","vec4"),t.attributes.add(n?u.r.INSTANCEOBJECTANDLAYERIDCOLOR:u.r.OLIDCOLOR,"vec4"),t.vertex.code.add((0,c.H)(o||(o=(0,a.A)(["\n    void forwardObjectAndLayerIdColor() {\n      objectAndLayerIdColorVarying = "," * 0.003921568627451;\n    }"])),n?"instanceObjectAndLayerIdColor":"objectAndLayerIdColor")),t.fragment.code.add((0,c.H)(s||(s=(0,a.A)(["void outputObjectAndLayerIdColor() {\nfragColor = objectAndLayerIdColorVarying;\n}"]))))}},90364:(t,e,n)=>{n.d(e,{OG:()=>r,hM:()=>i});var i,r;n(13191),n(5809),n(45308);!function(t){t.OPAQUE="opaque-color",t.TRANSPARENT="transparent-color",t.COMPOSITE="composite-color",t.FINAL="final-color"}(i||(i={})),function(t){t.SSAO="ssao",t.LASERLINES="laserline-color",t.ANTIALIASING="aa-color",t.HIGHLIGHTS="highlight-color",t.MAGNIFIER="magnifier-color",t.OCCLUDED="occluded-color",t.VIEWSHED="viewshed-color",t.OPAQUE_TERRAIN="opaque-terrain-color",t.OPAQUE_ENVIRONMENT="opaque-environment-color",t.TRANSPARENT_ENVIRONMENT="transparent-environment-color",t.FOCUSAREA="focusarea",t.FOCUSAREA_COLOR="focusarea-color"}(r||(r={}))},91911:(t,e,n)=>{n.d(e,{z:()=>f});var i,r,o=n(57528),s=n(34981),a=n(42717),l=n(87236),c=n(80883),u=n(86955),d=n(72001),h=n(75569);function f(t,e){t.include(l.Q,e),t.include(a.NL,e),t.fragment.include(c.a);const{output:n,oitPass:f,discardInvisibleFragments:v,snowCover:p}=e,m=n===s.V.ObjectAndLayerIdColor,g=(0,s.LG)(n),_=(0,s.RN)(n)&&f===d.Y.ColorAlpha,A=(0,s.RN)(n)&&f!==d.Y.ColorAlpha;let T=0;(A||g||_)&&t.outputs.add("fragColor","vec4",T++),g&&t.outputs.add("fragEmission","vec4",T++),_&&t.outputs.add("fragAlpha","float",T++),t.fragment.code.add((0,u.H)(i||(i=(0,o.A)(["\n    void outputColorHighlightOID(vec4 finalColor, const in vec3 vWorldPosition, vec3 emissiveBaseColor ",") {\n      ","\n\n      ","\n\n      finalColor = applySlice(finalColor, vWorldPosition);\n      ","\n      ","\n      ","\n      calculateOcclusionAndOutputHighlight();\n      ","\n    }\n  "])),(0,u.If)(p,", float snow"),(0,u.If)(m,"finalColor.a = 1.0;"),(0,u.If)(v,"if (finalColor.a < ".concat(u.H.float(h.Q),") { discard; }")),(0,u.If)(_,(0,u.H)(r||(r=(0,o.A)(["fragColor = premultiplyAlpha(finalColor);\n             fragAlpha = finalColor.a;"])))),(0,u.If)(A,"fragColor = finalColor;"),(0,u.If)(g,"fragEmission = ".concat((0,u.If)(p,"mix(finalColor.a * getEmissions(emissiveBaseColor), vec4(0.0), snow);","finalColor.a * getEmissions(emissiveBaseColor);"))),(0,u.If)(m,"outputObjectAndLayerIdColor();")))}},92656:(t,e,n)=>{n.d(e,{E:()=>c});var i=n(35143),r=n(34981),o=n(9937),s=n(6485),a=n(72001),l=n(69728);class c extends o.n{constructor(){super(...arguments),this.output=r.V.Color,this.oitPass=a.Y.NONE,this.hasSlicePlane=!1,this.hasHighlightMixTexture=!1,this.bindType=l.c.Pass,this.writeDepth=!0}}(0,i._)([(0,s.W)({count:r.V.COUNT})],c.prototype,"output",void 0),(0,i._)([(0,s.W)({count:a.Y.COUNT})],c.prototype,"oitPass",void 0),(0,i._)([(0,s.W)()],c.prototype,"hasSlicePlane",void 0),(0,i._)([(0,s.W)()],c.prototype,"hasHighlightMixTexture",void 0)},93684:(t,e,n)=>{n.d(e,{S:()=>o,p:()=>s});var i=n(63048),r=n(45463);class o extends i.Gd{constructor(){super(...arguments),this.renderOccluded=r.m$.Occlude,this.isDecoration=!1}}const s=8},94192:(t,e,n)=>{n.d(e,{Z:()=>l});var i,r=n(57528),o=n(65058),s=n(86955),a=n(4653);function l(t,e){let{occlusionPass:n,terrainDepthTest:l,cullAboveTerrain:c}=e;const{vertex:u,fragment:d,varyings:h}=t;if(!l)return u.code.add("void forwardViewPosDepth(vec3 pos) {}"),void d.code.add("".concat(n?"bool":"void"," discardByTerrainDepth() { ").concat((0,s.If)(n,"return false;"),"}"));h.add("viewPosDepth","float",{invariant:!0}),u.code.add("void forwardViewPosDepth(vec3 pos) {\n    viewPosDepth = pos.z;\n  }"),d.include(o.E),d.uniforms.add(new a.x("terrainDepthTexture",t=>{var e;return null===(e=t.terrainDepth)||void 0===e?void 0:e.attachment})).code.add((0,s.H)(i||(i=(0,r.A)(["\n    "," discardByTerrainDepth() {\n      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;\n      float linearDepth = linearizeDepth(depth);\n      ","\n    }"])),n?"bool":"void",n?"return viewPosDepth < linearDepth && depth < 1.0;":"if(viewPosDepth ".concat(c?">":"<="," linearDepth) discard;")))}},95352:(t,e,n)=>{n.d(e,{r:()=>c});var i,r,o=n(57528),s=n(97808),a=n(86955);function l(t){t.fragment.code.add((0,a.H)(i||(i=(0,o.A)(["vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {\nvec2 atlasScale = atlasRegion.zw - atlasRegion.xy;\nvec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;\nfloat maxdUV = 0.125;\nvec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\nvec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\nreturn textureGrad(tex, uvAtlas, dUVdx, dUVdy);\n}"]))))}function c(t,e){const{textureCoordinateType:n}=e;if(n===s.I.None||n===s.I.COUNT)return;t.include(s.U,e);const i=n===s.I.Atlas;i&&t.include(l),t.fragment.code.add((0,a.H)(r||(r=(0,o.A)(["\n    vec4 textureLookup(sampler2D tex, vec2 uv) {\n      return ",";\n    }\n  "])),i?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"))}},95756:(t,e,n)=>{n.d(e,{G:()=>o});var i=n(69728),r=n(87003);class o extends r.n{constructor(t,e){super(t,"vec2",i.c.Pass,(n,i,r)=>n.setUniform2fv(t,e(i,r)))}}},96643:(t,e,n)=>{n.d(e,{I$:()=>d,a9:()=>u,m:()=>o,mK:()=>h,qh:()=>c,r8:()=>l,sf:()=>s,v0:()=>a});var i=n(83490),r=n(93345);const o={func:r.MT.LESS},s={func:r.MT.ALWAYS},a={mask:255},l={mask:0},c={function:{func:r.MT.ALWAYS,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.ZERO}},u={function:{func:r.MT.ALWAYS,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.REPLACE}},d={function:{func:r.MT.EQUAL,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.KEEP}},h={function:{func:r.MT.NOTEQUAL,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.KEEP}}},97808:(t,e,n)=>{n.d(e,{I:()=>s,U:()=>d});var i,r,o,s,a=n(57528),l=n(4212),c=n(86955),u=n(66470);function d(t,e){switch(e.textureCoordinateType){case s.Default:return t.attributes.add(u.r.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add((0,c.H)(i||(i=(0,a.A)(["void forwardTextureCoordinates() { vuv0 = uv0; }"]))));case s.Atlas:return t.attributes.add(u.r.UV0,"vec2"),t.attributes.add(u.r.UVREGION,"vec4"),t.varyings.add("vuv0","vec2"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add((0,c.H)(r||(r=(0,a.A)(["void forwardTextureCoordinates() {\nvuv0 = uv0;\nvuvRegion = uvRegion;\n}"]))));default:(0,l.Xb)(e.textureCoordinateType);case s.None:return void t.vertex.code.add((0,c.H)(o||(o=(0,a.A)(["void forwardTextureCoordinates() {}"]))));case s.COUNT:return}}!function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.COUNT=3]="COUNT"}(s||(s={}))},97974:(t,e,n)=>{n.d(e,{dg:()=>h,ou:()=>p});var i=n(63919),r=n(44680),o=n(34761),s=n(13191),a=n(20664),l=n(9392),c=n(78315),u=n(64465),d=n(59231);class h{constructor(){this._transform=(0,s.vt)(),this._transformInverse=new f({value:this._transform},o.B8,s.vt),this._transformInverseTranspose=new f(this._transformInverse,o.mg,s.vt),this._transformTranspose=new f({value:this._transform},o.mg,s.vt),this._transformInverseRotation=new f({value:this._transform},i.dR,r.vt)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){(0,o.C)(this._transform,t)}multiplyTransform(t){(0,o.lw)(this._transform,this._transform,t)}set(t){(0,o.C)(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,e){this.setTransformMatrix(t),this.multiplyTransform(e),this._invalidateLazyTransforms()}}class f{constructor(t,e,n){this._original=t,this._update=e,this._dirty=!0,this._transform=n()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}const v=new class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.offset=t,this.sphere=(0,c.c)(),this.tmpVertex=(0,l.vt)()}applyToVertex(t,e,n){const i=this.objectTransform.transform,r=(0,a.i)(m,t,e,n),o=(0,a.t)(r,r,i),s=this.offset/(0,a.l)(o);(0,a.b)(o,o,o,s);const l=this.objectTransform.inverse;return(0,a.t)(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(t,e){const n=this.offset/(0,a.l)(t);(0,a.b)(t,t,t,n);const i=this.offset/(0,a.l)(e);(0,a.b)(e,e,e,i)}applyToAabb(t){const e=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*e,t[1]+=t[1]*e,t[2]+=t[2]*e;const n=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*n,t[4]+=t[4]*n,t[5]+=t[5]*n,t}applyToBoundingSphere(t){const e=(0,a.l)((0,c.a)(t)),n=this.offset/e;return(0,a.b)((0,c.a)(this.sphere),(0,c.a)(t),(0,c.a)(t),n),this.sphere[3]=t[3]+t[3]*this.offset/e,this.sphere}};function p(t){return null!=t?(v.offset=t,v):null}new class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=(0,l.vt)(),this._tmpMbs=(0,c.c)(),this._tmpObb=new d.ab,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=(0,a.l)(t)}applyToVertex(t,e,n){const i=(0,a.i)(m,t,e,n),r=(0,a.i)(g,t,e,n+this.componentLocalOriginLength),o=this._totalOffset/(0,a.l)(r);return(0,a.b)(this._tmpVertex,i,r,o),this._tmpVertex}applyToAabb(t){const e=this.componentLocalOriginLength,n=t[0],i=t[1],r=t[2]+e,o=t[3],s=t[4],a=t[5]+e,l=Math.abs(n),c=Math.abs(i),u=Math.abs(r),d=Math.abs(o),h=Math.abs(s),f=Math.abs(a),v=.5*(1+Math.sign(n*o))*Math.min(l,d),p=.5*(1+Math.sign(i*s))*Math.min(c,h),m=.5*(1+Math.sign(r*a))*Math.min(u,f),g=Math.max(l,d),_=Math.max(c,h),A=Math.max(u,f),T=Math.sqrt(v*v+p*p+m*m),E=Math.sign(l+n),S=Math.sign(c+i),b=Math.sign(u+r),y=Math.sign(d+o),x=Math.sign(h+s),O=Math.sign(f+a),R=this._totalOffset;if(T<R)return t[0]-=(1-E)*R,t[1]-=(1-S)*R,t[2]-=(1-b)*R,t[3]+=y*R,t[4]+=x*R,t[5]+=O*R,t;const C=R/Math.sqrt(g*g+_*_+A*A),I=R/T,w=I-C,M=-w;return t[0]+=n*(E*M+I),t[1]+=i*(S*M+I),t[2]+=r*(b*M+I),t[3]+=o*(y*w+C),t[4]+=s*(x*w+C),t[5]+=a*(O*w+C),t}applyToMbs(t){const e=(0,a.l)((0,c.a)(t)),n=this._totalOffset/e;return(0,a.b)((0,c.a)(this._tmpMbs),(0,c.a)(t),(0,c.a)(t),n),this._tmpMbs[3]=t[3]+t[3]*this._totalOffset/e,this._tmpMbs}applyToObb(t){return(0,d.gm)(t,this._totalOffset,this._totalOffset,u.RT.Global,this._tmpObb),this._tmpObb}};new class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.offset=t,this.tmpVertex=(0,l.vt)()}applyToVertex(t,e,n){const i=(0,a.i)(m,t,e,n),r=(0,a.f)(g,i,this.localOrigin),o=this.offset/(0,a.l)(r);return(0,a.b)(this.tmpVertex,i,r,o),this.tmpVertex}applyToAabb(t){const e=_,n=A,i=T;for(let a=0;a<3;++a)e[a]=t[0+a]+this.localOrigin[a],n[a]=t[3+a]+this.localOrigin[a],i[a]=e[a];const r=this.applyToVertex(e[0],e[1],e[2]);for(let a=0;a<3;++a)t[a]=r[a],t[a+3]=r[a];const o=e=>{const n=this.applyToVertex(e[0],e[1],e[2]);for(let i=0;i<3;++i)t[i]=Math.min(t[i],n[i]),t[i+3]=Math.max(t[i+3],n[i])};for(let a=1;a<8;++a){for(let t=0;t<3;++t)i[t]=a&1<<t?n[t]:e[t];o(i)}let s=0;for(let a=0;a<3;++a)e[a]*n[a]<0&&(s|=1<<a);if(0!==s&&7!==s)for(let a=0;a<8;++a)if(0===(s&a)){for(let t=0;t<3;++t)i[t]=s&1<<t?0:a&1<<t?e[t]:n[t];o(i)}for(let a=0;a<3;++a)t[a]-=this.localOrigin[a],t[a+3]-=this.localOrigin[a];return t}};const m=(0,l.vt)(),g=(0,l.vt)(),_=(0,l.vt)(),A=(0,l.vt)(),T=(0,l.vt)()},99362:(t,e,n)=>{n.d(e,{MB:()=>a,Um:()=>l,kE:()=>s});var i=n(18690),r=n(15941),o=n(12028);function s(t,e,n,i,s){let a=(n.screenLength||0)*t.pixelRatio;null!=s&&(a=(0,o.hs)(a,i,e,s));const l=a*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return(0,r.qE)(l*e,n.minWorldLength||0,null!=n.maxWorldLength?n.maxWorldLength:1/0)}function a(t,e){let n=!1;for(const r in e){const o=e[r];void 0!==o&&(Array.isArray(o)?Array.isArray(t[r])&&(0,i.aI)(o,t[r])||(t[r]=o.slice(),n=!0):t[r]!==o&&(n=!0,t[r]=o))}return n}const l={multiply:1,ignore:2,replace:3,tint:4}},99643:(t,e,n)=>{function i(t,e,n){for(let i=0;i<n;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function r(t,e){const n=t.length;for(let i=0;i<n;++i)s[0]=t[i],e[i]=s[0];return e}function o(t,e){const n=t.length;for(let i=0;i<n;++i)s[0]=t[i],s[1]=t[i]-s[0],e[i]=s[1];return e}n.d(e,{Zo:()=>r,jA:()=>o,jS:()=>i});const s=new Float32Array(2)}}]);
//# sourceMappingURL=6961.5e2897aa.chunk.js.map