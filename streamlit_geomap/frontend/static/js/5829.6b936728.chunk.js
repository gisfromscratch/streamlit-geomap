"use strict";(self.webpackChunkstreamlit_geomap_frontend=self.webpackChunkstreamlit_geomap_frontend||[]).push([[5829],{3689:(e,t,i)=>{i.d(t,{Y:()=>n});i(81806);var o=i(12482),a=i(61492);function n(e){var t,i;if(e.graphic&&"graphics"!==(null===(t=e.graphic.layer)||void 0===t?void 0:t.type))return a.d.GRAPHICS_LAYER_MISSING;const n=null===(i=e.operations)||void 0===i?void 0:i.data.type;if(!n)return a.d.GEOMETRY_TYPE_UNSUPPORTED;switch(n){case"polygon":case"point":case"polyline":case"mesh":break;default:return a.d.GEOMETRY_TYPE_UNSUPPORTED}const r=e.elevationInfo;return(0,o.wz)(r)?a.d.ELEVATION_MODE_UNSUPPORTED:a.d.SUPPORTED}},4244:(e,t,i)=>{i.d(t,{X:()=>s});var o=i(76931),a=(i(19555),i(20664)),n=i(9392),r=i(12482);function s(e,t,i,o){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,n.vt)();const p=(0,a.c)(l,e);return p[2]=(0,r.xS)(o,p,t,i)||0,o.renderCoordsHelper.toRenderCoords(p,t,s),s}const l=(0,n.vt)();(0,o.QG)(),(0,o.QG)()},9876:(e,t,i)=>{i.d(t,{z:()=>l});var o=i(89379),a=i(75543),n=i(70330),r=i(61751),s=i(23543);class l extends r.w{constructor(e){super((0,o.A)((0,o.A)({},e),{},{constraint:new a.Mn(e.edgeStart,e.edgeEnd)}))}get hints(){return[new s.c(n.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},17072:(e,t,i)=>{i.d(t,{j:()=>s});var o=i(76931),a=i(9392),n=i(18117),r=i(4244);function s(e,t,i,a){return"2d"===a.type?(l.x=e[0],l.y=e[1],l.spatialReference=t,a.toScreen(l)):((0,r.X)(e,t,i,a,p),a.state.camera.projectToScreen(p,d),(0,o.tc)(d[0],d[1]))}const l=(0,n.T)(0,0,0,null),p=(0,a.vt)(),d=(0,o.gs)()},18917:(e,t,i)=>{i.d(t,{Hh:()=>r,fz:()=>l,g7:()=>s,s1:()=>n});var o=i(7724);let a;function n(){return!!a&&(0,o.i)()}async function r(){if(!n()){const[e,t]=await Promise.all([Promise.all([i.e(6871),i.e(6364),i.e(2103),i.e(7207)]).then(i.bind(i,19581)),Promise.all([i.e(6871),i.e(6364),i.e(2103),i.e(8707)]).then(i.bind(i,82103)).then(e=>e.aG).then(e=>{let{injectPe:t}=e;return t}),(0,o.l)()]);a=new e.OperatorGeodeticLength,t(o.p)}}function s(e,t,i){return a.execute(e,t,i,null)}function l(){return a.supportsCurves()}},20612:(e,t,i)=>{i.d(t,{B:()=>h});var o=i(20664),a=i(9392),n=i(75543),r=i(23862),s=i(99791),l=i(70330),p=i(30003),d=i(23543),c=i(20578);class h extends p.C{constructor(e){let{referenceLine:t,lineStart:i,targetPoint:l,isDraped:p}=e;const d=(0,a.o8)(i),{left:c,right:h}=t;(0,o.d)(d,(0,o.f)(d,d,h),c),super(l,new n.WG(i,(0,r._7)(d)),p,s.n.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new d.c(l.H3.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new c.r(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new d.c(l.H3.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{(0,o.q)(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),(0,o.q)(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),(0,o.q)(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),(0,o.q)(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)}),this._referenceLines.push(t)}}},30003:(e,t,i)=>{i.d(t,{C:()=>o});class o{constructor(e,t,i,o){this.targetPoint=e,this.constraint=t,this.isDraped=i,this.domain=o}}},35829:(e,t,i)=>{i.d(t,{RouteLayerInteraction:()=>wt});var o=i(89379),a=i(35143),n=i(91967),r=i(54901),s=i(30726),l=i(68134),p=i(46053),d=(i(81806),i(76460)),c=(i(47249),i(85842)),h=i(19451),u=i(63733),v=i(57562),y=i(26170),g=i(95808),m=i(75747),f=i(94643),_=i(50076),b=i(54099),E=i(50346),w=i(34111),S=i(9956),M=i(5262),T=i(80963),O=i(31933),A=i(84847),G=i(94918),P=i(86875),C=i(7246),R=i(76940),k=i(94725),D=i(61492),H=i(3689),I=i(12482);function U(e){return function(e){var t;if(e.graphic&&"graphics"!==(null===(t=e.graphic.layer)||void 0===t?void 0:t.type))return{result:D.d.GRAPHICS_LAYER_MISSING};if(!e.operations)return{result:D.d.GEOMETRY_MISSING};if((0,I.wz)(e.elevationInfo))return{result:D.d.ELEVATION_MODE_UNSUPPORTED};const i=e.operations.data.type,o=e.operations.data.geometry;return"point"===i||"mesh"===i||"polyline"===i||"polygon"===i?{result:D.d.SUPPORTED,geometry:o}:{result:D.d.GEOMETRY_TYPE_UNSUPPORTED}}(e).result}var x=i(69120),L=i(57308),N=i(82307),Z=i(95327),F=i(97513),V=i(357),j=i(73265),B=i(98773),q=i(23862),Y=i(63078),z=i(99791),W=i(18690);let K=class extends n.A{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new f.A}};(0,a._)([(0,p.MZ)({constructOnly:!0})],K.prototype,"layer",void 0),(0,a._)([(0,p.MZ)()],K.prototype,"enabled",void 0),(0,a._)([(0,p.MZ)()],K.prototype,"updating",void 0),(0,a._)([(0,p.MZ)()],K.prototype,"availability",void 0),(0,a._)([(0,p.MZ)()],K.prototype,"sublayerSources",void 0),K=(0,a._)([(0,c.$)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],K);let X=class extends n.A{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new f.A,this.distance=Y.N.distance,this.touchSensitivityMultiplier=Y.N.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){var e,t,i;const o=this.featureSources;o.some($)&&d.A.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const a=o.filter(J),n=null!==(e=null===(t=this._get("_effectiveFeatureSources"))||void 0===t?void 0:t.filter($))&&void 0!==e?e:new f.A;for(const d of a){const e=n.find(e=>e.layer===d.layer.parent);if(e)e.sublayerSources.includes(d)||e.sublayerSources.add(d);else if(d.layer.parent){const e=new K({layer:d.layer.parent});e.sublayerSources.add(d),n.add(e)}}for(const d of n){const e=d.sublayerSources.filter(e=>!a.includes(e));d.sublayerSources.removeMany(e)}n.removeMany(n.filter(e=>0===e.sublayerSources.length));const r=o.filter(Q),s=null!==(i=this._get("_effectiveFeatureSources"))&&void 0!==i?i:new f.A,{added:l,removed:p}=(0,W.iv)(s.toArray(),[...r,...n]);return s.removeMany(p),s.addMany(l),s}};function $(e){return"subtype-group"===e.layer.type}function Q(e){return"subtype-group"!==e.layer.type}function J(e){return"subtype-sublayer"===e.layer.type}(0,a._)([(0,p.MZ)()],X.prototype,"enabled",void 0),(0,a._)([(0,p.MZ)()],X.prototype,"enabledToggled",void 0),(0,a._)([(0,p.MZ)()],X.prototype,"forceDisabled",void 0),(0,a._)([(0,p.MZ)()],X.prototype,"selfEnabled",void 0),(0,a._)([(0,p.MZ)()],X.prototype,"featureEnabled",void 0),(0,a._)([(0,p.MZ)()],X.prototype,"gridEnabled",void 0),(0,a._)([(0,p.MZ)()],X.prototype,"attributeRulesEnabled",void 0),(0,a._)([(0,p.MZ)({type:f.A.ofType(K)})],X.prototype,"featureSources",void 0),(0,a._)([(0,p.MZ)()],X.prototype,"distance",void 0),(0,a._)([(0,p.MZ)()],X.prototype,"touchSensitivityMultiplier",void 0),(0,a._)([(0,p.MZ)({readOnly:!0})],X.prototype,"effectiveEnabled",null),(0,a._)([(0,p.MZ)({readOnly:!0})],X.prototype,"effectiveGridEnabled",null),(0,a._)([(0,p.MZ)({readOnly:!0})],X.prototype,"effectiveSelfEnabled",null),(0,a._)([(0,p.MZ)({readOnly:!0})],X.prototype,"effectiveFeatureEnabled",null),(0,a._)([(0,p.MZ)({readOnly:!0})],X.prototype,"_effectiveFeatureSources",null),X=(0,a._)([(0,c.$)("esri.views.interactive.snapping.SnappingOptions")],X);var ee=i(70330),te=i(80794),ie=i(9876),oe=i(90836),ae=i(45633),ne=i(20612),re=i(78228),se=i(59380),le=i(17072),pe=i(24648),de=i(9392),ce=i(23701),he=i(73085),ue=i(7137),ve=i(90659);function ye(e,t,i){return(0,ve.M0)(i,fe,_e,e,t,i)}const ge={geodesicLength:function(e){const{spatialReference:t}=e;return(0,ve.M0)(t,be,Ee,e)},geodesicDistanceBetweenPoints:function(e,t){if(!(0,T.aI)(e.spatialReference,t.spatialReference))return null;const{spatialReference:i}=e;return Se[0]=e.x,Se[1]=e.y,Se[2]=e.hasZ?e.z:0,Me[0]=t.x,Me[1]=t.y,Me[2]=t.hasZ?t.z:0,ye(Se,Me,i)},geodesicDistance:ye};async function me(){return await(0,he.l)(),ge}function fe(e,t,i){return(0,pe.d_)((0,ue._3)(we,e,t,i).distance,"meters")}function _e(e,t,i){return(0,pe.d_)((0,he.e)(function(e,t,i){return new ce.A({spatialReference:i,paths:[[[...e],[...t]]]})}(e,t,i),{unit:"meters"}),"meters")}function be(e){return(0,pe.d_)((0,ue.l1)([e],"meters")[0],"meters")}function Ee(e){return(0,pe.d_)((0,he.e)(e,{unit:"meters"}),"meters")}const we=new ue.Zj,Se=(0,de.vt)(),Me=(0,de.vt)();let Te=class extends(b.A.EventedMixin(n.A)){constructor(e){super(e),this.options=new X,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Oe.MAIN}initialize(){this.addHandles([(0,l.wB)(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:i,effectiveFeatureEnabled:o,effectiveGridEnabled:a}=this.options;return{selfEnabled:i,featureEnabled:o,gridEnabled:"2d"===this.view.type&&a,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{var i;t&&(this.doneSnapping(),this.emit("changed")),null!==(i=this._loadTask)&&void 0!==i&&i.abort(),this._loadTask=(0,B.UT)(i=>this._updateEngines(e,t,i))},l.pc),(0,l.wB)(()=>this.options,e=>{for(const t of this._engines)t.options=e},l.OH)])}destroy(){var e;null!==(e=this._loadTask)&&void 0!==e&&e.abort(),this._destroyEngines()}get updating(){var e;return this._engines.some(e=>e.updating)||!(null!==(e=this._loadTask)&&void 0!==e&&e.finished)}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,i){if(!e.viewReady)return void this._destroyEngines();(null===t||void 0===t?void 0:t.viewSpatialReference)!==e.viewSpatialReference&&this._destroyEngines();const o=this._engineCache,a=await Promise.allSettled([e.featureEnabled&&!o.has("feature")?this._createFeatureSnappingEngine(i):void 0,e.selfEnabled&&!o.has("self")?this._createSelfSnappingEngine(i):void 0,e.gridEnabled&&!o.has("grid")?this._createGridSnappingEngine(i):void 0]);if(i.aborted)for(const r of a){var n;"fulfilled"===r.status&&(null===(n=r.value)||void 0===n||n.engine.destroy())}else{for(const e of a)"fulfilled"===e.status&&e.value&&o.set(e.value.type,e.value.engine);this._engines=Array.from(o.values())}}async _createSelfSnappingEngine(e){const[{SelfSnappingEngine:t},o]=await Promise.all([i.e(7960).then(i.bind(i,67960)),me()]);return(0,E.Te)(e),{type:"self",engine:new t({view:this.view,options:this.options,geodesicLengthMeasurementUtils:o})}}async _createGridSnappingEngine(e){const{view:t}=this;if("2d"!==t.type)return;const{GridSnappingEngine:o}=await i.e(5393).then(i.bind(i,95393));return(0,E.Te)(e),{type:"grid",engine:new o({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await i.e(6500).then(i.bind(i,6500));(0,E.Te)(e);const{view:o,options:a}=this,{spatialReference:n}=o;return{type:"feature",engine:new t({view:o,options:a,spatialReference:n})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}snap(e){return function(e){return null!=e.scenePoint}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:i}=e;this._removeVisualization();const o=this._currentMainCandidate;if(null==o)return t;const a=this._selectUpdateInput(e);if(null==a)return t;const{spatialReference:n}=i,r=(0,S.project)(a,n);if(null==r)return t;const{view:s}=this,{elevationInfo:l,visualizer:p}=i,d=[],c=(0,q.vf)(r,s,l),h=o.constraint.closestTo(c);if(!this._arePointsWithinScreenThreshold(c,h,i)||!Pe(o,i.drawConstraints))return this._resetSnappingState(),t;o.targetPoint=(0,q.de)(h),d.push(...o.hints);for(const u of this._currentOtherActiveCandidates)Pe(u,i.drawConstraints)&&(u.targetPoint=(0,q.de)(h),d.push(...u.hints));return null!=p&&this.addHandles(p.draw(d,{spatialReference:n,elevationInfo:Re(i),view:s,selfSnappingZ:i.selfSnappingZ}),Ae),(0,q.xF)(h,s,t,i)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput(e){let{point:t,scenePoint:i}=e;switch(this._currentSnappedType){case Oe.MAIN:return t;case Oe.SCENE:return i}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Oe.MAIN}_removeVisualization(){this.removeHandles(Ae)}async _snapSinglePoint(e){let{point:t,context:i,signal:o}=e;const{view:a}=this,{elevationInfo:n}=i,r=(0,q.vf)(t,a,n),s=await this._fetchCandidates(r,z.n.ALL,i,o);return this._createSnapResult(r,Oe.MAIN,s,a,t,i,o)}async _snapMultiPoint(e){var t,i;let{point:o,scenePoint:a,context:n,signal:r}=e;const{view:s}=this,{coordinateHelper:l,elevationInfo:p,spatialReference:d}=n;await(0,S.initializeProjection)(a.spatialReference,d);const c=(0,S.project)(a,d),h=(0,q.vf)(c,s,p),u=await this._fetchCandidates(h,z.n.FEATURE,n,r);if(u.length>0){const e=await this._fetchCandidates(h,z.n.SELF,n,r);return this._createSnapResult(h,Oe.SCENE,[...u,...e],s,c,n,r)}const v=(0,q.vf)(o,s,p),y=await this._fetchCandidates(v,z.n.SELF,n,r);return this._createSnapResult(v,Oe.MAIN,y,s,{z:l.hasZ()&&o.hasZ?null!==(t=o.z)&&void 0!==t?t:0:void 0,m:l.hasM()&&o.hasM?null!==(i=o.m)&&void 0!==i?i:0:void 0},n,r)}async _fetchCandidates(e,t,i,o){return(await Promise.all(this._engines.map(a=>a.fetchCandidates(e,t,i,o)))).flat()}_createSnapResult(e,t,i,o,a,n,r){return{get valid(){return!(0,E.G4)(r)},apply:()=>{const{spatialReference:r}=n,{snappedPoint:s,hints:l}=this._processCandidates(e,t,i,n);return this._removeVisualization(),null!=n.visualizer&&this.addHandles(n.visualizer.draw(l,{spatialReference:r,elevationInfo:I.qt,view:o,selfSnappingZ:n.selfSnappingZ}),Ae),(0,q.xF)(s,o,a,n)}}}_processCandidates(e,t,i,o){if(i.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,ee.xX)(e,i);const a=this._currentMainCandidate;if(null!=a){const n=function(e,t){return e instanceof oe.N?Ce(t,e.first)>=0&&Ce(t,e.second)>=0?0:-1:Ce(t,e)}(a,i);if(n>=0){if(!(i[n]instanceof oe.N))return this._intersectWithOtherCandidates(n,i,e,t,o);if(this._arePointsWithinScreenThreshold(e,a.targetPoint,o))return this._updateSnappingCandidate(a,t,i,o)}}return this._intersectWithOtherCandidates(0,i,e,t,o)}_intersectWithOtherCandidates(e,t,i,o,a){const{coordinateHelper:n}=a,r=t[e],s=[];for(let l=0;l<t.length;++l){if(l===e)continue;const o=t[l],a=r.constraint.intersect(o.constraint);if(a)for(const e of a.closestPoints(r.targetPoint))s.push([new oe.N((0,q.de)(e),r,o,o.isDraped),this._squaredScreenDistance(i,e,n)])}return s.length>0&&(s.sort((e,t)=>e[1]-t[1]),s[0][1]<this._squaredPointProximityThreshold(a.pointer))?this._updateSnappingCandidate(s[0][0],o,t,a):Pe(r,a.drawConstraints)?this._updateSnappingCandidate(r,o,t,a):{snappedPoint:i,hints:[]}}_updateSnappingCandidate(e,t,i,o){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const a=this._currentMainCandidate.targetPoint,n=[];n.push(...e.hints);for(const r of i){if(e instanceof oe.N){if(r.constraint.equals(e.first.constraint)||r.constraint.equals(e.second.constraint))continue}else if(r.constraint.equals(e.constraint))continue;const t=r.constraint.closestTo(a);this._squaredScreenDistance(t,a,o.coordinateHelper)<Ge()&&(r.targetPoint=a,this._currentOtherActiveCandidates.push(r),n.push(...r.hints))}return{snappedPoint:a,hints:n}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return(0,ee.pM)(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return(0,le.j)(e,t.spatialReference,I.qt,this.view)}get test(){}};var Oe;(0,a._)([(0,p.MZ)({constructOnly:!0})],Te.prototype,"view",void 0),(0,a._)([(0,p.MZ)()],Te.prototype,"options",void 0),(0,a._)([(0,p.MZ)({readOnly:!0})],Te.prototype,"updating",null),(0,a._)([(0,p.MZ)()],Te.prototype,"_loadTask",void 0),(0,a._)([(0,p.MZ)()],Te.prototype,"_engines",void 0),(0,a._)([(0,p.MZ)()],Te.prototype,"_squaredMouseProximityThreshold",null),(0,a._)([(0,p.MZ)()],Te.prototype,"_squaredTouchProximityThreshold",null),Te=(0,a._)([(0,c.$)("esri.views.interactive.snapping.SnappingManager")],Te),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(Oe||(Oe={}));const Ae="visualization-handle";function Ge(){return Y.N.satisfiesConstraintScreenThreshold*Y.N.satisfiesConstraintScreenThreshold}function Pe(e,t){return!t||null==t.direction&&null==t.distance||!(e instanceof te.X||e instanceof ie.z||e instanceof ae.o||e instanceof ne.B||e instanceof se.R)&&(!(e instanceof re.HJ)||null==t.direction&&e.selfSnappingType===re._b.LastVertex)}function Ce(e,t){let i=-1;for(let o=0;o<e.length;++o)if(t.constraint.equals(e[o].constraint)){i=o;break}return i}function Re(e){let{coordinateHelper:t,elevationInfo:i}=e;return t.hasZ()?I.qt:i}var ke=i(31633),De=i(38983),He=i(20664),Ie=i(14487),Ue=i(13927),xe=i(45097),Le=i(41868);function Ne(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.hasZ;const o=(0,Le.l)(e.spatialReference),a=(0,ke.B5)(o);if(null==a)return null;const n=(e,t)=>!(t.length<2)&&((0,He.i)(e,t[0],t[1],i&&t[2]||0),!0);let r=0;for(const s of e.rings){const i=s.length;if(i<3)continue;const{positionsWorldCoords:a}=t;for(;a.length<i;)a.push((0,de.vt)());const l=Ze,p=(0,He.i)(Fe,0,0,0),d=1/i;for(let t=0;t<i;t++){if(!n(l,s[t]))return null;if(!(0,Ie.F)(l,e.spatialReference,a[t],o))return null;(0,He.b)(p,p,a[t],d)}const c=(0,Ue.Cr)(a[0],a[1],p,(0,Ue.LV)());if(0===(0,He.k)((0,Ue.Qj)(c)))continue;for(let e=0;e<i;e++)(0,Ue.Z1)(c,p,a[e],a[e]);const h=Ve(a);for(let e=0;e<h.length;e+=3)r+=(0,xe.Fm)(a[h[e]],a[h[e+1]],a[h[e+2]])}return(0,pe.gT)(r,a)}const Ze=(0,de.vt)(),Fe=(0,de.vt)();function Ve(e){return(0,De.e)(function(e){const t=new Float64Array(2*e.length);for(let i=0;i<e.length;++i){const o=e[i],a=2*i;t[a]=o[0],t[a+1]=o[1]}return t}(e),[],2)}const je=e=>({geodesicArea(t){const{spatialReference:i}=t;return(0,ve.M0)(i,Be,t=>function(e,t){try{return(0,pe.gT)(Math.abs(e.geodesicArea(t,"square-meters")),"square-meters")}catch(i){return null}}(e,t),t)}});function Be(e){return(0,pe.gT)(Math.abs((0,ue.qy)([e],"square-meters")[0]),"square-meters")}const qe=e=>({autoAreaByElevationMode(t,i){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{positionsWorldCoords:[]};if("on-the-ground"===i){const i=e.geodesicArea(t);return null!=i?i:function(e){return Ne(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{positionsWorldCoords:[]},!1)}(t,o)}return function(e){return Ne(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{positionsWorldCoords:[]})}(t,o)},autoArea2D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{positionsWorldCoords:[]};return this.autoAreaByElevationMode(e,"on-the-ground",t)}});let Ye=null;async function ze(){return Ye||(Ye=qe(await async function(){const e=await Promise.all([i.e(2612),i.e(3391)]).then(i.bind(i,63391));return je(e)}())),Ye}var We=i(29772);async function Ke(){return function(e){return{autoLength2D:t=>{var i;return null!==(i=e.geodesicLength(t))&&void 0!==i?i:(0,We.Xg)(t)},autoDistanceBetweenPoints2D:(t,i)=>{var o;return null!==(o=e.geodesicDistanceBetweenPoints(t,i))&&void 0!==o?o:(0,We.ll)(t,i)},autoDistance2D:(t,i,o)=>{var a;return Xe[0]=t[0],Xe[1]=t[1],Xe[2]=3===t.length?t[2]:0,$e[0]=i[0],$e[1]=i[1],$e[2]=3===i.length?i[2]:0,null!==(a=e.geodesicDistance(Xe,$e,o))&&void 0!==a?a:(0,We.sT)(Xe,$e,o)}}}(await me())}const Xe=(0,de.vt)(),$e=(0,de.vt)();var Qe=i(1723),Je=i(53787),et=i(11500),tt=i(4212);let it=class extends b.A.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:(0,tt.Xb)(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){var e;null===(e=this.activeComponent)||void 0===e||e.reset()}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type&&"graphic-mover"!==e.type||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};(0,a._)([(0,p.MZ)()],it.prototype,"activeComponent",void 0),(0,a._)([(0,p.MZ)()],it.prototype,"cancelled",void 0),(0,a._)([(0,p.MZ)()],it.prototype,"history",void 0),(0,a._)([(0,p.MZ)()],it.prototype,"tool",null),(0,a._)([(0,p.MZ)()],it.prototype,"type",void 0),(0,a._)([(0,p.MZ)()],it.prototype,"canUndo",null),(0,a._)([(0,p.MZ)()],it.prototype,"canRedo",null),(0,a._)([(0,p.MZ)()],it.prototype,"onEnd",void 0),(0,a._)([(0,p.MZ)()],it.prototype,"undo",null),(0,a._)([(0,p.MZ)()],it.prototype,"redo",null),(0,a._)([(0,p.MZ)()],it.prototype,"toggleTool",void 0),(0,a._)([(0,p.MZ)()],it.prototype,"addToSelection",void 0),(0,a._)([(0,p.MZ)()],it.prototype,"removeFromSelection",void 0),it=(0,a._)([(0,c.$)("esri.widgets.Sketch.support.OperationHandle")],it);let ot=class extends it{};(0,a._)([(0,p.MZ)()],ot.prototype,"activeComponent",void 0),ot=(0,a._)([(0,c.$)("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],ot);let at=class extends it{};var nt;(0,a._)([(0,p.MZ)()],at.prototype,"activeComponent",void 0),at=(0,a._)([(0,c.$)("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],at),function(e){e[e.ForceCollapse=-1]="ForceCollapse",e[e.Low=0]="Low",e[e.Medium=10]="Medium",e[e.High=100]="High",e[e.Max=1e3]="Max"}(nt||(nt={}));const rt={defaultZ:0},st={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:Qe.Tv},tool:"transform"};let lt=class extends b.A.EventedAccessor{constructor(e){var t,i,o;super(e),this._defaultSnappingManager=null,this._updatingHandles=new h.U,this._internalGraphicsLayer=new u.A({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new R.A({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new P.A({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new C.A({color:[130,130,130,1],width:2}),this.meshSymbol=new G.A({symbolLayers:new f.A([new A.A])}),this.updateGraphics=new f.A,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new R.A({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new F.A,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=rt,this.defaultUpdateOptions=st,this.snappingOptions=null!==(t=null!==(i=null===e||void 0===e||null===(o=e.snappingManager)||void 0===o?void 0:o.options)&&void 0!==i?i:null===e||void 0===e?void 0:e.snappingOptions)&&void 0!==t?t:new X}initialize(){this.addHandles([(0,l.on)(()=>{var e;return null===(e=this.view)||void 0===e||null===(e=e.map)||void 0===e?void 0:e.layers},"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),(0,l.on)(()=>{var e;return null===(e=this.layer)||void 0===e?void 0:e.graphics},"change",e=>{if(null!=this._operationHandle)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),(0,l.wB)(()=>{var e,t;return null!==(e=null===(t=this.layer)||void 0===t?void 0:t.elevationInfo)&&void 0!==e?e:null},e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},l.pc),(0,l.wB)(()=>this.view,e=>{this._defaultSnappingManager=(0,s.pR)(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new Te({view:e,options:this.snappingOptions})),"2d"===e.type?Promise.all([i.e(6871),i.e(6364),i.e(2103),i.e(426),i.e(5903),i.e(1010),i.e(1685),i.e(3725),i.e(79)]).then(i.bind(i,45924)):"3d"===e.type&&(Promise.all([i.e(6871),i.e(6364),i.e(2103),i.e(426),i.e(8105),i.e(4439),i.e(9592),i.e(5903),i.e(1010),i.e(6961),i.e(1685),i.e(3725),i.e(7336),i.e(5011),i.e(4536),i.e(8699),i.e(6160),i.e(8383)]).then(i.bind(i,51045)),Promise.all([i.e(8105),i.e(9592),i.e(6961),i.e(809),i.e(5131),i.e(7336),i.e(4536),i.e(6160),i.e(3647),i.e(179)]).then(i.bind(i,40179))))},l.pc),(0,l.wB)(()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.spatialReference},(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),(0,ee.BY)(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=(0,s.pR)(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||null!=this.snappingManager&&this.snappingManager.updating}get activeTool(){var e,t;return null!==(e=null===(t=this._operationHandle)||void 0===t?void 0:t.tool)&&void 0!==e?e:null}get activeCreateToolDrawMode(){var e;return"create"===(null===(e=this._operationHandle)||void 0===e?void 0:e.type)&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,i=!t&&e&&"tooltip"in e?e.tooltip:null;return null!==i&&void 0!==i&&i.visible?i:null}get activeComponent(){var e,t;return null!==(e=null===(t=this._operationHandle)||void 0===t?void 0:t.activeComponent)&&void 0!==e?e:null}get createGraphic(){return null==this.activeComponent||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",(0,o.A)((0,o.A)({},rt),e))}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",(0,o.A)((0,o.A)((0,o.A)({},st),e),{},{reshapeOptions:(0,o.A)((0,o.A)({},st.reshapeOptions),null===e||void 0===e?void 0:e.reshapeOptions),highlightOptions:(0,o.A)((0,o.A)({},st.highlightOptions),null===e||void 0===e?void 0:e.highlightOptions)}))}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){var e,t;return null!==(e=null===(t=this.snappingManager)||void 0===t?void 0:t.options)&&void 0!==e?e:this._get("snappingOptions")}set snappingOptions(e){null!=this._defaultSnappingManager&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=(0,s.pR)(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new Te({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){var e;const t=!(null===(e=this.view)||void 0===e||!e.ready||!this.layer),i=this._operationHandle;return t&&i?"active":t?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:i}=t;e&&(t.cursor=null),null!==i&&void 0!==i&&i.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const i="view-ready";this.removeHandles(i),e&&this.addHandles((0,l.z7)(()=>e.ready,t=>{this.removeHandles(this._viewHandlesKey),t&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},l.pc),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController=(0,s.DC)(this._moduleLoaderAbortController),this._viewReadyAbortController=(0,s.DC)(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e,layer:i}=this,o=t.toArray();i.removeMany(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:e})}}duplicate(){if("active"===this.state&&this.updateGraphics.length){const e=this.updateGraphics.map(e=>e.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:i,layer:o}=this;if(!i||"disabled"===this.state)throw o||this._logMissingLayer(),(0,E.NK)();if(null!=i.activeTool&&(i.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");(0,x.Y)(i,this._internalGraphicsLayer);const a=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(null==a||this.destroyed)return void i.map.remove(this._internalGraphicsLayer);a.on("complete",()=>{if(a===this._operationHandle){var i;const n=this.createGraphic,r=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),null!==(i=this.view)&&void 0!==i&&i.map&&this.view.map.remove(this._internalGraphicsLayer),a.cancelled||null==n||o.add(n),this._sketchContinuationFlag=!1,this.emit("create",{graphic:n,state:r?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),r||this._sketchContinuationFlag)return;const{creationMode:s}=this;if("continuous"===s){if(null!==t&&void 0!==t&&t.geometryToPlace)return;this._updatingHandles.addPromise((0,E.QZ)(this.create(e,t)))}else"update"===s&&n&&this._updatingHandles.addPromise((0,E.QZ)(this.update([n])))}}),this._operationHandle=a,i.ready&&i.focus()}async place(e,t){return this.create("mesh",(0,o.A)({mode:"click",hasZ:e.hasZ,geometryToPlace:e},t))}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:i,view:o,state:a}=this;if(!o||"disabled"===a)throw i||this._logMissingLayer(),(0,E.NK)();null!=o.activeTool&&(o.activeTool=null);const n=Array.isArray(e)?e:[e];if(null==e||null===n||void 0===n||!n.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(n.some(e=>e.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):null==e.geometry&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const r=await this._updatingHandles.addPromise(this._setupUpdateOperation(n,t));this.destroyed||null==r||ft(r)||((0,x.Y)(o,this._internalGraphicsLayer),this._setUpdateOperationHandle(r,t),this.emit("update",{graphics:n,state:"start",aborted:!1,tool:r.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const i of e)null==i.geometry||"mesh"===i.geometry.type||(0,T.aI)(i.geometry.spatialReference,t.spatialReference)||((0,S.canProjectWithoutEngine)(i.geometry.spatialReference,t.spatialReference)||(0,S.isLoaded)()||await(0,S.load)(),i.geometry=(0,S.project)(i.geometry,t.spatialReference))}else this._logMissingView()}undo(){var e;this.canUndo()&&(null===(e=this._operationHandle)||void 0===e||e.undo())}redo(){var e;this.canRedo()&&(null===(e=this._operationHandle)||void 0===e||e.redo())}canUndo(){var e;return!(null===(e=this._operationHandle)||void 0===e||!e.canUndo())}canRedo(){var e;return!(null===(e=this._operationHandle)||void 0===e||!e.canRedo())}toggleUpdateTool(){var e;null===(e=this._operationHandle)||void 0===e||e.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if("2d"===t.type){const i=[];t.map.allLayers.forEach(e=>{"vector-tile"!==e.type&&"imagery"!==e.type||i.push(e)});const o=await t.hitTest(e,{exclude:i});return(0,Je.zF)(o.results)}const i=[t.map.ground];t.map.allLayers.forEach(e=>{(0,O.Eq)(e.type)&&i.push(e)});const o=await t.hitTest(e,{exclude:i});if(o.results.length>0){var a;const e=o.results[0];if(null!=e&&"graphic"===e.type&&e.graphic&&(!o.ground.mapPoint||t.map.ground.opacity<1||o.ground.distance-(null!==(a=e.distance)&&void 0!==a?a:0)>-Math.min(3*o.ground.distance,"global"===t.viewingMode?(0,w.tO)(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return e}return null}_generateViewHandles(e){return[e.on("immediate-click",async e=>{var t;const i="active"===this.state&&"create"===(null===(t=this._operationHandle)||void 0===t?void 0:t.type);"disabled"!==this.state&&!i&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))},L.o.WIDGET)]}async _handleImmediateClick(e){const t=await e.defer(()=>this._getFirstHit((0,et.ZV)(e)));let i=null;if(null!=t){var a;const o=t.graphic;this.updateGraphics.includes(o)||o.layer===this.layer?(e.stopPropagation(),i=o):"2d"!==(null===(a=this.view)||void 0===a?void 0:a.type)||this._isComponentGraphic(o)||"active"!==this.state||this.cancel()}else"active"===this.state&&this.cancel();null==i||this.updateGraphics.includes(i)||await this.update([i],(0,o.A)((0,o.A)({},this.defaultUpdateOptions),{},{reshapeOptions:(0,o.A)({},this.defaultUpdateOptions.reshapeOptions)}))}async _setupCreateOperation(e,t){const i=this.view;if(!i)return this._logMissingView(),null;const a=(0,o.A)((0,o.A)({hasZ:"3d"===i.type},this.defaultCreateOptions),t),n=await this._setupDrawGraphicTool(e,i,a);return null==n?null:(i.tools.add(n),i.activeTool=n,this._setupCreateOperationHandle(n))}async _setupDrawGraphicTool(e,t,i){var a,n,r;if("multipoint"===e&&"3d"===t.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:s,defaultZ:l,hasZ:p,geometryToPlace:d,graphicProperties:c,mode:h,preserveAspectRatio:u}=i,v=function(e,t){return"freehandPolygon"===t||"freehandPolyline"===t?"freehand":null!==e&&void 0!==e?e:"rectangle"===t||"circle"===t?"hybrid":"click"}(h,e),y=function(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}}(e),g=null!==i&&void 0!==i&&null!==(a=i.optionsPerTool)&&void 0!==a&&a.has(e)?i.optionsPerTool.get(e):{},m=null!==(n=null!==(r=null===g||void 0===g?void 0:g.preserveAspectRatio)&&void 0!==r?r:u)&&void 0!==n?n:"rectangle"!==e,f=(0,o.A)({centered:"rectangle"!==e&&!("circle"===e&&!m),cursor:s,defaultZ:l,forceUniformSize:m,graphicProperties:(0,o.A)((0,o.A)({},c),{},{attributes:(0,o.A)({},null===c||void 0===c?void 0:c.attributes)}),geometryToPlace:d,geometryType:y,mode:v,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:p,snappingManager:this.snappingManager,snapToScene:!1,view:t},g);return"2d"===t.type?this._makeDrawGraphicTool2D(f):this._makeDrawGraphicTool3D(f)}async _makeDrawGraphicTool2D(e){const[t,a,n]=await Promise.all([this._requireModule(Promise.all([i.e(6871),i.e(6364),i.e(2103),i.e(426),i.e(5903),i.e(1010),i.e(1685),i.e(3725),i.e(79)]).then(i.bind(i,45924))),ze(),Ke()]);return ft(t)||this.destroyed?null:new t.module.DrawGraphicTool2D((0,o.A)((0,o.A)({},e),{},{activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:ct(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:n}))}async _makeDrawGraphicTool3D(e){const[t,a,n]=await Promise.all([this._requireModule(Promise.all([i.e(6871),i.e(6364),i.e(2103),i.e(426),i.e(8105),i.e(4439),i.e(9592),i.e(5903),i.e(1010),i.e(6961),i.e(1685),i.e(3725),i.e(7336),i.e(5011),i.e(4536),i.e(8699),i.e(6160),i.e(8383)]).then(i.bind(i,51045))),ze(),Ke()]);if(ft(t)||this.destroyed)return null;const{elevationInfo:r}=this.layer;return new t.module.DrawGraphicTool3D((0,o.A)((0,o.A)({},e),{},{elevationInfo:r,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:n}))}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let i=null;const o=e.forceUniformSize,a=e.centered,n=[t.on("key-down",t=>{if(t.key===N.NE.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===N.NE.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==N.NE.vertexAdd||t.repeat)t.key===N.NE.undo?(t.stopPropagation(),s.undo()):t.key===N.NE.redo?(t.stopPropagation(),s.redo()):t.key!==N.NE.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType||t.repeat?t.key===N.NE.center&&(t.repeat||(e.centered=!a,t.stopPropagation())):(e.forceUniformSize=!o,t.stopPropagation());else{const i=e.drawOperation.geometryType;"polyline"!==i&&"polygon"!==i&&"multipoint"!==i||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}},L.o.WIDGET),t.on("key-up",t=>{t.key===N.NE.pan?e.enabled=!0:t.key!==N.NE.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType?t.key===N.NE.center&&(e.centered=a,t.stopPropagation()):(e.forceUniformSize=o,t.stopPropagation())},L.o.WIDGET),e.on("vertex-add",t=>{switch(i=null==i?"start":"active",t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:i,tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",t=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",t=>{switch(t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",e=>{this._set("createGraphic",e.graphic),i="complete",e.aborted?s&&s.cancel():s&&s.complete()}),(0,l.wB)(()=>this._getGraphicSymbolFromTool(e.geometryType),t=>{e.graphicSymbol=t})],s=new ot({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{var i;(0,r.ei)(n),null===(i=t.tools)||void 0===i||i.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return s}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){var i;const{layer:a,view:n}=this;if(!n)return this._logMissingView(),null;const r=(0,o.A)((0,o.A)((0,o.A)({},this.defaultUpdateOptions),t),{},{reshapeOptions:(0,o.A)((0,o.A)({},this.defaultUpdateOptions.reshapeOptions),null===t||void 0===t?void 0:t.reshapeOptions),highlightOptions:(0,o.A)((0,o.A)({},this.defaultUpdateOptions.highlightOptions),null===t||void 0===t?void 0:t.highlightOptions)});let s=null!==(i=r.tool)&&void 0!==i?i:st.tool;for(const o of e)a.remove(o),a.add(o);if("3d"===n.type){if(0===e.length)return null;switch(s){case"move":return this._setupMove3DOperation(e,r,n,s);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],r,n);case"transform":return this._setupGraphicTransform3DOperation(e,r,n)}}switch(s){case"move":return this._setupMove2DOperation(e,r,n);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,s,r,n);case"transform":if(1===e.length){var l;const t=null===(l=e[0].geometry)||void 0===l?void 0:l.type;"point"!==t&&"multipoint"!==t||(s="reshape")}return this._setupTransformOrReshape2DOperation(e,s,r,n)}}async _setupMove3DOperation(e,t,o,a){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const[s,l]=await Promise.all([this._requireModule(Promise.all([i.e(6871),i.e(6364),i.e(2103),i.e(426),i.e(8105),i.e(4439),i.e(9592),i.e(5903),i.e(1010),i.e(6961),i.e(1685),i.e(3725),i.e(7336),i.e(5011),i.e(4536),i.e(8699),i.e(6160),i.e(8383)]).then(i.bind(i,51045))),Ke()]);if(ft(s))return s;const{ManipulatedObject3DGraphic:p,MoveTool3D:d}=s.module,c=new Map,h=()=>{c.forEach(e=>e.destroy()),c.clear()};for(const i of e){const e=new p({view:o,graphic:i}),t=(0,H.Y)(e);if(t!==D.d.SUPPORTED)return h(),this._logError("sketch:move","Move operation not supported for provided graphic(s) (".concat((0,D.c)(t),").")),null;c.set(i,e)}const u=new d({view:o,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:l});o.tools.add(u),u.objects.addMany(Array.from(c.values())),n||this.updateGraphics.addMany(e);const v=[],y=new at({activeComponent:u,tool:a,type:"update",onEnd:()=>{(0,r.ei)(v),mt(o,u),h()},undo:()=>{yt(this.view,u),ht(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{ut(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:e=>{this.updateGraphics.push(e);const t=new p({view:o,graphic:e});c.set(e,t),u.objects.push(t),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);if(y.history.undo.forEach(e=>e.updates.splice(t,1)),y.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0===this.updateGraphics.length)return void y.complete();const i=c.get(e);i&&(u.objects.remove(i),i.destroy(),c.delete(e))},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;if("transform"!==a)return;const e=this.updateGraphics.at(0),i=await this._setupReshape3DOperation(e,t,o,!0);i&&!ft(i)&&(y.onEnd(),y.destroy(),this._setUpdateOperationHandle(i,t))}});return v.push(...this._getHandlesForComponent(y,t),o.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(y,e,t),L.o.WIDGET),o.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(y,e)},L.o.WIDGET)),y}_setupGraphicTransform3DOperation(e,t,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(1===e.length&&function(e){var t;if("graphics"!==(null===(t=e.layer)||void 0===t?void 0:t.type))return D.d.GRAPHICS_LAYER_MISSING;if(null==e.geometry)return D.d.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return D.d.SUPPORTED;default:return D.d.GEOMETRY_TYPE_UNSUPPORTED}const i=null!=e.symbol&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return i&&i.some(e=>"object"===e.type)?"on-the-ground"!==(0,I.ky)(e)&&(0,I.NN)(e)?D.d.ELEVATION_MODE_UNSUPPORTED:D.d.SUPPORTED:D.d.SYMBOL_TYPE_UNSUPPORTED}(e[0])===D.d.SUPPORTED){const a=e[0],n=a.geometry;if(null!=n&&("point"===n.type||"mesh"===n.type))return this._setupPointTransform3DOperation(a,t,i);if(null!=n&&("polygon"===n.type||"polyline"===n.type))return this._setupPolyTransform3DOperation(a,t,i,o)}return this._setupMove3DOperation(e,t,i,"transform",o)}async _setupPointTransform3DOperation(e,t,o){const a="transform",{enableRotation:n,enableScaling:s,enableZ:l}=t,p=await this._requireModule(Promise.all([i.e(6871),i.e(6364),i.e(2103),i.e(426),i.e(8105),i.e(4439),i.e(9592),i.e(5903),i.e(1010),i.e(6961),i.e(1685),i.e(3725),i.e(7336),i.e(5011),i.e(4536),i.e(8699),i.e(6160),i.e(8383)]).then(i.bind(i,51045)));if(ft(p))return p;const{TransformTool3D:d,ManipulatedObject3DGraphic:c}=p.module,h=new c({graphic:e,view:o}),u=new d({object:h,view:o,enableRotation:n,enableScaling:s,enableZ:l,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});o.tools.add(u),this.updateGraphics.add(e);const v=[],y=new at({activeComponent:u,tool:a,type:"update",onEnd:()=>{(0,r.ei)(v),mt(o,u),h.destroy()},undo:()=>{yt(this.view,u),ht(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{ut(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);ft(i)||this._setUpdateOperationHandle(i,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),y.complete()},toggleTool:()=>{}});return v.push(...this._getHandlesForComponent(y,t),o.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(y,e,t),L.o.WIDGET),o.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(y,e)},L.o.WIDGET)),y}async _setupPolyTransform3DOperation(e,t,o){var a;let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s="transform",{enableRotation:l,enableScaling:p,enableZ:d,preserveAspectRatio:c}=t,[h,u]=await Promise.all([this._requireModule(Promise.all([i.e(6871),i.e(6364),i.e(2103),i.e(426),i.e(8105),i.e(4439),i.e(9592),i.e(5903),i.e(1010),i.e(6961),i.e(1685),i.e(3725),i.e(7336),i.e(5011),i.e(4536),i.e(8699),i.e(6160),i.e(8383)]).then(i.bind(i,51045))),Ke()]);if(ft(h))return h;const{ManipulatedObject3DGraphic:v,ExtentTransformTool:y}=h.module,g=null===(a=this.view)||void 0===a||null===(a=a.inputManager)||void 0===a?void 0:a.isModifierKeyDown(N.NE.constraint),m=new v({view:o,graphic:e}),f=new y({object:m,view:o,enableRotation:l,enableScaling:p,enableZ:d,preserveAspectRatio:!!c!=!!g,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:u});o.tools.add(f),n||this.updateGraphics.add(e);const _=[],b=new at({activeComponent:f,tool:s,type:"update",onEnd:()=>{(0,r.ei)(_),mt(o,f),m.destroy()},canUndo:()=>!f.destroyed&&f.canUndo,undo:()=>{f.destroyed||(f.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},canRedo:()=>!f.destroyed&&f.canRedo,redo:()=>{f.destroyed||(f.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),b.onEnd(),b.destroy();const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);ft(i)||this._setUpdateOperationHandle(i,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),b.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;const i=await this._setupReshape3DOperation(e,t,o,!0);i&&!ft(i)&&(b.onEnd(),b.destroy(),this._setUpdateOperationHandle(i,t))}});return _.push(...this._getHandlesForComponent(b,t),o.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(b,e,t),L.o.WIDGET),o.on("key-down",e=>this._getCommonUpdateOperationKeyDownHandlers(b,e),L.o.WIDGET),o.on("key-down",e=>{e.key!==N.NE.constraint||e.repeat||(f.preserveAspectRatio=!f.preserveAspectRatio,e.stopPropagation())},L.o.WIDGET),o.on("key-up",e=>{e.key===N.NE.constraint&&(f.preserveAspectRatio=!f.preserveAspectRatio,e.stopPropagation())},L.o.WIDGET)),b}async _setupMove2DOperation(e,t,i){const o="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const a=await this._getGraphicMover(e,t,i);if(ft(a))return a;const n=new at({activeComponent:a,tool:o,type:"update",onEnd:()=>{var e;this._displayDefaultCursor(),(0,r.ei)(p),(0,r.ei)(l),a.destroy(),null===(e=this._internalGraphicsLayer)||void 0===e||e.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const e=this.updateGraphics.toArray();ht(n,e),n.refreshComponent(),this._emitUndoEvent({graphics:e,tool:o})},redo:()=>{const e=this.updateGraphics.toArray();ut(n,e),n.refreshComponent(),this._emitRedoEvent({graphics:e,tool:o})},addToSelection:async e=>{await this._updatingHandles.addPromise(this._updateSpatialReference(e)),this.updateGraphics.push(e),a.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);n.history.undo.forEach(e=>e.updates.splice(t,1)),n.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);const i=this.updateGraphics.toArray();this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?a.graphics=i:n.complete()}});let s=!1;const l=[i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(n,e,t),L.o.WIDGET),i.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(n,e),e.key!==N.NE.constraint||e.repeat||(s=!0,a.enableMoveAllGraphics=!a.enableMoveAllGraphics)},L.o.WIDGET),i.on("key-up",e=>{e.key===N.NE.constraint&&s&&(s=!1,a.enableMoveAllGraphics=!a.enableMoveAllGraphics)},L.o.WIDGET)],p=this._getHandlesForComponent(n,t);return n}async _setupReshape3DOperation(e,t,o){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n="reshape",[s,l,p]=await Promise.all([this._requireModule(Promise.all([i.e(6871),i.e(6364),i.e(2103),i.e(426),i.e(8105),i.e(4439),i.e(9592),i.e(5903),i.e(1010),i.e(6961),i.e(1685),i.e(3725),i.e(7336),i.e(5011),i.e(4536),i.e(8699),i.e(6160),i.e(8383)]).then(i.bind(i,51045))),ze(),Ke()]);if(ft(s))return s;const{ManipulatedObject3DGraphic:d,ReshapeTool3D:c}=s.module,h=new d({view:o,graphic:e}),u=U(h);if(u!==D.d.SUPPORTED)return h.destroy(),this._logError("sketch:reshape","Reshape operation not supported for provided graphic(s) (".concat((0,D.c)(u),").")),null;const v=t.reshapeOptions,y=new c({view:o,object:h,enableZVertex:t.enableZ&&"move"===(null===v||void 0===v?void 0:v.vertexOperation),enableZShape:t.enableZ&&"move"===(null===v||void 0===v?void 0:v.shapeOperation),enableMoveObject:"move"===(null===v||void 0===v?void 0:v.shapeOperation)||"move-xy"===(null===v||void 0===v?void 0:v.shapeOperation),enableMidpoints:"split"===(null===v||void 0===v?void 0:v.edgeOperation),enableEdgeOffset:"offset"===(null===v||void 0===v?void 0:v.edgeOperation),snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:p});o.tools.add(y),a||this.updateGraphics.add(h.graphic);const g=[],m=new at({activeComponent:y,tool:n,type:"update",onEnd:()=>{(0,r.ei)(g),mt(o,y),h.destroy()},canUndo:()=>!y.destroyed&&y.canUndo,undo:()=>{y.destroyed||(y.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n}))},canRedo:()=>!y.destroyed&&y.canRedo,redo:()=>{y.destroyed||(y.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),m.onEnd(),m.destroy();const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);ft(i)||this._setUpdateOperationHandle(i,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),m.complete()},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;m.onEnd(),m.destroy();const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,o,!0);ft(e)||this._setUpdateOperationHandle(e,t)}});return g.push(...this._getHandlesForComponent(m,t),o.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(m,e,t),L.o.WIDGET),o.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(m,e)},L.o.WIDGET)),m}async _setupTransformOrReshape2DOperation(e,t,i,o){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const a="transform"===t?await this._getBox(e,i,o):await this._getReshape(e,i,o);if(ft(a))return a;const n=new at({activeComponent:a,type:"update",onEnd:()=>{(0,r.ei)(l),(0,r.ei)(s),n.activeComponent&&!n.activeComponent.destroyed&&n.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{ht(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},redo:()=>{ut(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},addToSelection:async e=>{let t=n.activeComponent;if("reshape"===(null===t||void 0===t?void 0:t.type)){const t=[...this.updateGraphics,e];this.updateGraphics.removeAll(),n.onEnd(),n.destroy();const a=await this._setupTransformOrReshape2DOperation(t,"transform",i,o);if(ft(a))return;this._setUpdateOperationHandle(a,i)}else this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),n.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async e=>{const t=this.updateGraphics.indexOf(e);n.history.undo.forEach(e=>e.updates.splice(t,1)),n.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);const i=this.updateGraphics.toArray();if(0===i.length)n.complete();else{const e=i[0].geometry;1!==i.length||null==e||"point"!==e.type&&"multipoint"!==e.type?n.activeComponent.graphics=i:n.toggleTool()}this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"})},toggleTool:async()=>{var e;if(this.updateGraphics.length>1)return;const t=this.updateGraphics.at(0),a=t.geometry;if(null!=a&&("reshape"===n.tool&&("point"===a.type||"multipoint"===a.type)||"transform"===n.tool&&"extent"===a.type))return;let s=null;"transform"===n.tool?s=await this._getReshape([t],i,o):"reshape"===n.tool&&(s=await this._getBox([t],i,o)),ft(s)||(null!==(e=n.activeComponent)&&void 0!==e&&e.destroy(),n.activeComponent=s,n.activeComponent&&((0,r.ei)(l),l=this._getHandlesForComponent(n,i)))}}),s=[o.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(n,e,i),L.o.WIDGET),o.on("key-down",e=>{if(this._getCommonUpdateOperationKeyDownHandlers(n,e),e.key===N.NE.constraint&&!e.repeat&&n){const e=n.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},L.o.WIDGET),o.on("key-up",e=>{if(e.key===N.NE.constraint&&n){const e=n.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},L.o.WIDGET)];let l=this._getHandlesForComponent(n,i);return n}async _getGraphicMover(e,t,o){const{enableMoveAllGraphics:a,highlightOptions:n}=t,r=await this._requireModule(Promise.all([i.e(9091),i.e(1720)]).then(i.bind(i,61472)));return ft(r)?r:new r.module.default({enableMoveAllGraphics:a,highlightName:null===n||void 0===n?void 0:n.name,highlightsEnabled:!(null===n||void 0===n||!n.enabled),indicatorsEnabled:!1,graphics:e,view:o,callbacks:{onGraphicMoveStart:e=>{let{dx:t,dy:i,graphic:o}=e;this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:"move-start"},type:"update"})},onGraphicMove:e=>{let{dx:t,dy:i,graphic:o}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:"move"},type:"update"})},onGraphicMoveStop:e=>{let{dx:t,dy:i,graphic:o}=e;this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,a){var n;const{enableRotation:r,enableScaling:s,highlightOptions:l,preserveAspectRatio:p}=t,[d,c]=await Promise.all([this._requireModule(Promise.all([i.e(5903),i.e(9091),i.e(7877)]).then(i.bind(i,20819))),Ke()]);if(ft(d))return d;const h=null===(n=this.view)||void 0===n||null===(n=n.inputManager)||void 0===n?void 0:n.isModifierKeyDown(N.NE.constraint);return new d.module.default({graphics:e,enableRotation:r,enableScaling:s,highlightName:null===l||void 0===l?void 0:l.name,highlightsEnabled:!(null===l||void 0===l||!l.enabled),preserveAspectRatio:!!p!=!!h,layer:this._internalGraphicsLayer,view:a,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:c,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,o.A)({},e),type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,o.A)({},e),type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,o.A)({},e),type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,o.A)({},e),type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,o.A)({},e),type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,o.A)({},e),type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,o.A)({},e),type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,o.A)({},e),type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,o.A)({},e),type:"update"})}})}async _getReshape(e,t,a){const{highlightOptions:n,reshapeOptions:r}=t,s="split"===(null===r||void 0===r?void 0:r.edgeOperation),l="move"===(null===r||void 0===r?void 0:r.shapeOperation),[p,d,c]=await Promise.all([this._requireModule(Promise.all([i.e(5903),i.e(1685),i.e(9091),i.e(9401)]).then(i.bind(i,90648))),ze(),Ke()]);return ft(p)?p:new p.module.default({enableMidpoints:s,enableMovement:l,graphic:e[0],highlightName:null===n||void 0===n?void 0:n.name,highlightsEnabled:!(null===n||void 0===n||!n.enabled),layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:d,automaticLengthMeasurementUtils:c,view:a,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,o.A)({},e),type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,o.A)({},e),type:"update"}),onReshapeStop:e=>{let{mover:t,type:i}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:t,type:i},type:"update"})},onMoveStart:e=>{let{dx:t,dy:i,mover:o,type:a}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:a},type:"update"})},onMove:e=>{let{dx:t,dy:i,mover:o,type:a}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:a},type:"update"})},onMoveStop:e=>{let{dx:t,dy:i,mover:o,type:a}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:a},type:"update"})},onVertexAdd:e=>{let{added:t,type:i,vertices:o}=e;const a=t.map(e=>(0,M.$K)(e.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:a,vertices:o,type:i},type:"update"})},onVertexRemove:e=>{let{removed:t,type:i,vertices:o}=e;const a=t.map(e=>(0,M.$K)(e.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:a,vertices:o,type:i},type:"update"})}}})}_getHandlesForComponent(e,t){const i=e.activeComponent;if(!i)return[];switch(i.type){case"graphic-mover":return[i.on("graphic-click",i=>{var o;let{graphic:a,viewEvent:n}=i;(null===(o=n.native)||void 0===o?void 0:o.shiftKey)&&t.multipleSelectionEnabled&&(n.stopPropagation(),e.removeFromSelection(a))}),i.on("graphic-move-start",t=>e.addToHistory(gt(t.allGraphics)))];case"box":return[i.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),i.on("move-start",t=>e.addToHistory(gt(t.graphics))),i.on("rotate-start",t=>e.addToHistory(gt(t.graphics))),i.on("scale-start",t=>e.addToHistory(gt(t.graphics)))];case"reshape":return[i.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),i.on("move-start",t=>e.addToHistory(gt([t.mover]))),i.on("reshape-start",t=>e.addToHistory(gt([t.graphic]))),i.on("vertex-add",t=>e.addToHistory(gt([t.oldGraphic]))),i.on("vertex-remove",t=>e.addToHistory(gt([t.oldGraphic])))];case"move-3d":return[i.events.on("record-undo",t=>{let{updates:i}=t;e.addToHistory({updates:i})}),i.events.on("move-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move-start"},type:"update"})}),i.events.on("move",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move"},type:"update"})}),i.events.on("move-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move-stop"},type:"update"})}),i.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[i.events.on("record-undo",t=>{let{updates:i}=t;e.addToHistory({updates:i})}),i.events.on("translate-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-start"},type:"update"})}),i.events.on("translate-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})}),i.events.on("rotate-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate-start"},type:"update"})}),i.events.on("rotate-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})}),i.events.on("scale-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-start"},type:"update"})}),i.events.on("scale-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"})}),i.events.on("translate",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})}),i.events.on("rotate",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate"},type:"update"})}),i.events.on("scale",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"})}),i.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[i.events.on("reshape",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,o.A)((0,o.A)({},e),{},{mover:e.object.graphic}),type:"update"})}),i.events.on("move",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,o.A)((0,o.A)({},e),{},{mover:e.object.graphic}),type:"update"})}),i.events.on("vertex-add",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),i.events.on("vertex-remove",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),i.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,i){var o;const{graphic:a,viewEvent:n}=i;return null!==(o=n.native)&&void 0!==o&&o.shiftKey&&a.layer===this.layer?(n.stopPropagation(),e.removeFromSelection(a)):t.toggleToolOnClick?(n.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){var i;this._operationHandle=e;const o=null===(i=this.view)||void 0===i?void 0:i.map;this._disablePopup(t);e.on("complete",()=>{if(e===this._operationHandle){const i=this.updateGraphics.toArray(),a=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),o&&o.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:i,state:"complete",aborted:e.cancelled,tool:a,toolEventInfo:null,type:"update"})}})}async _getCommonUpdateOperationClickHandlers(e,t,i){const o=(0,et.ZV)(t),a=await t.defer(()=>this._getFirstHit(o));null!=a&&(t.native.shiftKey&&this._toggleSelection([a.graphic],e,i)||this.updateGraphics.includes(a.graphic))?t.stopPropagation():e.complete()}_toggleSelection(e,t,i){const o=!!i.multipleSelectionEnabled;return e.some(e=>null!=e&&!(!o||e.layer!==this.layer)&&(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const i=t.key;i===N.NE.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):i===N.NE.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):i===N.NE.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&N.NE.delete.includes(i)&&this._onDeleteKey(t)}_onDeleteKey(e){var t;if(!this._operationHandle||"update"!==this._operationHandle.type)return;const i=this.activeComponent,o=this.updateGraphics.toArray();null!=i&&("reshape"!==i.type||1===o.length&&"point"===(null===(t=o[0].geometry)||void 0===t?void 0:t.type))&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){var e;this._internalGraphicsLayer&&(null!==(e=this.view)&&void 0!==e&&null!==(e=e.map)&&void 0!==e&&e.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=(0,s.pR)(this._internalGraphicsLayer))}_isComponentGraphic(e){var t;const{activeComponent:i}=this;return!(!e||null==i)&&((null===(t=e.attributes)||void 0===t?void 0:t.esriSketchTool)||"draw-2d"===i.type&&i.graphic===e||("box"===i.type||"reshape"===i.type)&&i.isUIGraphic(e))}_displayPointerCursor(){var e;(null===(e=this.view)||void 0===e?void 0:e.container)&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")}_displayGrabbingCursor(){var e;(null===(e=this.view)||void 0===e?void 0:e.container)&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")}_displayDefaultCursor(){var e;(null===(e=this.view)||void 0===e?void 0:e.container)&&null!==this.view.cursor&&(this.view.cursor=null)}_logError(e,t,i){d.A.getLogger(this).error(new _.A(e,t,i))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",(0,o.A)((0,o.A)({},e),{},{type:"undo"}))}_emitRedoEvent(e){this.emit("redo",(0,o.A)((0,o.A)({},e),{},{type:"redo"}))}_emitDeleteEvent(e){this.emit("delete",(0,o.A)((0,o.A)({},e),{},{type:"delete"}))}get test(){}wait(){return(0,l.C_)(()=>!this.updating)}_disablePopupEnabled(e){var t,i;return"3d"!==(null===(t=this.view)||void 0===t?void 0:t.type)||this.updateOnGraphicClick||null!==(i=null===e||void 0===e?void 0:e.toggleToolOnClick)&&void 0!==i&&i}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&null==this._originalPopupEnabled&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&null!=this._originalPopupEnabled&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?((0,s.DC)(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await(0,E.qr)((0,l.C_)(()=>null===e||void 0===e?void 0:e.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",dt("view"))}_logMissingLayer(){this._logError(pt,dt("layer"))}};(0,a._)([(0,p.MZ)()],lt.prototype,"_defaultSnappingManager",void 0),(0,a._)([(0,p.MZ)()],lt.prototype,"updating",null),(0,a._)([(0,p.MZ)({readOnly:!0})],lt.prototype,"_updatingHandles",void 0),(0,a._)([(0,p.MZ)()],lt.prototype,"_operationHandle",void 0),(0,a._)([(0,p.MZ)({readOnly:!0})],lt.prototype,"activeTool",null),(0,a._)([(0,p.MZ)({readOnly:!0})],lt.prototype,"activeCreateToolDrawMode",null),(0,a._)([(0,p.MZ)()],lt.prototype,"activeTooltip",null),(0,a._)([(0,p.MZ)({types:k.Es})],lt.prototype,"activeFillSymbol",void 0),(0,a._)([(0,p.MZ)()],lt.prototype,"activeLineSymbol",void 0),(0,a._)([(0,p.MZ)()],lt.prototype,"activeVertexSymbol",void 0),(0,a._)([(0,p.MZ)()],lt.prototype,"allowDeleteKey",void 0),(0,a._)([(0,p.MZ)({readOnly:!0})],lt.prototype,"createGraphic",null),(0,a._)([(0,p.MZ)()],lt.prototype,"defaultCreateOptions",null),(0,a._)([(0,p.MZ)()],lt.prototype,"defaultUpdateOptions",null),(0,a._)([(0,p.MZ)({type:Z.A,nonNullable:!0})],lt.prototype,"labelOptions",null),(0,a._)([(0,p.MZ)()],lt.prototype,"layer",void 0),(0,a._)([(0,p.MZ)({types:k.Es})],lt.prototype,"pointSymbol",void 0),(0,a._)([(0,p.MZ)({types:k.Es})],lt.prototype,"polygonSymbol",void 0),(0,a._)([(0,p.MZ)({types:k.Es})],lt.prototype,"polylineSymbol",void 0),(0,a._)([(0,p.MZ)()],lt.prototype,"meshSymbol",void 0),(0,a._)([(0,p.MZ)({type:X,nonNullable:!0})],lt.prototype,"snappingOptions",null),(0,a._)([(0,p.MZ)()],lt.prototype,"snappingManager",null),(0,a._)([(0,p.MZ)({readOnly:!0})],lt.prototype,"state",null),(0,a._)([(0,p.MZ)({type:V.A,nonNullable:!0})],lt.prototype,"tooltipOptions",null),(0,a._)([(0,p.MZ)({readOnly:!0})],lt.prototype,"updateGraphics",void 0),(0,a._)([(0,p.MZ)()],lt.prototype,"updateOnGraphicClick",void 0),(0,a._)([(0,p.MZ)()],lt.prototype,"creationMode",void 0),(0,a._)([(0,p.MZ)({type:j.A,nonNullable:!0})],lt.prototype,"valueOptions",null),(0,a._)([(0,p.MZ)({types:k.Es})],lt.prototype,"vertexSymbol",void 0),(0,a._)([(0,p.MZ)({value:null})],lt.prototype,"view",null),(0,a._)([(0,p.MZ)({constructOnly:!0,type:F.A})],lt.prototype,"sketchOptions",void 0),lt=(0,a._)([(0,c.$)("esri.widgets.Sketch.SketchViewModel")],lt);const pt="sketch:missing-property",dt=e=>"Property '".concat(e,"' is missing on SketchViewModel.");function ct(e){return"polygon"===e||"rectangle"===e||"circle"===e}function ht(e,t){vt("undo",e.history.undo,e.history.redo,t)}function ut(e,t){vt("redo",e.history.redo,e.history.undo,t)}function vt(e,t,i,o){const a=t.pop();if(!a)return;const n=a.updates,r=[];o.forEach((t,i)=>{const o=n[i];null!=o&&("geometry"in o&&null!=o.geometry&&(r.push({geometry:t.geometry}),t.geometry=o.geometry),"symbol"in o&&null!=o.symbol&&(r.push({symbol:t.symbol}),t.symbol=o.symbol),"undo"in o&&(r.push(o),o[e](t)))}),i.push({updates:r})}function yt(e,t){null!=e&&t.hasGrabbedManipulators&&(e.activeTool=null)}function gt(e){return{updates:e.map(e=>{let{geometry:t}=e;return"mesh"===(null===t||void 0===t?void 0:t.type)?{geometry:t.cloneShallow()}:{geometry:t}})}}function mt(e,t){var i;null!==(i=e.tools)&&void 0!==i&&i.remove(t),t.destroyed||t.destroy()}function ft(e){return"requireError"in e&&"aborted"===e.requireError}function _t(e,t){e.networkFeature=t}function bt(e){return e.networkFeature}function Et(e){return"point"===(null===e||void 0===e?void 0:e.type)||"polyline"===(null===e||void 0===e?void 0:e.type)||"polygon"===(null===e||void 0===e?void 0:e.type)}let wt=class extends n.A{constructor(e){super(e),this._createMode=null,this._graphicsLayer=new u.A({internal:!0,listMode:"hide",title:"Banana"}),this._updatingHandles=new h.U,this.enabled=!0,this._handleSketchViewModelEvents=async e=>{switch(e.type){case"update":switch(e.state){case"active":case"complete":for(const t of e.graphics)bt(t).geometry=Et(t.geometry)?t.geometry.clone():null}break;case"undo":case"redo":break;case"delete":for(const t of e.graphics){const e=bt(t);this._removeNetworkFeature(e)}break;case"create":if(e.graphic&&"complete"===e.state&&this._createMode){var t,i;const o=null===(t=e.graphic.geometry)||void 0===t?void 0:t.clone(),a=null===(i=e.graphic.symbol)||void 0===i?void 0:i.clone();if(!o)break;switch(this._createMode){case"stop":{if("point"!==o.type)break;const{stops:t}=this.layer;if(t.length>0&&t.every(e=>{let{geometry:t}=e;return!t})){t.at(0).geometry=o;break}if(t.length>1&&t.filter((e,t)=>0!==t).every(e=>{let{geometry:t}=e;return!t})){t.at(1).geometry=o;break}const i=new m.A({geometry:o});t.add(i),_t(e.graphic,i);break}case"point-barrier":{if("point"!==o.type)break;const t=new v.A({geometry:o,symbol:a});this.layer.pointBarriers.add(t),_t(e.graphic,t);break}case"polyline-barrier":{if("polyline"!==o.type)break;const t=new g.A({geometry:o,symbol:a});this.layer.polylineBarriers.add(t),_t(e.graphic,t);break}case"polygon-barrier":{if("polygon"!==o.type)break;const t=new y.A({geometry:o,symbol:a});this.layer.polygonBarriers.add(t),_t(e.graphic,t);break}}}}(await this.view.whenLayerView(this.layer)).emit(e.type,"create"===e.type?function(e){const t=bt(e.graphic);return(0,o.A)((0,o.A)({},e),{},{networkFeature:t})}(e):function(e){const t=e.graphics.map(e=>bt(e));return(0,o.A)((0,o.A)({},e),{},{networkFeatures:t})}(e))}}initialize(){this._sketchViewModel=new lt({layer:this._graphicsLayer,view:this.view}),this.addHandles([(0,l.wB)(()=>this.enabled,e=>{e?this._activate():this._deactivate()},l.Vh),(0,l.wB)(()=>{const{stops:e,pointBarriers:t,polylineBarriers:i,polygonBarriers:o}=this.layer;return{stops:e,pointBarriers:t,polylineBarriers:i,polygonBarriers:o}},()=>{this.enabled&&this._loadClonedGraphics()}),this._sketchViewModel.on(["create","delete","redo","undo","update"],this._handleSketchViewModelEvents),(0,r.DQ)(this._updatingHandles)])}destroy(){this.view.map.remove(this._graphicsLayer),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,s.pR)(this._graphicsLayer),this._sketchViewModel=(0,s.pR)(this._sketchViewModel)}get selectedNetworkFeatures(){return this._sketchViewModel.updateGraphics.map(e=>bt(e))}get updating(){return this._updatingHandles.updating}create(e){var t;switch(this._createMode=e,e){case"stop":(null===(t=this.layer.defaultSymbols.stops)||void 0===t?void 0:t.unlocated)&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.stops.unlocated.clone());break;case"point-barrier":this.layer.defaultSymbols.pointBarriers&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.pointBarriers.clone());break;case"polyline-barrier":this.layer.defaultSymbols.polylineBarriers&&(this._sketchViewModel.polylineSymbol=this.layer.defaultSymbols.polylineBarriers.clone());break;case"polygon-barrier":this.layer.defaultSymbols.polygonBarriers&&(this._sketchViewModel.polygonSymbol=this.layer.defaultSymbols.polygonBarriers.clone())}switch(e){case"stop":case"point-barrier":return this._sketchViewModel.create("point");case"polyline-barrier":return this._sketchViewModel.create("polyline");case"polygon-barrier":return this._sketchViewModel.create("polygon")}}remove(e){const t=this._graphicsLayer.graphics.find(t=>bt(t)===e);t&&this._graphicsLayer.remove(t),this._removeNetworkFeature(e)}_activate(){this._loadClonedGraphics(),this.view.map.add(this._graphicsLayer)}_deactivate(){var e;this._sketchViewModel.cancel(),null!==(e=this.view.map)&&void 0!==e&&e.remove(this._graphicsLayer),this._graphicsLayer.removeAll()}_loadClonedGraphics(){const e=[this.layer.stops,this.layer.pointBarriers,this.layer.polylineBarriers,this.layer.polygonBarriers].flatMap(e=>e.toArray().map(e=>{const t=e.toGraphic();return t.networkFeature=e,t}));this._graphicsLayer.removeAll().addMany(e)}_removeNetworkFeature(e){switch(e.type){case"stop":this.layer.stops.remove(e);break;case"point-barrier":this.layer.pointBarriers.remove(e);break;case"polyline-barrier":this.layer.polylineBarriers.remove(e);break;case"polygon-barrier":this.layer.polygonBarriers.remove(e)}}};(0,a._)([(0,p.MZ)()],wt.prototype,"enabled",void 0),(0,a._)([(0,p.MZ)({constructOnly:!0})],wt.prototype,"layer",void 0),(0,a._)([(0,p.MZ)({readOnly:!0})],wt.prototype,"selectedNetworkFeatures",null),(0,a._)([(0,p.MZ)()],wt.prototype,"updating",null),(0,a._)([(0,p.MZ)({constructOnly:!0})],wt.prototype,"view",void 0),wt=(0,a._)([(0,c.$)("esri.views.2d.layers.support.RouteLayerInteraction")],wt)},45097:(e,t,i)=>{i.d(t,{Fm:()=>l,Q7:()=>p});var o=i(97467),a=i(20664),n=i(9392),r=i(44230);i(75762);function s(e){return e?{p0:(0,n.o8)(e.p0),p1:(0,n.o8)(e.p1),p2:(0,n.o8)(e.p2)}:{p0:(0,n.vt)(),p1:(0,n.vt)(),p2:(0,n.vt)()}}function l(e,t,i){const o=t[0]-e[0],a=t[1]-e[1],n=i[0]-e[0],r=i[1]-e[1];return.5*Math.abs(o*r-a*n)}function p(e,t,i){return(0,a.d)(d,t,e),(0,a.d)(c,i,e),.5*(0,a.l)((0,a.h)(d,d,c))}new o.I(r.vt),new o.I(()=>s());const d=(0,n.vt)(),c=(0,n.vt)()},45633:(e,t,i)=>{i.d(t,{o:()=>l});var o=i(75543),a=i(99791),n=i(70330),r=i(30003),s=i(23543);class l extends r.C{constructor(e){let{lineStart:t,lineEnd:i,targetPoint:r,isDraped:l}=e;super(r,new o.WG(t,i),l,a.n.SELF),this._referenceLineHint=new s.c(n.H3.REFERENCE_EXTENSION,t,i,l,this.domain)}get hints(){return[this._referenceLineHint,new s.c(n.H3.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}},59380:(e,t,i)=>{i.d(t,{R:()=>u});var o=i(19555),a=i(20664),n=i(9392),r=i(75543),s=i(23862),l=i(99791),p=i(70330),d=i(30003),c=i(23543),h=i(56572);class u extends d.C{constructor(e){let{targetPoint:t,point1:i,point2:p,isDraped:d}=e;super(t,new r.ej((0,s._7)((0,a.m)((0,n.vt)(),i,p,.5)),.5*(0,o.Io)((0,s.Xz)(i),(0,s.Xz)(p))),d,l.n.SELF),this._p1=i,this._p2=p}get hints(){return[new c.c(p.H3.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new c.c(p.H3.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new h.l(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}},61492:(e,t,i)=>{i.d(t,{c:()=>a,d:()=>o});var o;i(81806);function a(e){switch(e){case o.SUPPORTED:break;case o.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case o.GEOMETRY_MISSING:return"no geometry";case o.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case o.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case o.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}!function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"}(o||(o={}))},61751:(e,t,i)=>{i.d(t,{w:()=>n});var o=i(99791),a=i(30003);class n extends a.C{constructor(e){let{targetPoint:t,objectId:i,constraint:a,isDraped:n}=e;super(t,a,n,o.n.FEATURE),this.objectId=i}}},69120:(e,t,i)=>{function o(e,t,i){if(!t||null===e||void 0===e||!e.map)return;const{map:o}=e,a=o.layers.find(e=>e===t);a||o.add(t,i),a&&null!=i&&o.layers.reorder(a,i)}function a(e,t){const i="subtype-sublayer"===(null===t||void 0===t?void 0:t.type)?t.parent:t;return e.allLayerViews.find(e=>{const t=e.layer;return t===i||"sublayers"in t&&null!=t.sublayers&&t.sublayers.includes(i)})}i.d(t,{Y:()=>o,i:()=>a})},73085:(e,t,i)=>{i.d(t,{e:()=>h,g:()=>u,i:()=>d,l:()=>c,s:()=>p});var o=i(31633),a=i(18917),n=i(75226);let r,s,l,p;function d(){return!!r&&(0,a.s1)()}async function c(){if(!d()){const[e]=await Promise.all([Promise.all([i.e(6871),i.e(6364),i.e(2103),i.e(426),i.e(1509)]).then(i.bind(i,58067)),(0,a.Hh)()]);r=e.fromGeometry,s=e.fromSpatialReference,l=e.getSpatialReference,p=(0,a.fz)()}}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{curveType:i="geodesic",unit:p}=t,d=l(e);let c=(0,a.g7)(r(e),s(d),n.O[i]);return c&&p&&(c=(0,o.oU)(c,"meters",p)),c}const u=Object.freeze(Object.defineProperty({__proto__:null,execute:h,isLoaded:d,load:c,get supportsCurves(){return p}},Symbol.toStringTag,{value:"Module"}))},75226:(e,t,i)=>{i.d(t,{O:()=>o});const o={geodesic:0,loxodrome:1,"great-elliptic":2,"normal-section":3,"shape-preserving":4}},78228:(e,t,i)=>{i.d(t,{HJ:()=>c,_b:()=>a,pn:()=>o});var o,a,n,r=i(99791),s=i(70330),l=i(30003),p=i(23543),d=i(56572);class c extends l.C{constructor(e){let{targetPoint:t,constraint:i,previousVertex:o,otherVertex:n,otherVertexType:s,isDraped:l,selfSnappingType:p,objectId:d,domain:c}=e;super(t,i,l,null!==c&&void 0!==c?c:r.n.SELF),this.previousVertex=o,this.otherVertex=n,this.otherVertexType=s,this.selfSnappingType=null!==p&&void 0!==p?p:a.None,this.objectId=null!==d&&void 0!==d?d:null}get hints(){const e=this.previousVertex,t=this.otherVertexType===o.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===o.CENTER?this.targetPoint:this.otherVertex;return[new p.c(s.H3.TARGET,t,i,this.isDraped,this.domain),new p.c(s.H3.REFERENCE,e,t,this.isDraped,this.domain),new d.l(this.previousVertex,t,i,this.isDraped,this.domain)]}}(n=o||(o={}))[n.NEXT=0]="NEXT",n[n.CENTER=1]="CENTER",function(e){e[e.None=0]="None",e[e.LastVertex=1]="LastVertex",e[e.FirstVertex=2]="FirstVertex",e[e.ExistingEdge=3]="ExistingEdge"}(a||(a={}))},80794:(e,t,i)=>{i.d(t,{X:()=>l});var o=i(89379),a=i(75543),n=i(70330),r=i(61751),s=i(23543);class l extends r.w{constructor(e){super((0,o.A)((0,o.A)({},e),{},{isDraped:!0,constraint:new a.en(e.edgeStart,e.edgeEnd,e.getGroundElevation)}))}get hints(){return[new s.c(n.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},90836:(e,t,i)=>{i.d(t,{N:()=>s});var o=i(75543),a=i(99791),n=i(30003),r=i(30484);class s extends n.C{constructor(e,t,i,n){super(e,new o.i7(e),n,a.n.ALL),this.first=t,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new r.v(this.targetPoint,this.isDraped,this.domain)]}}}}]);
//# sourceMappingURL=5829.6b936728.chunk.js.map