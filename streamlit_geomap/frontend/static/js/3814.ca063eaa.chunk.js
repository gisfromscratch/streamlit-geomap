"use strict";(self.webpackChunkstreamlit_geomap_frontend=self.webpackChunkstreamlit_geomap_frontend||[]).push([[3814],{11668:(e,t,r)=>{r.d(t,{K:()=>f,Q:()=>u});var a=r(53986),n=r(31933),l=r(67061);const o=["loadContext"],i=new Set(["Catalog Layer","Feature Layer","Oriented Imagery Layer"]);async function u(e,t){var r,i;const u=t||{},{loadContext:s}=u,c=(0,a.A)(u,o),y=s?await s.fetchServiceMetadata(e,c):await(0,l.V)(e,c),v=(0,n.G$)();p(y),d(y);const f={serviceJSON:y,preferredHost:v};if((null!==(r=y.currentVersion)&&void 0!==r?r:0)<10.5)return f;const m="".concat(null!==(i=(0,n.$x)())&&void 0!==i?i:e,"/layers"),h=s?await s.fetchServiceMetadata(m,c):await(0,l.V)(m,c);return p(h),d(h),f.layersJSON={layers:h.layers,tables:h.tables},f}function s(e){const{type:t}=e;return!!t&&i.has(t)}function c(e){return"Table"===e.type}function d(e){var t,r;e.layers=null===(t=e.layers)||void 0===t?void 0:t.filter(s),e.tables=null===(r=e.tables)||void 0===r?void 0:r.filter(c)}function y(e){e.type||(e.type="Feature Layer")}function v(e){e.type||(e.type="Table")}function p(e){var t,r;null!==(t=e.layers)&&void 0!==t&&t.forEach(y),null===(r=e.tables)||void 0===r||r.forEach(v)}function f(e){switch(e){case"Feature Layer":case"Table":return"FeatureLayer";case"Oriented Imagery Layer":return"OrientedImageryLayer";case"Catalog Layer":return"CatalogLayer"}return"FeatureLayer"}},39323:(e,t,r)=>{r.d(t,{L:()=>d});var a=r(89379),n=r(55171),l=r(3825),o=r(50076),i=r(50346),u=r(13096),s=r(65308),c=r(70652);async function d(e,t){var r,d;const p=(0,u.qg)(e);if(!p)throw new o.A("invalid-url","Invalid scene service url");const f=(0,a.A)((0,a.A)({},t),{},{sceneServerUrl:p.url.path,layerId:null!==(r=p.sublayer)&&void 0!==r?r:void 0});if(null!==(d=f.sceneLayerItem)&&void 0!==d||(f.sceneLayerItem=await async function(e){const t=(await y(e)).serviceItemId;if(!t)return null;const r=new c.default({id:t,apiKey:e.apiKey}),a=await async function(e){const t=null===n.id||void 0===n.id?void 0:n.id.findServerInfo(e.sceneServerUrl);if(null!==t&&void 0!==t&&t.owningSystemUrl)return t.owningSystemUrl;const r=e.sceneServerUrl.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const t=(await(0,l.A)(r,{query:{f:"json"},responseType:"json",signal:e.signal})).data.owningSystemUrl;if(t)return t}catch(m){(0,i.QP)(m)}return null}(e);null!=a&&(r.portal=new s.A({url:a}));try{return await r.load({signal:e.signal})}catch(h){return(0,i.QP)(h),null}}(f)),null==f.sceneLayerItem)return v(f.sceneServerUrl.replace("/SceneServer","/FeatureServer"),f);const m=await async function(e){let{sceneLayerItem:t,signal:r}=e;if(!t)return null;try{const e=(await t.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:r})).find(e=>"Feature Service"===e.type)||null;if(!e)return null;const a=new c.default({portal:e.portal,id:e.id});return await a.load(),a}catch(a){return(0,i.QP)(a),null}}(f);if(null===m||void 0===m||!m.url)throw new o.A("related-service-not-found","Could not find feature service through portal item relationship");f.featureServiceItem=m;const h=await v(m.url,f);return h.portalItem=m,h}async function y(e){if(e.rootDocument)return e.rootDocument;const t={query:(0,a.A)((0,a.A)({f:"json"},e.customParameters),{},{token:e.apiKey}),responseType:"json",signal:e.signal};try{const r=await(0,l.A)(e.sceneServerUrl,t);e.rootDocument=r.data}catch(r){e.rootDocument={}}return e.rootDocument}async function v(e,t){var r,n,i;const s=(0,u.qg)(e);if(!s)throw new o.A("invalid-feature-service-url","Invalid feature service url");const c=s.url.path,d=t.layerId;if(null==d)return{serverUrl:c};const v=y(t),p=t.featureServiceItem?await t.featureServiceItem.fetchData("json"):null,f=null===(r=(null===p||void 0===p||null===(n=p.layers)||void 0===n?void 0:n[0])||(null===p||void 0===p||null===(i=p.tables)||void 0===i?void 0:i[0]))||void 0===r?void 0:r.customParameters,m=e=>{const r={query:(0,a.A)({f:"json"},f),responseType:"json",authMode:e,signal:t.signal};return(0,l.A)(c,r)},h=m("anonymous").catch(()=>m("no-prompt")),[w,g]=await Promise.all([h,v]),b=null===g||void 0===g?void 0:g.layers,I=w.data&&w.data.layers;if(!Array.isArray(I))throw new Error("expected layers array");if(Array.isArray(b)){for(let a=0;a<Math.min(b.length,I.length);a++)if(b[a].id===d)return{serverUrl:c,layerId:I[a].id}}else if(null!=d&&d<I.length)return{serverUrl:c,layerId:I[d].id};throw new Error("could not find matching associated sublayer")}},64130:(e,t,r)=>{r.d(t,{Ju:()=>c,K8:()=>v,XH:()=>d,_r:()=>o,bO:()=>i,l:()=>y,nu:()=>p,pJ:()=>u,rc:()=>s});var a=r(39323),n=r(11668),l=r(31933);function o(e){const t={id:e.id,name:e.name},r=(0,n.K)(e.type);return"FeatureLayer"!==r&&(t.layerType=r),t}async function i(e,t,r){var a,n;let i;if(null==(null===(a=e)||void 0===a?void 0:a.layers)||null==(null===(n=e)||void 0===n?void 0:n.tables)){var s,c,d;const a=await r.fetchServiceMetadata(t,{customParameters:null===(s=u(e))||void 0===s?void 0:s.customParameters});i=(0,l.G$)(),(e=e||{}).layers=e.layers||(null===a||void 0===a||null===(c=a.layers)||void 0===c?void 0:c.map(o)),e.tables=e.tables||(null===a||void 0===a||null===(d=a.tables)||void 0===d?void 0:d.map(o))}return{data:e,preferredHost:i}}function u(e){if(!e)return null;const{layers:t,tables:r}=e;return null!==t&&void 0!==t&&t.length?t[0]:null!==r&&void 0!==r&&r.length?r[0]:null}function s(e,t){return null==t?null:[...e.layers||[],...e.tables||[]].find(e=>e.id===t)}function c(e,t){return[...e.layers||[],...e.tables||[]].filter(e=>{let{layerType:r}=e;return r?t.includes(r):t.includes("ArcGISFeatureLayer")})}function d(e){var t,r,a,n;return(null!==(t=null===e||void 0===e||null===(r=e.layers)||void 0===r?void 0:r.length)&&void 0!==t?t:0)+(null!==(a=null===e||void 0===e||null===(n=e.tables)||void 0===n?void 0:n.length)&&void 0!==a?a:0)}function y(e){switch(e){case"catalog":return["CatalogLayer"];case"feature":return["ArcGISFeatureLayer"];case"oriented-imagery":return["OrientedImageryLayer"];case"subtype-group":return["SubtypeGroupLayer","SubtypeGroupTable"]}return null}function v(e){switch(e){case"CatalogLayer":return"CatalogLayer";case"OrientedImageryLayer":return"OrientedImageryLayer";case"SubtypeGroupLayer":case"SubtypeGroupTable":return"SubtypeGroupLayer"}return"FeatureLayer"}async function p(e,t,r){var n;if(null===e||void 0===e||!e.url)return null!==t&&void 0!==t?t:{};if(null!==t&&void 0!==t||(t={}),!t.layers){var l;const a=await r.fetchServiceMetadata(e.url);t.layers=null===(l=a.layers)||void 0===l?void 0:l.map(o)}const{serverUrl:i,portalItem:s}=await(0,a.L)(e.url,{sceneLayerItem:e,customParameters:null===(n=u(t))||void 0===n?void 0:n.customParameters}).catch(()=>({serverUrl:null,portalItem:null}));if(null==i)return t.tables=[],t;if(!t.tables&&s){const e=await s.fetchData().catch(()=>null);if(null!==e&&void 0!==e&&e.tables)t.tables=e.tables.map(o);else{var c,d;const a=await r.fetchServiceMetadata(i,{customParameters:null===(c=u(e))||void 0===c?void 0:c.customParameters}).catch(()=>null);t.tables=null===a||void 0===a||null===(d=a.tables)||void 0===d?void 0:d.map(o)}}if(t.tables)for(const a of t.tables)a.url="".concat(i,"/").concat(a.id);return t}},67061:(e,t,r)=>{r.d(t,{V:()=>l});var a=r(89379),n=r(3825);async function l(e,t){const{data:r}=await(0,n.A)(e,{responseType:"json",query:(0,a.A)((0,a.A)({f:"json"},null===t||void 0===t?void 0:t.customParameters),{},{token:null===t||void 0===t?void 0:t.apiKey})});return r}},73814:(e,t,r)=>{r.d(t,{load:()=>p});var a=r(50076),n=r(13096),l=r(11668),o=r(77491),i=r(31933),u=r(65308),s=r(79942),c=r(64130),d=r(72945),y=r(81589),v=r(67061);async function p(e,t){const r=e.instance.portalItem;if(null!==r&&void 0!==r&&r.id)return await r.load(t),function(e){const t=e.instance.portalItem;if(null===t||void 0===t||!t.type||!e.supportedTypes.includes(t.type))throw new a.A("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:null===t||void 0===t?void 0:t.type,expectedType:e.supportedTypes.join(", ")})}(e),e.validateItem&&e.validateItem(r),async function(e,t){var r;const n=e.instance,u=n.portalItem;if(!u)return;let{url:p}=u;const{title:m}=u,w=(0,s.v)(u,"portal-item");if("group"===n.type)return async function(e,t,r){const n=e.portalItem;if(!e.sourceIsPortalItem)return;const{title:u,type:y}=n;if("Group Layer"===y){if(!(0,d.Y)(n,"Map"))throw new a.A("portal:invalid-layer-item-typekeyword","'Group Layer' item without 'Map' type keyword is not supported");return async function(e,t){var r;const n=e.portalItem,l=await n.fetchData("json");if(!l)return;if(!t.populateGroupLayer)throw new a.A("portal:missing-populate-group-layer","Missing populate group layer");const o=(0,s.v)(n,"web-map");e.read(l,o),await t.populateGroupLayer(e,l,{context:o}),e.resourceReferences={portalItem:n,paths:null!==(r=o.readResourcePaths)&&void 0!==r?r:[]}}(e,r)}return e.read({title:u},t),async function(e,t){let r;const{portalItem:n}=e;if(!n)return;const u=n.type,s=t.layerModuleTypeMap;if(!s)throw new a.A("portal:missing-layer-module-type-map","Layer module type map is required to construct sub layers");switch(u){case"Feature Service":case"Feature Collection":r=s.FeatureLayer;break;case"Stream Service":r=s.StreamLayer;break;case"Scene Service":r=s.SceneLayer;break;case"Video Service":r=s.VideoLayer;break;default:throw new a.A("portal:unsupported-item-type-as-group","The item type '".concat(u,"' is not supported as a 'IGroupLayer'"))}const d="Video Service"===u,y=new o.v;let[p,{data:m}]=await Promise.all([r(),d?{data:null}:h(t,y)]),w=()=>p;if(d)return async function(e,t,r){var a;const{portalItem:n}=e;if(null===n||void 0===n||!n.url)return;const l=await(0,v.V)(n.url);l&&f(e,t,null,{layers:null===(a=l.layers)||void 0===a?void 0:a.map(e=>{let{id:t,name:r}=e;return{id:t,name:r}})},r)}(e,w,s);if("Feature Service"===u){var g;const t=null===(g=(0,c.pJ)(m))||void 0===g?void 0:g.customParameters;m=n.url?(await(0,c.bO)(m,n.url,y)).data:{},w=await async function(e,t){const{layers:r,tables:a}=e,n=[...null!==r&&void 0!==r?r:[],...null!==a&&void 0!==a?a:[]];if(!n.length)return;const l=new Set,o=[];for(const{layerType:s}of n){const e=null!==s&&void 0!==s?s:"ArcGISFeatureLayer";if(l.has(e))continue;l.add(e);const r=t[(0,c.K8)(e)];o.push(r())}const i=await Promise.all(o),u=new Map;return Array.from(l).forEach((e,t)=>{u.set(e,i[t])}),e=>{let{layerType:t}=e;const r=null!==t&&void 0!==t?t:"ArcGISFeatureLayer";return u.get(r)}}(m,s)||w;const{provider:r,preferredHost:a}=await async function(e,t){const{layersJSON:r,preferredHost:a}=await(0,l.Q)(e,t);if(!r)return{provider:null,preferredHost:a};const n=[...r.layers,...r.tables];return{provider:e=>n.find(t=>t.id===e.id),preferredHost:a}}(n.url,{customParameters:t,loadContext:y});return(0,i.Gh)(n,a),await f(e,w,w,m,s,r)}return"Scene Service"===u&&n.url&&(m=await(0,c.nu)(n,m,y)),(0,c.XH)(m)>0?await f(e,w,null,m,s):await async function(e,t,r){var a,n;const{portalItem:l}=e;if(null===l||void 0===l||!l.url)return;const o=await(0,v.V)(l.url);o&&f(e,t,null,{layers:null===(a=o.layers)||void 0===a?void 0:a.map(c._r),tables:null===(n=o.tables)||void 0===n?void 0:n.map(c._r)},r)}(e,w,s)}(e,r)}(n,w,e);p&&"media"!==n.type&&n.read({url:p},w);const g=new o.v,{data:b,preferredHost:I}=await h(e,g,t);return p=u.url,"isUrlHostModified"in n&&(I?n.applyPreferredHost({preferredHost:I}):n.applyHostFromPortalItem()),b&&n.read(b,w),n.resourceReferences={portalItem:u,paths:null!==(r=w.readResourcePaths)&&void 0!==r?r:[]},"subtype-group"!==n.type&&n.read({title:m},w),(0,y.L)(n,w)}(e,t)}async function f(e,t,r,a,n,l){var o;let i=a.layers||[];const u=a.tables||[];if("Feature Collection"===(null===(o=e.portalItem)||void 0===o?void 0:o.type)?(i.forEach((e,t)=>{var r;e.id=t,"Table"===(null===e||void 0===e||null===(r=e.layerDefinition)||void 0===r?void 0:r.type)&&u.push(e)}),i=i.filter(e=>{var t;return"Table"!==(null===e||void 0===e||null===(t=e.layerDefinition)||void 0===t?void 0:t.type)})):(i.reverse(),u.reverse()),i.forEach(r=>{const n=null===l||void 0===l?void 0:l(r);if(n||!l){const l=m(e,t(r),a,r,n);e.add(l)}}),u.length){const t=r?null:await n.FeatureLayer();u.forEach(n=>{const o=null===l||void 0===l?void 0:l(n);if(o||!l){const l=m(e,r?r(n):t,a,n,o);e.tables.add(l)}})}}function m(e,t,r,a,n){const l=e.portalItem,o={portalItem:l.clone(),layerId:a.id};null!=a.url&&(o.url=a.url);const i=new t(o);if("sourceJSON"in i&&(i.sourceJSON=n),"subtype-group"!==i.type&&"catalog"!==i.type&&(i.sublayerTitleMode="service-name"),"Feature Collection"===l.type){const e={origin:"portal-item",portal:l.portal||u.A.getDefault()};i.read(a,e);const t=r.showLegend;null!=t&&i.read({showLegend:t},e)}return i}async function h(e,t,r){if(!1===e.supportsData)return{data:void 0};const a=e.instance,l=a.portalItem;if(!l)return{data:void 0};let o=null;try{o=await l.fetchData("json",r)}catch(y){}if(function(e){return"stream"!==e.type&&"layerId"in e}(a)){var u,s;let e=null;const{count:r,preferredHost:y}=await async function(e,t,r){var a,l,o,u,s,d,y,v,p;if(null!==t&&void 0!==t&&t.layers&&null!==t&&void 0!==t&&t.tables)return{count:(0,c.XH)(t)};const f=(0,n.qg)(e.url);if(!f)return{count:1};const m=f.url.path,h=await r.fetchServiceMetadata(m,{customParameters:null===(a=(0,c.pJ)(t))||void 0===a?void 0:a.customParameters}).catch(()=>null);return{count:(null!==(l=null!==(o=null===t||void 0===t||null===(u=t.layers)||void 0===u?void 0:u.length)&&void 0!==o?o:null===h||void 0===h||null===(s=h.layers)||void 0===s?void 0:s.length)&&void 0!==l?l:0)+(null!==(d=null!==(y=null===t||void 0===t||null===(v=t.tables)||void 0===v?void 0:v.length)&&void 0!==y?y:null===h||void 0===h||null===(p=h.tables)||void 0===p?void 0:p.length)&&void 0!==d?d:0),preferredHost:(0,i.OP)(e)?(0,i.G$)():null}}(l,o,t);if((0,i.Gh)(l,y),(null!==(u=o)&&void 0!==u&&u.layers||null!==(s=o)&&void 0!==s&&s.tables)&&r>0){var d;if(null==a.layerId){const e=(0,c.l)(a.type),t=null!==e&&void 0!==e&&e.length?(0,c.Ju)(o,e)[0]:(0,c.pJ)(o);t&&(a.layerId=t.id)}e=function(e,t){var r,a;const{layerId:n}=t,l=(null===(r=e.layers)||void 0===r?void 0:r.find(e=>e.id===n))||(null===(a=e.tables)||void 0===a?void 0:a.find(e=>e.id===n));return l&&function(e,t){const r="layerType"in e&&e.layerType,{type:a}=t;return!("feature"===a&&r&&"ArcGISFeatureLayer"!==e.layerType||"catalog"===a&&!r||"oriented-imagery"===a&&!r||"subtype-group"===a&&!r)}(l,t)?l:null}(o,a),"OrientedImageryLayer"===(null===(d=e)||void 0===d?void 0:d.layerType)&&"oriented-imagery"===a.type&&a.supportedSourceTypes.add("Feature Layer"),e&&null!=o.showLegend&&(e.showLegend=o.showLegend)}return r>1&&"sublayerTitleMode"in a&&"service-name"!==a.sublayerTitleMode&&(a.sublayerTitleMode="item-title-and-service-name"),{data:e,preferredHost:y}}return{data:o}}},77491:(e,t,r)=>{r.d(t,{v:()=>n});var a=r(67061);class n{constructor(){this._serviceMetadatas=new Map,this._itemDatas=new Map}async fetchServiceMetadata(e,t){const r=this._serviceMetadatas.get(e);if(r)return r;const n=await(0,a.V)(e,t);return this._serviceMetadatas.set(e,n),n}async fetchItemData(e){const{id:t}=e;if(!t)return null;const{_itemDatas:r}=this;if(r.has(t))return r.get(t);const a=await e.fetchData();return r.set(t,a),a}async fetchCustomParameters(e,t){const r=await this.fetchItemData(e);return r&&"object"==typeof r&&(t?t(r):r.customParameters)||null}}},79942:(e,t,r)=>{r.d(t,{m:()=>i,v:()=>o});var a=r(89379),n=r(90534),l=r(65308);function o(e,t){return(0,a.A)((0,a.A)({},u(e,t)),{},{readResourcePaths:[]})}function i(e,t,r){const l=(0,n.An)(e.itemUrl);return(0,a.A)((0,a.A)({},u(e,t)),{},{messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:l?{rootPath:l.path,writtenUrls:[]}:null,resources:r?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null})}function u(e,t){return{origin:t,url:(0,n.An)(e.itemUrl),portal:e.portal||l.A.getDefault(),portalItem:e}}}}]);
//# sourceMappingURL=3814.ca063eaa.chunk.js.map